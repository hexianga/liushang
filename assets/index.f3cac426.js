var It=Object.defineProperty;var Be=Object.getOwnPropertySymbols;var $t=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable;var Fe=(e,t,n)=>t in e?It(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ze=(e,t)=>{for(var n in t||(t={}))$t.call(t,n)&&Fe(e,n,t[n]);if(Be)for(var n of Be(t))Pt.call(t,n)&&Fe(e,n,t[n]);return e};import{r as x,j as i,b as mt}from"./index.3c92a27f.js";import{Z as a,O as vt,b as Ee,i as ne,c as j,d as Ut,W as Ce,f as C,e as Wt,g as be,h as pe,D as Ke,j as Re,k as Yt,a as Xe,l as Qe,m as Ge}from"./utils.b8a06f7c.js";import{d as _}from"./dayjs.min.9bf2e87d.js";import{t as Ht,r as se,d as _e,b as We,f as Bt,S as qe,c as U}from"./index.9305b007.js";import{g as je,c as yt,f as Ft,i as Ae,a as zt,d as Kt,L as Ye,h as Te,M as Dt,b as Xt,t as oe,e as Qt}from"./_arrayPush.36a0ce3a.js";import{A as Gt,a as qt}from"./index.esm.ccf50977.js";import{a as Zt}from"./sortable.esm.a848983c.js";import{g as kt,u as Jt,b as Vt}from"./intersection-ratio.a5bde1cb.js";import{f as er,g as tr}from"./index.esm.04855603.js";import{v as rr}from"./v4.90f1a8cc.js";import{d as nr}from"./debounce.77e54b46.js";import"./_commonjsHelpers.294d03c4.js";import"./index.563d4b32.js";var Ze=1/0,sr=17976931348623157e292;function or(e){if(!e)return e===0?e:0;if(e=Ht(e),e===Ze||e===-Ze){var t=e<0?-1:1;return t*sr}return e===e?e:0}function ar(e){var t=or(e),n=t%1;return t===t?n?t-n:t:0}var ir=je(se,"WeakMap"),Oe=ir;function lr(e){return e!=null&&yt(e.length)&&!Ft(e)}var cr=Object.prototype;function ur(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||cr;return e===n}function dr(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function fr(){return!1}var wt=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ke=wt&&typeof module=="object"&&module&&!module.nodeType&&module,pr=ke&&ke.exports===wt,Je=pr?se.Buffer:void 0,xr=Je?Je.isBuffer:void 0,gr=xr||fr,Ie=gr,hr="[object Arguments]",mr="[object Array]",vr="[object Boolean]",yr="[object Date]",Dr="[object Error]",wr="[object Function]",Er="[object Map]",br="[object Number]",Rr="[object Object]",Ar="[object RegExp]",Tr="[object Set]",Lr="[object String]",jr="[object WeakMap]",Mr="[object ArrayBuffer]",Sr="[object DataView]",Nr="[object Float32Array]",Cr="[object Float64Array]",_r="[object Int8Array]",Or="[object Int16Array]",Ir="[object Int32Array]",$r="[object Uint8Array]",Pr="[object Uint8ClampedArray]",Ur="[object Uint16Array]",Wr="[object Uint32Array]",A={};A[Nr]=A[Cr]=A[_r]=A[Or]=A[Ir]=A[$r]=A[Pr]=A[Ur]=A[Wr]=!0;A[hr]=A[mr]=A[Mr]=A[vr]=A[Sr]=A[yr]=A[Dr]=A[wr]=A[Er]=A[br]=A[Rr]=A[Ar]=A[Tr]=A[Lr]=A[jr]=!1;function Yr(e){return _e(e)&&yt(e.length)&&!!A[We(e)]}function Hr(e){return function(t){return e(t)}}var Et=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fe=Et&&typeof module=="object"&&module&&!module.nodeType&&module,Br=fe&&fe.exports===Et,Se=Br&&Bt.process,Fr=function(){try{var e=fe&&fe.require&&fe.require("util").types;return e||Se&&Se.binding&&Se.binding("util")}catch{}}(),Ve=Fr,et=Ve&&Ve.isTypedArray,zr=et?Hr(et):Yr,bt=zr,Kr=Object.prototype,Xr=Kr.hasOwnProperty;function Qr(e,t){var n=Ae(e),r=!n&&zt(e),s=!n&&!r&&Ie(e),o=!n&&!r&&!s&&bt(e),c=n||r||s||o,l=c?dr(e.length,String):[],u=l.length;for(var f in e)(t||Xr.call(e,f))&&!(c&&(f=="length"||s&&(f=="offset"||f=="parent")||o&&(f=="buffer"||f=="byteLength"||f=="byteOffset")||Kt(f,u)))&&l.push(f);return l}function Gr(e,t){return function(n){return e(t(n))}}var qr=Gr(Object.keys,Object),Zr=qr,kr=Object.prototype,Jr=kr.hasOwnProperty;function Vr(e){if(!ur(e))return Zr(e);var t=[];for(var n in Object(e))Jr.call(e,n)&&n!="constructor"&&t.push(n);return t}function en(e){return lr(e)?Qr(e):Vr(e)}function tn(e,t,n){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),n=n>s?s:n,n<0&&(n+=s),s=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(s);++r<s;)o[r]=e[r+t];return o}function rn(){this.__data__=new Ye,this.size=0}function nn(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function sn(e){return this.__data__.get(e)}function on(e){return this.__data__.has(e)}var an=200;function ln(e,t){var n=this.__data__;if(n instanceof Ye){var r=n.__data__;if(!Te||r.length<an-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Dt(r)}return n.set(e,t),this.size=n.size,this}function X(e){var t=this.__data__=new Ye(e);this.size=t.size}X.prototype.clear=rn;X.prototype.delete=nn;X.prototype.get=sn;X.prototype.has=on;X.prototype.set=ln;function cn(e,t){for(var n=-1,r=e==null?0:e.length,s=0,o=[];++n<r;){var c=e[n];t(c,n,e)&&(o[s++]=c)}return o}function un(){return[]}var dn=Object.prototype,fn=dn.propertyIsEnumerable,tt=Object.getOwnPropertySymbols,pn=tt?function(e){return e==null?[]:(e=Object(e),cn(tt(e),function(t){return fn.call(e,t)}))}:un,xn=pn;function gn(e,t,n){var r=t(e);return Ae(e)?r:Xt(r,n(e))}function rt(e){return gn(e,en,xn)}var hn=je(se,"DataView"),$e=hn,mn=je(se,"Promise"),Pe=mn,vn=je(se,"Set"),Ue=vn,nt="[object Map]",yn="[object Object]",st="[object Promise]",ot="[object Set]",at="[object WeakMap]",it="[object DataView]",Dn=oe($e),wn=oe(Te),En=oe(Pe),bn=oe(Ue),Rn=oe(Oe),k=We;($e&&k(new $e(new ArrayBuffer(1)))!=it||Te&&k(new Te)!=nt||Pe&&k(Pe.resolve())!=st||Ue&&k(new Ue)!=ot||Oe&&k(new Oe)!=at)&&(k=function(e){var t=We(e),n=t==yn?e.constructor:void 0,r=n?oe(n):"";if(r)switch(r){case Dn:return it;case wn:return nt;case En:return st;case bn:return ot;case Rn:return at}return t});var lt=k,An=se.Uint8Array,ct=An,Tn="__lodash_hash_undefined__";function Ln(e){return this.__data__.set(e,Tn),this}function jn(e){return this.__data__.has(e)}function Le(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Dt;++t<n;)this.add(e[t])}Le.prototype.add=Le.prototype.push=Ln;Le.prototype.has=jn;function Mn(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Sn(e,t){return e.has(t)}var Nn=1,Cn=2;function Rt(e,t,n,r,s,o){var c=n&Nn,l=e.length,u=t.length;if(l!=u&&!(c&&u>l))return!1;var f=o.get(e),p=o.get(t);if(f&&p)return f==t&&p==e;var d=-1,g=!0,b=n&Cn?new Le:void 0;for(o.set(e,t),o.set(t,e);++d<l;){var D=e[d],m=t[d];if(r)var y=c?r(m,D,d,t,e,o):r(D,m,d,e,t,o);if(y!==void 0){if(y)continue;g=!1;break}if(b){if(!Mn(t,function(v,h){if(!Sn(b,h)&&(D===v||s(D,v,n,r,o)))return b.push(h)})){g=!1;break}}else if(!(D===m||s(D,m,n,r,o))){g=!1;break}}return o.delete(e),o.delete(t),g}function _n(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n}function On(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var In=1,$n=2,Pn="[object Boolean]",Un="[object Date]",Wn="[object Error]",Yn="[object Map]",Hn="[object Number]",Bn="[object RegExp]",Fn="[object Set]",zn="[object String]",Kn="[object Symbol]",Xn="[object ArrayBuffer]",Qn="[object DataView]",ut=qe?qe.prototype:void 0,Ne=ut?ut.valueOf:void 0;function Gn(e,t,n,r,s,o,c){switch(n){case Qn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Xn:return!(e.byteLength!=t.byteLength||!o(new ct(e),new ct(t)));case Pn:case Un:case Hn:return Qt(+e,+t);case Wn:return e.name==t.name&&e.message==t.message;case Bn:case zn:return e==t+"";case Yn:var l=_n;case Fn:var u=r&In;if(l||(l=On),e.size!=t.size&&!u)return!1;var f=c.get(e);if(f)return f==t;r|=$n,c.set(e,t);var p=Rt(l(e),l(t),r,s,o,c);return c.delete(e),p;case Kn:if(Ne)return Ne.call(e)==Ne.call(t)}return!1}var qn=1,Zn=Object.prototype,kn=Zn.hasOwnProperty;function Jn(e,t,n,r,s,o){var c=n&qn,l=rt(e),u=l.length,f=rt(t),p=f.length;if(u!=p&&!c)return!1;for(var d=u;d--;){var g=l[d];if(!(c?g in t:kn.call(t,g)))return!1}var b=o.get(e),D=o.get(t);if(b&&D)return b==t&&D==e;var m=!0;o.set(e,t),o.set(t,e);for(var y=c;++d<u;){g=l[d];var v=e[g],h=t[g];if(r)var w=c?r(h,v,g,t,e,o):r(v,h,g,e,t,o);if(!(w===void 0?v===h||s(v,h,n,r,o):w)){m=!1;break}y||(y=g=="constructor")}if(m&&!y){var E=e.constructor,R=t.constructor;E!=R&&"constructor"in e&&"constructor"in t&&!(typeof E=="function"&&E instanceof E&&typeof R=="function"&&R instanceof R)&&(m=!1)}return o.delete(e),o.delete(t),m}var Vn=1,dt="[object Arguments]",ft="[object Array]",we="[object Object]",es=Object.prototype,pt=es.hasOwnProperty;function ts(e,t,n,r,s,o){var c=Ae(e),l=Ae(t),u=c?ft:lt(e),f=l?ft:lt(t);u=u==dt?we:u,f=f==dt?we:f;var p=u==we,d=f==we,g=u==f;if(g&&Ie(e)){if(!Ie(t))return!1;c=!0,p=!1}if(g&&!p)return o||(o=new X),c||bt(e)?Rt(e,t,n,r,s,o):Gn(e,t,u,n,r,s,o);if(!(n&Vn)){var b=p&&pt.call(e,"__wrapped__"),D=d&&pt.call(t,"__wrapped__");if(b||D){var m=b?e.value():e,y=D?t.value():t;return o||(o=new X),s(m,y,n,r,o)}}return g?(o||(o=new X),Jn(e,t,n,r,s,o)):!1}function At(e,t,n,r,s){return e===t?!0:e==null||t==null||!_e(e)&&!_e(t)?e!==e&&t!==t:ts(e,t,n,r,At,s)}function rs(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function ns(e,t,n){var r=e==null?0:e.length;return r?(t=n||t===void 0?1:ar(t),t=r-t,tn(e,0,t<0?0:t)):[]}function J(e,t){return At(e,t)}const ss=typeof navigator!="undefined"&&/iPhone/i.test(navigator.userAgent),os="NewRecordPlaceholderId",re=40,xt=300,T={[a.DAY]:20,[a.HOUR]:90,[a.MONTH]:40,[a.WEEK]:160,[a.BIWEEK]:80,[a.QUARTER]:20,[a.YEAR]:5},de={[a.HOUR]:4,[a.DAY]:12,[a.MONTH]:5,[a.WEEK]:1,[a.BIWEEK]:3,[a.QUARTER]:14,[a.YEAR]:28},Tt={[a.HOUR]:100,[a.DAY]:100,[a.MONTH]:100,[a.BIWEEK]:50,[a.WEEK]:25,[a.QUARTER]:25,[a.YEAR]:25},K=e=>e===a.DAY||e===a.HOUR?vt:Ee,as=[{name:"\u5E74",zoomLevel:a.YEAR},{name:"\u5B63",zoomLevel:a.QUARTER},{name:"\u6708",zoomLevel:a.MONTH},{name:"\u5468",zoomLevel:a.WEEK},{name:"\u53CC\u5468",zoomLevel:a.BIWEEK},{name:"\u5929",zoomLevel:a.DAY},{name:"\u5C0F\u65F6",zoomLevel:a.HOUR}],He="NewRecordPlaceholderId";typeof navigator!="undefined"&&/iPhone/i.test(navigator.userAgent);const Lt=x.exports.createContext(void 0),ge=()=>{const e=x.exports.useContext(Lt);if(!e)throw new Error("RecordDataContext \u4E0D\u5B58\u5728");return e},jt=x.exports.createContext(void 0),P=()=>{const e=x.exports.useContext(jt);if(!e)throw new Error("useBitable");return e},Mt=()=>{const{timelineDates:e,zoomLevel:t}=P(),n=t===a.HOUR||t===a.DAY,[r,s]=x.exports.useState(0),o=x.exports.useRef(),c=x.exports.useCallback(()=>n?(new Date().setSeconds(0,0)-e[0])/vt*T[t]:j(Date.now(),e[0],t,{abs:!1})*T[t],[n,t,e]);return x.exports.useEffect(()=>(s(c()),o.current=setInterval(()=>s(c()),Ut),()=>{o.current&&clearInterval(o.current)}),[c]),r},is=()=>{const{timelineDates:e,zoomLevel:t}=P(),n=t===a.HOUR||t===a.DAY,r=Mt();if(Date.now()>e[e.length-1]||Date.now()<e[0])return null;let s=r;return ne(t)&&(s=j(Date.now(),e[0],t,{abs:!1,needDateStart:!0})*T[t]+T[t]/2),i.exports.jsxs(i.exports.Fragment,{children:[i.exports.jsx("span",{style:{left:s},className:U("absolute top-1.5 z-10 inline-flex -translate-x-1/2 items-center justify-center rounded-full px-1",n?"top-2 bg-green-200 text-red-500":"h-6 w-6 bg-red-400 text-white"),children:n?_(new Date).format("HH:mm"):new Date().getDate()}),i.exports.jsx("span",{style:{left:r},className:"absolute -bottom-2 h-2 w-2 -translate-x-1/2 -translate-y-1/2 rounded-full bg-red-400"})]})},ls=()=>{const{timelineDates:e}=P(),t=Mt();return Date.now()>e[e.length-1]||Date.now()<e[0]?null:i.exports.jsx("div",{style:{left:t,height:"calc(100% - 76px)"},className:"absolute bottom-0 top-[76px] w-px bg-red-600"})},cs=x.exports.memo(()=>{const{timelineDates:e,datesContainer:t,zoomLevel:n,containerWidth:r}=P(),s=T[n],o=c=>{let l=0,u="";return ne(n)?(n===a.WEEK||n===a.BIWEEK?u=`\u5468${Ce[C(c).day]}  ${C(c).date}`:u=C(c).date,l=s):n===a.YEAR?(u=`${C(c).month}\u6708`,l=s*Wt(c)):n===a.QUARTER?(u=`${C(c).date}`,l=7*s):n===a.DAY?(u=_(new Date(c)).format("HH:00"),l=s*4):n===a.HOUR&&(u=_(new Date(c)).format("HH:mm"),l=s),i.exports.jsx("div",{className:U("inline-flex h-full items-center",n!==a.DAY&&n!==a.HOUR&&n!==a.QUARTER&&"justify-center"),style:{width:l},children:n===a.DAY||n===a.HOUR||n===a.QUARTER?i.exports.jsxs("span",{className:"-translate-x-1/2",children:[" ",u]}):u},c)};return i.exports.jsxs("div",{ref:t,className:U("text-grey4 text-t2-medium relative z-10 h-[38px] border-b bg-white font-medium"),style:{width:r},children:[e.map(o),i.exports.jsx(is,{})]})},J),us=x.exports.memo(x.exports.forwardRef((e,t)=>{const{timelineDates:n,zoomLevel:r,containerWidth:s}=P(),o=T[r],c=(l,u)=>{let f=!1,p="",d=0;return ne(r)?(f=new Date(l).getDate()===1,p=`${new Date(l).getMonth()+1}\u6708`,d=u*o):r===a.YEAR?(f=new Date(l).setMonth(0,1)===l,p=`${new Date(l).getFullYear()}\u5E74`,d=j(l,n[0],r)*o):r===a.QUARTER?new Date(l).getMonth()!==new Date(l+6*Ee).getMonth()&&(f=!0,p=`${new Date(l+6*Ee).getMonth()+1}\u6708`,d=(j(l,n[0],r)+(7-new Date(l+6*Ee).getDate()))*o):(r===a.DAY||r===a.HOUR)&&(f=be(l)===l,p=`${new Date(l).getMonth()+1}\u6708${new Date(l).getDate()}\u65E5`,d=j(l,n[0],r)*o),f?i.exports.jsx("div",{style:{left:d},className:"absolute inline-flex h-full flex-shrink-0 items-center justify-center",children:p},l):null};return i.exports.jsx("div",{className:"timeline-month relative z-10 h-[38px] border-t bg-white",style:{width:s},ref:t,children:n.map(c)})}),J),ds=x.exports.memo(()=>{const{timelineDates:e,containerWidth:t,zoomLevel:n}=P(),r=T[n];return i.exports.jsxs("div",{className:"absolute top-0 h-full",style:{width:t},children:[e.map(s=>{const o=j(s,e[0],n)*r;return n===a.YEAR||n===a.DAY||n===a.HOUR||n===a.QUARTER?i.exports.jsx("div",{style:{left:o},className:"absolute h-full w-[1px] bg-[#d8dee4]"},s):n===a.WEEK||n===a.BIWEEK?i.exports.jsx("div",{style:{left:o,width:r},className:U("absolute h-full",(C(s).day===6||C(s).day===0)&&"bg-gray-200")},s):C(s).day===6?i.exports.jsx("div",{style:{left:o,width:r*2},className:"absolute flex h-full flex-shrink-0 flex-col items-center justify-center bg-gray-200"},s):null}),i.exports.jsx(ls,{})]})},J),fs=x.exports.forwardRef((e,t)=>{const{timelineDates:n,container:r,setTimelineDates:s,stepLength:o,scrollLeft:c,zoomLevel:l,setZoomLevel:u}=P(),[f,p]=x.exports.useState();return x.exports.useEffect(()=>{const d=r.current;if(!d)return;const g=()=>{const b=Math.floor(d.scrollLeft/T[l]),D=n[0]+b*K(l);p(m=>{let y=0;return ne(l)||l===a.QUARTER?y=new Date(D).setDate(1):l===a.YEAR?y=new Date(D).setMonth(0,1):(l===a.DAY||l===a.HOUR)&&(y=be(D)),y!==m?y:m})};return g(),d.addEventListener("scroll",g),()=>d.removeEventListener("scroll",g)},[r,l,n]),i.exports.jsxs("div",{className:"absolute left-0 right-0 top-1 z-50 flex h-8 items-center",ref:t,children:[i.exports.jsxs("div",{className:"flex h-full",children:[f&&i.exports.jsxs("span",{className:"inline-flex h-full items-center bg-white",children:[C(f).year,"\u5E74",(ne(l)||l===a.QUARTER)&&i.exports.jsxs(i.exports.Fragment,{children:[C(f).month,"\u6708"]}),(l===a.DAY||l===a.HOUR)&&i.exports.jsxs(i.exports.Fragment,{children:[C(f).date,"\u65E5"]})]}),i.exports.jsx("span",{className:"h-full w-10",style:{backgroundImage:"linear-gradient(to right, white 20%, rgba(255, 255, 255, 0) 100%)"}})]}),i.exports.jsxs("div",{className:"ml-auto flex items-center",children:[i.exports.jsx("span",{className:"inline-block h-8 w-10",style:{backgroundImage:"linear-gradient(to left, white 20%, rgba(255, 255, 255, 0) 100%)"}}),i.exports.jsxs("div",{className:"flex items-center bg-white",children:[as.map(d=>i.exports.jsx("button",{onClick:()=>{if(!r.current)return;o.current=Tt[d.zoomLevel];const g=pe({zoomLevel:d.zoomLevel,length:o.current});u(d.zoomLevel),s(g),c.current=j(Date.now(),g[0],d.zoomLevel)*T[d.zoomLevel]-r.current.clientWidth/2},children:d.name},d.zoomLevel)),i.exports.jsx("button",{onClick:()=>{r.current&&(r.current.scrollLeft-=r.current.clientWidth/2)},children:i.exports.jsx(Gt,{className:"h-5 w-5"})}),i.exports.jsx("button",{className:"cursor-pointer bg-white px-2",onClick:()=>{if(!r.current)return;const d=pe({zoomLevel:l,length:o.current});s(d),c.current=j(Date.now(),d[0],l)*T[l]-r.current.clientWidth/2},children:"\u4ECA\u5929"}),i.exports.jsx("button",{onClick:()=>{r.current&&(r.current.scrollLeft+=r.current.clientWidth/2)},children:i.exports.jsx(qt,{className:"h-5 w-5"})})]})]})]})}),ps=x.exports.memo(fs,J),St=({startTime:e,unitLength:t})=>{const{timelineDates:n,zoomLevel:r}=P(),s=e+t*K(r),o=T[r],c=j(e,n[0],r,{needDateStart:!0,abs:!1})*T[r],l=r===a.DAY||r===a.HOUR?t*o:(t+1)*o,u=()=>{if((r===a.YEAR||r===a.QUARTER)&&e&&s){const f=_(e).format("YYYY-MM"),p=_(s).format("YYYY-MM");return f===p&&l<90?`${_(e).format("MM/DD")} - ${_(s).format("DD")}`:i.exports.jsxs(i.exports.Fragment,{children:[i.exports.jsx("span",{children:_(e).format("MM/DD")}),i.exports.jsx("span",{children:_(s).format("MM/DD")})]})}else if(ne(r)){const f=o;let p=C(e).date,d=C(s).date;return(r===a.WEEK||r===a.BIWEEK)&&(p=`\u5468${Ce[C(e).day]}  ${C(e).date}`,d=`\u5468${Ce[C(s).day]}  ${C(s).date}`),i.exports.jsxs(i.exports.Fragment,{children:[i.exports.jsx("div",{className:"inline-flex h-full items-center justify-center text-black",style:{width:f},children:p}),d!==p&&i.exports.jsx("div",{className:"inline-flex h-full items-center justify-center text-black",style:{width:f},children:d})]})}};return i.exports.jsx("div",{className:U("absolute top-1.5 flex h-6 justify-between rounded-xl",r===a.YEAR||r===a.QUARTER?"bg-[#F7F7F7] px-1 text-black ":"bg-black/10"),style:{left:c,minWidth:l},children:u()})};var xe=(e=>(e.left="left",e.right="right",e))(xe||{});const Nt=["left","right"],xs=e=>{const t=e.getBoundingClientRect(),n=e.cloneNode(!0);n.style.inset="0";const r=document.createElement("div");return r.style.position="fixed",r.style.width=`${t.width}px`,r.style.height=`${t.height}px`,r.style.top=`${t.top}px`,r.style.left=`${t.left}px`,r.style.opacity="0.5",r.style.zIndex="100",r.appendChild(n),document.body.appendChild(r),r},gt=(e,t,n)=>{let r,s=0;const o=e.getBoundingClientRect();t.forEach(l=>{var p;if(l.dataset.recordId===He)return;const u=l.getBoundingClientRect();(p=l.lastElementChild)!=null&&p.classList.contains("indicator")&&l.lastElementChild.remove();const f=kt(o,u);f>s&&(s=f,r=l)});const c=document.createElement("div");return c.classList.add("indicator"),c.style.position="absolute",c.style.zIndex="10",c.style.width="100%",c.style.height="4px",c.style.backgroundColor="rgba(0, 0, 0, 0.3)",r&&r.dataset.recordId!==n&&r.appendChild(c),r},gs=x.exports.memo(e=>{const{id:t,recordEndTime:n,recordStartTime:r,card:s}=e,{container:o,datesContainer:c,timelineDates:l,timelineDatesRef:u,draggingRecordId:f,scrollContainer:p,zoomLevel:d}=P(),{setRecords:g}=ge(),{rafX:b,autoScrollX:D}=Jt(),{rafY:m,autoScrollY:y}=Vt(),[v,h]=x.exports.useState(),[w,E]=x.exports.useState(),[R,O]=x.exports.useState(),M=x.exports.useRef({x:0,y:0});if(!r||!n)return null;const S=T[d],W=d===a.DAY||d===a.HOUR,Q=L=>{L.preventDefault(),M.current={x:L.clientX,y:L.clientY};const I=o.current,ae=s.current,Y=p.current,G=c.current;if(!I||!ae||!Y||!G)return;const ee=getComputedStyle(ae),ie=parseInt(ee.getPropertyValue("width"),10),ve=L.currentTarget.getBoundingClientRect(),le=L.clientX-ve.left;let q={x:L.clientX,y:L.clientY},F,H=!1,N,B;const ye=$=>{if(q={x:$.clientX,y:$.clientY},!H){if(Math.abs($.clientX-M.current.x)<5&&Math.abs($.clientY-M.current.y)<5)return;H=!0,f.current=t,N=xs(ae)}D($.clientX,I),y({y:$.clientY,container:Y});const Z=I.getBoundingClientRect(),ce=I.scrollLeft+$.clientX-Z.x-le,ue=Math.round(ce/S);if(F=u.current[0]+ue*K(d),E(F),!N)return;N.style.transform=`translate(${$.clientX-M.current.x}px, ${$.clientY-M.current.y}px)`;const Me=I.querySelectorAll(".record-line-container [data-record-id]");B=gt(N,Me,t)},z=()=>{var $;Y.removeEventListener("scroll",De),I.removeEventListener("scroll",De),document.removeEventListener("mousemove",ye),document.removeEventListener("mouseup",z),cancelAnimationFrame(b.id),cancelAnimationFrame(m.id),E(void 0),N==null||N.remove(),f.current=void 0,B&&(($=B.lastElementChild)==null?void 0:$.classList.contains("indicator"))&&B.lastElementChild.remove(),H&&g(Z=>{const ce=Z.findIndex(te=>te.id===t),ue=Z.findIndex(te=>te.id===(B==null?void 0:B.dataset.recordId)),Me=Z.map(te=>te.id===t?{id:t,recordStartTime:F,recordEndTime:F+(W?ie/S:ie/S-1)*K(d)}:te);return Zt(Me,ce,ue)})},De=()=>{const $=I.getBoundingClientRect(),Z=I.scrollLeft+q.x-$.x-le,ce=Math.round(Z/S);if(F=u.current[0]+ce*K(d),E(F),!N)return;N.style.transform=`translate(${q.x-M.current.x}px, ${q.y-M.current.y}px)`;const ue=I.querySelectorAll(".record-line-container [data-record-id]");B=gt(N,ue,t)};I.addEventListener("scroll",De),Y.addEventListener("scroll",De),document.addEventListener("mousemove",ye),document.addEventListener("mouseup",z)},Ct=(L,I)=>{L.preventDefault(),L.stopPropagation();const ae=c.current,Y=o.current;if(!Y||!ae)return;O(I);const G=I===xe.left;let ee,ie=L.clientX;const ve=H=>{const N=Y.getBoundingClientRect(),B=Y.scrollLeft+H-N.x,ye=G||W?Math.round(B/S):Math.round(B/S)-1,z=u.current[0]+ye*K(d);!z||(G&&z<=n||!G&&z>=r)&&(ee=z,h(z))},le=H=>{!n||!r||(ie=H.clientX,f.current=t,D(H.clientX,Y),ve(H.clientX))},q=()=>{cancelAnimationFrame(b.id),O(void 0),h(void 0),f.current=void 0,ee&&(g(H=>H.map(N=>N.id===t?{id:t,recordStartTime:G?ee:N.recordStartTime,recordEndTime:G?N.recordEndTime:ee}:N)),Y.removeEventListener("scroll",F),document.removeEventListener("mousemove",le),document.removeEventListener("mouseup",q))},F=()=>ve(ie);Y.addEventListener("scroll",F),document.addEventListener("mousemove",le),document.addEventListener("mouseup",q)};if(!r||!n)return null;let V=r,he=n;v&&(R===xe.left?V=v:he=v);const me=j(he,V,d,{needDateStart:!0}),_t=j(V,l[0],d,{needDateStart:!0,abs:!1})*S,Ot=W?Math.max(me*S,10):(me+1)*S;return i.exports.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center overflow-hidden",children:[i.exports.jsxs("div",{ref:s,onMouseDown:Q,className:"record-card absolute z-10 flex h-[34px] cursor-pointer items-center whitespace-nowrap rounded border bg-white pl-2",style:{left:_t,width:Ot,boxShadow:"0px 1px 3px rgba(0, 0, 0, 0.06)"},children:[t.slice(0,8),i.exports.jsx("div",{className:U("card-tip absolute left-full translate-x-2 opacity-0",(v||w)&&"hidden"),children:W?i.exports.jsxs(i.exports.Fragment,{children:[_(V).format(Ke),"-",_(he).format(Ke)]}):i.exports.jsxs(i.exports.Fragment,{children:[_(V).format(Re),"-",_(he).format(Re),"\u5171",me+1,"\u5929"]})}),Nt.map(L=>i.exports.jsxs("div",{className:U("group absolute z-10 h-full w-[9px] rounded-full px-[3px] py-1.5 hover:cursor-col-resize",R&&R!==L&&"pointer-events-none",L==="left"?"-left-1":"-right-1"),onMouseDown:I=>Ct(I,L),children:[i.exports.jsx("span",{className:U("inline-block h-full w-[3px] rounded-full group-hover:bg-black",R===L&&"bg-black")}),R===L&&v&&i.exports.jsx("div",{className:U("text-t4 absolute top-1.5 flex items-center rounded bg-white px-1",L==="left"?"right-3":"left-3"),children:W?_(Yt(v)).format("MM/DD HH:mm"):_(v).format("MM/DD")})]},L))]}),c.current&&(v||w)&&mt.exports.createPortal(i.exports.jsx(St,{startTime:w!=null?w:V,unitLength:me}),c.current)]})},J),hs=x.exports.memo(({recordId:e,card:t})=>{var D;const{records:n}=ge(),{zoomLevel:r,setTimelineDates:s,container:o,scrollLeft:c,stepLength:l}=P(),[u,f]=x.exports.useState({left:!1,right:!1}),p=n.find(m=>m.id===e);if(x.exports.useEffect(()=>{const m=o.current,y=t.current;if(!m||!y)return;const v=()=>{const h=y.getBoundingClientRect(),w=m.getBoundingClientRect();(u.left!==h.left<w.left||u.right!==h.right>w.right)&&f({left:h.left<w.left,right:h.right>w.right})};return m.addEventListener("scroll",v),()=>m.removeEventListener("scroll",v)},[t,o,u.left,u.right]),x.exports.useEffect(()=>{var m;(m=o.current)==null||m.dispatchEvent(new Event("scroll"))},[(D=o.current)==null?void 0:D.clientWidth,o]),!p)return null;const{recordStartTime:d,recordEndTime:g}=p;if(!d||!g)return null;const b=m=>{if(!o.current)return;const y=100,v=m===xe.left,h=pe({zoomLevel:r,base:v?d:g,length:l.current});v?c.current=j(d,h[0],r)*T[r]-y:c.current=j(g,h[0],r)*T[r]-(o.current.clientWidth-y),s(h),f({left:v?!1:u.left,right:v?u.right:!1})};return i.exports.jsx(i.exports.Fragment,{children:Nt.map(m=>{if(!o.current)return null;const y=m===xe.right,v=y?u.right:u.left;return i.exports.jsxs("button",{onClick:()=>b(m),className:"group sticky z-20 flex h-full cursor-pointer items-center rounded transition-all duration-200",style:{left:y?o.current.clientWidth-32:0,opacity:v?1:0,transform:v?"scale(1)":"scale(0)"},children:[i.exports.jsx(er,{className:U("rounded bg-black/30 text-white",y&&"rotate-180")}),i.exports.jsxs("span",{className:U("text-t4 pointer-events-none absolute flex items-center rounded border bg-white px-1 text-black opacity-0 group-hover:opacity-100",y?"right-6":"left-6"),children:[_(d).format(Re),i.exports.jsx(tr,{}),_(Math.max(d,g)).format(Re)]})]},m)})})},J),ms=({movingStartDate:e,recordId:t})=>{const{timelineDates:n,zoomLevel:r}=P();return i.exports.jsxs("div",{className:"pointer-events-none absolute top-0.5 flex h-[34px] items-center whitespace-nowrap rounded bg-green-100 px-1.5",style:{width:de[r]*T[r],left:j(e,n[0],r)*T[r]},children:[i.exports.jsx("span",{children:"+"}),i.exports.jsx("span",{className:"text-t2 ml-2",children:t===He?"\u65B0\u5EFA":"\u65B0\u5EFA\u4E8B\u9879"})]})},ht=x.exports.memo(e=>{const{id:t,recordEndTime:n,recordStartTime:r,recordIndex:s}=e,{setRecords:o}=ge(),{timelineDatesRef:c,container:l,datesContainer:u,draggingRecordId:f,zoomLevel:p}=P(),d=x.exports.useRef(null),[g,b]=x.exports.useState(),D=p===a.DAY||p===a.HOUR,m=x.exports.useCallback(w=>{if(r&&n)return;const E=l.current;if(!u.current||!E||f.current)return;const O=E.getBoundingClientRect(),M=E.scrollLeft+w.clientX-O.x,S=Math.floor(M/T[p]);b(c.current[0]+S*K(p))},[l,u,f,n,r,p,c]),y=x.exports.useCallback(()=>{b(void 0)},[]),v=x.exports.useCallback(()=>{if(g){const w=g,E=w+(D?de[p]:de[p]-1)*K(p);o(t===He?R=>R.concat({id:rr()}):R=>R.map(O=>O.id===t?{id:t,recordStartTime:w,recordEndTime:E}:O)),b(void 0)}},[t,D,g,o,p]),h=r&&n;return x.exports.useMemo(()=>i.exports.jsxs("div",{"data-record-id":t,onMouseMove:m,onMouseLeave:y,onClick:v,className:U("absolute flex h-10 w-full",!h&&"cursor-pointer"),style:{top:s*re},children:[g&&i.exports.jsx(ms,{recordId:t,movingStartDate:g}),h&&i.exports.jsxs(i.exports.Fragment,{children:[i.exports.jsx(hs,{recordId:t,card:d}),i.exports.jsx(gs,{id:t,recordEndTime:n,recordStartTime:r,card:d})]}),u.current&&g&&mt.exports.createPortal(i.exports.jsx(St,{startTime:g,unitLength:D?de[p]:de[p]-1}),u.current)]}),[t,m,y,v,h,s,g,n,r,u,D,p])},J),Os=(e,t)=>{const n=T[e];let r=t.length*n;if(e===a.YEAR){const s=t[t.length-1],o=vs(s);r=(j(o,t[0],e)+1)*n}else e===a.QUARTER?r=7*t.length*n:e===a.DAY&&(r=4*t.length*n);return r},vs=e=>new Date(e).setMonth(new Date(e).getMonth()+1,0),Is=e=>{const{records:t}=ge();return t.find(n=>n.id===e)},$s=()=>{const[e,t]=x.exports.useState(a.MONTH),n=x.exports.useRef(Tt[e]),r=pe({zoomLevel:e,length:n.current}),[s,o]=x.exports.useState(r),c=x.exports.useRef(null),l=x.exports.useRef(null),u=x.exports.useRef(),f=x.exports.useRef(s),p=x.exports.useRef(),d=x.exports.useRef(null),g=x.exports.useRef(null),b=x.exports.useRef(null),D=x.exports.useRef(null),[m,y]=x.exports.useState(new Array(10).fill(1).map((w,E)=>({id:String(E+1),recordStartTime:be(Date.now())+Xe,recordEndTime:be(Date.now())+Xe}))),v=x.exports.useMemo(()=>{const w=T[e];let E=s.length*w;if(e===a.YEAR){const R=s[s.length-1],O=new Date(R).setMonth(new Date(R).getMonth()+1,0);E=(j(O,s[0],e)+1)*w}else e===a.QUARTER?E=7*s.length*w:e===a.HOUR?E=w*s.length:e===a.DAY&&(E=4*w*s.length);return{containerWidth:E,zoomLevel:e,setZoomLevel:t,timelineDatesRef:f,stepLength:n,timelineDates:s,setTimelineDates:o,container:c,scrollContainer:l,scrollLeft:u,datesContainer:d,timelineHeader:g,monthContainer:b,listRef:D,draggingRecordId:p}},[e,s]),h=x.exports.useMemo(()=>({records:m,setRecords:y}),[m]);return f.current=s,i.exports.jsx(jt.Provider,{value:v,children:i.exports.jsx(Lt.Provider,{value:h,children:i.exports.jsx(ys,{})})})},ys=()=>{var v;const{zoomLevel:e,timelineDates:t,setTimelineDates:n,container:r,scrollContainer:s,datesContainer:o,timelineHeader:c,monthContainer:l,scrollLeft:u,listRef:f,stepLength:p,containerWidth:d,timelineDatesRef:g}=P(),{records:b}=ge(),[D,m]=x.exports.useState([0,Math.min(window.innerHeight/re,b.length)]),y=T[e];return x.exports.useLayoutEffect(()=>{!r.current||(r.current.scrollLeft=(r.current.scrollWidth-r.current.clientWidth)/2)},[r]),x.exports.useLayoutEffect(()=>{!r.current||!u.current||(r.current.scrollLeft=u.current,u.current=void 0)},[t,r,u]),x.exports.useEffect(()=>{if(!!r.current&&r.current.scrollWidth<r.current.clientWidth*2){p.current=Math.ceil(p.current*1.5);const h=pe({zoomLevel:e,length:p.current});n(h),u.current=j(Date.now(),h[0],e)*y-r.current.clientWidth/2}},[(v=r.current)==null?void 0:v.clientWidth]),x.exports.useEffect(()=>{if(!r.current||!o.current)return;const h=r.current,w=()=>{if(!(typeof u.current!="undefined"||!r.current)){if(h.scrollWidth-h.scrollLeft-h.clientWidth<xt){const R=g.current,O=j(R[p.current],R[0],e)*T[e];u.current=r.current.scrollLeft-O,n(M=>{const S=rs(M),W=Qe({zoomLevel:e,base:S,length:p.current,dir:Ge.NEXT}),Q=[...M.slice(p.current),...W];return console.log(Q),Q})}if(h.scrollLeft<xt){const R=g.current,O=j(R[R.length-1],R[p.current-1],e)*T[e];u.current=r.current.scrollLeft+O,n(M=>{const S=M[0],Q=[...Qe({zoomLevel:e,base:S,length:p.current,dir:Ge.PREV}),...ns(M,p.current)];return console.log(Q),Q})}}},E=ss?nr(w):w;return h.addEventListener("scroll",E),()=>h.removeEventListener("scroll",E)},[r,u,p,o,n,e,g]),x.exports.useEffect(()=>{const h=s.current,w=f.current;if(!h||!w)return;const E=()=>{const R=w.getBoundingClientRect(),O=h.getBoundingClientRect(),M=Math.ceil(h.clientHeight/re)+10,S=O.top-R.top,W=Math.max(Math.floor(S/re)-5,0);m([W,W+M])};return E(),h.addEventListener("scroll",E),()=>{h.removeEventListener("scroll",E)}},[f,s]),i.exports.jsxs("div",{className:"timeline-page relative w-full overflow-scroll text-gray-600",style:{height:"calc(100% - 40px)"},ref:s,children:[i.exports.jsx(ps,{ref:c}),i.exports.jsxs("div",{className:"relative w-full overflow-auto pb-[40px]",ref:r,children:[i.exports.jsx(us,{ref:l}),i.exports.jsx(cs,{}),i.exports.jsx(ds,{}),i.exports.jsxs("div",{className:"record-line-container relative",ref:f,style:{width:d,height:b.length*re+re},children:[b.slice(D[0],D[1]).map((h,w)=>i.exports.jsx(ht,ze({recordIndex:D[0]+w},h),h.id)),i.exports.jsx(ht,{id:os,recordIndex:b.length})]})]})]})};export{ys as TimeLine,$s as default,Os as getContainerWidth,vs as getMonthLastDate,Is as useRecord};
