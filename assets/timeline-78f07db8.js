import{Q as J,S as Ae,T as ue,U as P,W as K,X as Ce,Y as re,Z as We,$ as Ye,e as l,b as X,a0 as W,a as F,p as B,_ as S,a1 as ie,h as Q,a2 as ze,a3 as j,a4 as he,a5 as we,a6 as Ie,a7 as Se,a8 as Ue,a9 as He,aa as Oe,ab as De,ac as le,V as Ee,ad as ce,ae,af as fe,ag as ke,ah as xe,ai as pe}from"./calendar-c06bd7ad.js";import{i as q,d as Be,l as $e,a as Xe}from"./lodash-6a49fb5a.js";import{B as Fe,a as Ke}from"./pdf-800cd449.js";import"./canvas-a9b0b7c8.js";var o=(t=>(t.MONTH="month",t.QUARTER="quarter",t.YEAR="year",t.BIWEEK="biWeek",t.WEEK="week",t.DAY="day",t.HOUR="hour",t))(o||{});const _=t=>t==="month"||t==="week"||t==="biWeek",de=({base:t=Date.now(),dir:r=J.NEXT,length:n=100,includeBase:e=!1,zoomLevel:s="month"})=>{const a=[],h=r===J.NEXT;if(_(s)||s==="quarter"){let i=P(t);s==="quarter"&&(i-=new Date(t).getDay()*K);const u=s==="quarter"?K*7:K,f=e?n:n+1;for(let c=0;c<f;c++)if(!(!e&&c===0))if(h){const d=i+c*u;a.push(d)}else{const d=i-c*u;a.unshift(d)}}else if(s==="year"){const i=new Date(t),u=P(i.setDate(1));if(e)a.push(u);else{const f=new Date(u).getMonth();a.push(new Date(u).setMonth(h?f+1:f-1,1))}for(let f=0;f<n-1;f++)if(h){const c=a[a.length-1],d=new Date(c).getMonth();a.push(new Date(c).setMonth(d+1,1))}else{const c=a[0],d=new Date(c).getMonth();a.unshift(new Date(c).setMonth(d-1,1))}}else if(s==="day"||s==="hour"){const i=s==="day"?Ce(t):ue(t),u=s==="day"?4*re:re,f=e?n:n+1;for(let c=0;c<f;c++)if(!(!e&&c===0))if(h){const d=i+c*u;a.push(d)}else{const d=i-c*u;a.unshift(d)}}return a},oe=({zoomLevel:t,length:r,base:n})=>[...de({base:n,dir:J.PREV,zoomLevel:t,length:r}),...de({base:n,dir:J.NEXT,zoomLevel:t,length:r,includeBase:!0})],C=t=>{const r=new Date(t);return{year:r.getFullYear(),month:r.getMonth()+1,date:r.getDate(),day:r.getDay(),monthDesc:Ae[r.getMonth()],time:t}},Qe=[31,28,31,30,31,30,31,31,30,31,30,31],Pe=t=>{const r=new Date(t),n=r.getFullYear(),e=r.getMonth();return e===1?n%4===0&&n%100!==0||n%400===0?29:28:Qe[e]},T=(t,r,n,e)=>{const{needDateStart:s=!1,abs:a=!0}=e??{};let h=0;return n==="hour"||n==="day"?h=(s?ue(t)-ue(r):t-r)/re:h=(s?P(t)-P(r):t-r)/K,a?Math.abs(h):h},_e=typeof navigator<"u"&&/iPhone/i.test(navigator.userAgent),je="NewRecordPlaceholderId",G=40,Re=300,y={[o.DAY]:20,[o.HOUR]:90,[o.MONTH]:40,[o.WEEK]:160,[o.BIWEEK]:80,[o.QUARTER]:20,[o.YEAR]:5},ne={[o.HOUR]:4,[o.DAY]:12,[o.MONTH]:5,[o.WEEK]:1,[o.BIWEEK]:3,[o.QUARTER]:14,[o.YEAR]:28},Le={[o.HOUR]:100,[o.DAY]:100,[o.MONTH]:100,[o.BIWEEK]:50,[o.WEEK]:25,[o.QUARTER]:25,[o.YEAR]:25},$=t=>t===o.DAY||t===o.HOUR?re:K,qe=[{name:"年",zoomLevel:o.YEAR},{name:"季",zoomLevel:o.QUARTER},{name:"月",zoomLevel:o.MONTH},{name:"周",zoomLevel:o.WEEK},{name:"双周",zoomLevel:o.BIWEEK},{name:"天",zoomLevel:o.DAY},{name:"小时",zoomLevel:o.HOUR}],me="NewRecordPlaceholderId",Me=We(void 0),z=()=>{const t=Ye(Me);if(!t)throw new Error("useBitable");return t},ye=()=>{const{timelineDates:t,zoomLevel:r}=z(),n=r===o.HOUR||r===o.DAY,[e,s]=B(0),a=S(),h=ie(()=>n?(new Date().setSeconds(0,0)-t[0])/re*y[r]:T(Date.now(),t[0],r,{abs:!1})*y[r],[n,r,t]);return Q(()=>(s(h()),a.current=setInterval(()=>s(h()),ze),()=>{a.current&&clearInterval(a.current)}),[h]),e},Ve=()=>{const{timelineDates:t,zoomLevel:r}=z(),n=r===o.HOUR||r===o.DAY,e=ye();if(Date.now()>t[t.length-1]||Date.now()<t[0])return null;let s=e;return _(r)&&(s=T(Date.now(),t[0],r,{abs:!1,needDateStart:!0})*y[r]+y[r]/2),l(F,{children:[l("span",{style:{left:s},className:X("absolute top-1.5 z-10 inline-flex -translate-x-1/2 items-center justify-center rounded-full px-1",n?"top-2 bg-green-200 text-red-500":"h-6 w-6 bg-red-400 text-white"),children:n?W(new Date).format("HH:mm"):new Date().getDate()}),l("span",{style:{left:e},className:"absolute -bottom-2 h-2 w-2 -translate-x-1/2 -translate-y-1/2 rounded-full bg-red-400"})]})},Ge=()=>{const{timelineDates:t}=z(),r=ye();return Date.now()>t[t.length-1]||Date.now()<t[0]?null:l("div",{style:{left:r,height:"calc(100% - 76px)"},className:"absolute bottom-0 top-[76px] w-px bg-red-600"})},Je=j(()=>{const{timelineDates:t,datesContainer:r,zoomLevel:n,containerWidth:e}=z(),s=y[n],a=h=>{let i=0,u="";return _(n)?(n===o.WEEK||n===o.BIWEEK?u=`周${he[C(h).day]}  ${C(h).date}`:u=C(h).date,i=s):n===o.YEAR?(u=`${C(h).month}月`,i=s*Pe(h)):n===o.QUARTER?(u=`${C(h).date}`,i=7*s):n===o.DAY?(u=W(new Date(h)).format("HH:00"),i=s*4):n===o.HOUR&&(u=W(new Date(h)).format("HH:mm"),i=s),l("div",{className:X("inline-flex h-full items-center",n!==o.DAY&&n!==o.HOUR&&n!==o.QUARTER&&"justify-center"),style:{width:i},children:n===o.DAY||n===o.HOUR||n===o.QUARTER?l("span",{className:"-translate-x-1/2",children:[" ",u]}):u},h)};return l("div",{ref:r,className:X("text-grey4 text-t2-medium relative z-10 h-[38px] border-b bg-white font-medium"),style:{width:e},children:[t.map(a),l(Ve,{})]})},q),Ze=j(we((t,r)=>{const{timelineDates:n,zoomLevel:e,containerWidth:s}=z(),a=y[e],h=(i,u)=>{let f=!1,c="",d=0;return _(e)?(f=new Date(i).getDate()===1,c=`${new Date(i).getMonth()+1}月`,d=u*a):e===o.YEAR?(f=new Date(i).setMonth(0,1)===i,c=`${new Date(i).getFullYear()}年`,d=T(i,n[0],e)*a):e===o.QUARTER?new Date(i).getMonth()!==new Date(i+6*K).getMonth()&&(f=!0,c=`${new Date(i+6*K).getMonth()+1}月`,d=(T(i,n[0],e)+(7-new Date(i+6*K).getDate()))*a):(e===o.DAY||e===o.HOUR)&&(f=P(i)===i,c=`${new Date(i).getMonth()+1}月${new Date(i).getDate()}日`,d=T(i,n[0],e)*a),f?l("div",{style:{left:d},className:"absolute inline-flex h-full flex-shrink-0 items-center justify-center",children:c},i):null};return l("div",{className:"timeline-month relative z-10 h-[38px] border-t bg-white",style:{width:s},ref:r,children:n.map(h)})}),q),et=j(()=>{const{timelineDates:t,containerWidth:r,zoomLevel:n}=z(),e=y[n];return l("div",{className:"absolute top-0 h-full",style:{width:r},children:[t.map(s=>{const a=T(s,t[0],n)*e;return n===o.YEAR||n===o.DAY||n===o.HOUR||n===o.QUARTER?l("div",{style:{left:a},className:"absolute h-full w-[1px] bg-[#d8dee4]"},s):n===o.WEEK||n===o.BIWEEK?l("div",{style:{left:a,width:e},className:X("absolute h-full",(C(s).day===6||C(s).day===0)&&"bg-gray-200")},s):C(s).day===6?l("div",{style:{left:a,width:e*2},className:"absolute flex h-full flex-shrink-0 flex-col items-center justify-center bg-gray-200"},s):null}),l(Ge,{})]})},q),tt=we((t,r)=>{const{timelineDates:n,container:e,setTimelineDates:s,stepLength:a,scrollLeft:h,zoomLevel:i,setZoomLevel:u}=z(),[f,c]=B();return Q(()=>{const d=e.current;if(!d)return;const p=()=>{const R=Math.floor(d.scrollLeft/y[i]),D=n[0]+R*$(i);c(w=>{let v=0;return _(i)||i===o.QUARTER?v=new Date(D).setDate(1):i===o.YEAR?v=new Date(D).setMonth(0,1):(i===o.DAY||i===o.HOUR)&&(v=P(D)),v!==w?v:w})};return p(),d.addEventListener("scroll",p),()=>d.removeEventListener("scroll",p)},[e,i,n]),l("div",{className:"absolute left-0 right-0 top-1 z-50 flex h-8 items-center",ref:r,children:[l("div",{className:"flex h-full",children:[f&&l("span",{className:"inline-flex h-full items-center bg-white",children:[C(f).year,"年",(_(i)||i===o.QUARTER)&&l(F,{children:[C(f).month,"月"]}),(i===o.DAY||i===o.HOUR)&&l(F,{children:[C(f).date,"日"]})]}),l("span",{className:"h-full w-10",style:{backgroundImage:"linear-gradient(to right, white 20%, rgba(255, 255, 255, 0) 100%)"}})]}),l("div",{className:"ml-auto flex items-center",children:[l("span",{className:"inline-block h-8 w-10",style:{backgroundImage:"linear-gradient(to left, white 20%, rgba(255, 255, 255, 0) 100%)"}}),l("div",{className:"flex items-center bg-white",children:[qe.map(d=>l("button",{onClick:()=>{if(!e.current)return;a.current=Le[d.zoomLevel];const p=oe({zoomLevel:d.zoomLevel,length:a.current});u(d.zoomLevel),s(p),h.current=T(Date.now(),p[0],d.zoomLevel)*y[d.zoomLevel]-e.current.clientWidth/2},children:d.name},d.zoomLevel)),l("button",{onClick:()=>{e.current&&(e.current.scrollLeft-=e.current.clientWidth/2)},children:l(Ie,{className:"h-5 w-5"})}),l("button",{className:"cursor-pointer bg-white px-2",onClick:()=>{if(!e.current)return;const d=oe({zoomLevel:i,length:a.current});s(d),h.current=T(Date.now(),d[0],i)*y[i]-e.current.clientWidth/2},children:"今天"}),l("button",{onClick:()=>{e.current&&(e.current.scrollLeft+=e.current.clientWidth/2)},children:l(Se,{className:"h-5 w-5"})})]})]})]})}),nt=j(tt,q),Ne=({startTime:t,unitLength:r})=>{const{timelineDates:n,zoomLevel:e}=z(),s=t+r*$(e),a=y[e],h=T(t,n[0],e,{needDateStart:!0,abs:!1})*y[e],i=e===o.DAY||e===o.HOUR?r*a:(r+1)*a,u=()=>{if((e===o.YEAR||e===o.QUARTER)&&t&&s){const f=W(t).format("YYYY-MM"),c=W(s).format("YYYY-MM");return f===c&&i<90?`${W(t).format("MM/DD")} - ${W(s).format("DD")}`:l(F,{children:[l("span",{children:W(t).format("MM/DD")}),l("span",{children:W(s).format("MM/DD")})]})}else if(_(e)){const f=a;let c=C(t).date,d=C(s).date;return(e===o.WEEK||e===o.BIWEEK)&&(c=`周${he[C(t).day]}  ${C(t).date}`,d=`周${he[C(s).day]}  ${C(s).date}`),l(F,{children:[l("div",{className:"inline-flex h-full items-center justify-center text-black",style:{width:f},children:c}),d!==c&&l("div",{className:"inline-flex h-full items-center justify-center text-black",style:{width:f},children:d})]})}};return l("div",{className:X("absolute top-1.5 flex h-6 justify-between rounded-xl",e===o.YEAR||e===o.QUARTER?"bg-[#F7F7F7] px-1 text-black ":"bg-black/10"),style:{left:h,minWidth:i},children:u()})};var Z=(t=>(t.left="left",t.right="right",t))(Z||{});const rt=["left","right"],ot=t=>{const r=t.getBoundingClientRect(),n=t.cloneNode(!0);n.style.inset="0";const e=document.createElement("div");return e.style.position="fixed",e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,e.style.top=`${r.top}px`,e.style.left=`${r.left}px`,e.style.opacity="0.5",e.style.zIndex="100",e.appendChild(n),document.body.appendChild(e),e},st=(t,r,n)=>{let e,s=0;const a=t.getBoundingClientRect();r.forEach(i=>{var c;if(i.dataset.recordId===me)return;const u=i.getBoundingClientRect();(c=i.lastElementChild)!=null&&c.classList.contains("indicator")&&i.lastElementChild.remove();const f=Ue(a,u);f>s&&(s=f,e=i)});const h=document.createElement("div");return h.classList.add("indicator"),h.style.position="absolute",h.style.zIndex="10",h.style.width="100%",h.style.height="4px",h.style.backgroundColor="rgba(0, 0, 0, 0.3)",e&&e.dataset.recordId!==n&&e.appendChild(h),e},it=(t,r,n,e,s,a,h,i)=>{const{autoScrollX:u,rafX:f}=He(),{autoScrollY:c,rafY:d}=Oe(),{cardNode:p,containerNode:R,timelinePage:D}=r,w=g=>{const m=g.target;if(!m)return;if(m.className.includes("resize-left")||m.className.includes("resize-right")){const N=m.className.includes("resize-left");n(N?Z.left:Z.right),L(g,N)}else v(g)},v=g=>{g.preventDefault();const m={x:g.clientX,y:g.clientY},E=g.currentTarget.getBoundingClientRect(),N=g.clientX-E.left;let M={x:g.clientX,y:g.clientY},A=!1,x,b;const U=O=>{if(M={x:O.clientX,y:O.clientY},!A){if(Math.abs(O.clientX-m.x)<5&&Math.abs(O.clientY-m.y)<5)return;A=!0,a(),x=ot(p)}u(O.clientX,R),c({y:O.clientY,container:D}),V()},H=()=>{var ee;if(D.removeEventListener("scroll",V),R.removeEventListener("scroll",V),document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",H),cancelAnimationFrame(f.id),cancelAnimationFrame(d.id),x==null||x.remove(),b&&((ee=b.lastElementChild)!=null&&ee.classList.contains("indicator"))&&b.lastElementChild.remove(),!A)return;const O=R.getBoundingClientRect(),se=R.scrollLeft+M.x-O.x-N;i(se,b==null?void 0:b.dataset.recordId)},V=()=>{const O=R.getBoundingClientRect(),se=R.scrollLeft+M.x-O.x-N;if(h(se),!x)return;x.style.transform=`translate(${M.x-m.x}px, ${M.y-m.y}px)`;const ee=R.querySelectorAll(".record-line-container [data-record-id]");b=st(x,ee,t)};R.addEventListener("scroll",V),D.addEventListener("scroll",V),document.addEventListener("mousemove",U),document.addEventListener("mouseup",H)},L=(g,m)=>{g.preventDefault(),g.stopPropagation();let E=g.clientX;const N=x=>{E=x.clientX,u(x.clientX,R),A()},M=()=>{R.removeEventListener("scroll",A),document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",M),cancelAnimationFrame(f.id);const x=R.getBoundingClientRect(),b=R.scrollLeft+E-x.x;s(b,m)},A=()=>{const x=R.getBoundingClientRect(),b=R.scrollLeft+E-x.x;e(b,m)};R.addEventListener("scroll",A),document.addEventListener("mousemove",N),document.addEventListener("mouseup",M)};return p.addEventListener("mousedown",w),()=>{p.removeEventListener("mousedown",w)}},lt=j(t=>{const{id:r,endTime:n,startTime:e,card:s}=t,{container:a,datesContainer:h,timelineDates:i,timelineDatesRef:u,draggingRecordId:f,scrollContainer:c,zoomLevel:d}=z(),[p,R]=B(),[D,w]=B(),[v,L]=B(),g=y[d],m=d===o.DAY||d===o.HOUR;if(Q(()=>{const b=s.current,U=a.current,H=c.current;if(!b||!U||!H)return;const be=it(r,{cardNode:b,containerNode:U,timelinePage:H},k=>{f.current=r,L(k)},(k,I)=>{const te=I||m?Math.round(k/g):Math.round(k/g)-1,Y=u.current[0]+te*$(d);(I&&Y<=P(n)||!I&&Y>=P(e))&&R(Y)},(k,I)=>{f.current=void 0,L(void 0),R(void 0);const te=I||m?Math.round(k/g):Math.round(k/g)-1;let Y=u.current[0]+te*$(d);I&&Y>n&&(Y=n),!I&&Y<e&&(Y=e),ce(ae.update({uuid:r,patch:{startTime:I?Y:e,endTime:I?n:Y}}))},()=>{f.current=r},k=>{const I=Math.round(k/g);w(u.current[0]+I*$(d))},(k,I)=>{w(void 0),f.current=void 0;const te=Math.round(k/g),Y=u.current[0]+te*$(d),Te=getComputedStyle(b),ge=parseInt(Te.getPropertyValue("width"),10);ce(ae.update({uuid:r,patch:{startTime:Y,endTime:Y+(m?ge/g:ge/g-1)*$(d)}}))});return()=>{be()}},[r,s,a,c,f,m,n,e,u,g,d]),!e||!n||!e||!n)return null;let E=e,N=n;p&&(v===Z.left?E=p:N=p);const M=T(N,E,d,{needDateStart:!0}),A=T(E,i[0],d,{needDateStart:!0,abs:!1})*g,x=m?Math.max(M*g,10):(M+1)*g;return l("div",{className:"absolute left-0 top-0 flex h-full w-full items-center overflow-hidden",children:[l("div",{ref:s,className:"record-card absolute z-10 flex h-[34px] cursor-pointer items-center whitespace-nowrap rounded border bg-white pl-2",style:{left:A,width:x,boxShadow:"0px 1px 3px rgba(0, 0, 0, 0.06)"},children:[r.slice(0,8),l("div",{className:X("card-tip absolute left-full translate-x-2 opacity-0",(p||D)&&"hidden"),children:m?l(F,{children:[W(E).format(De),"-",W(N).format(De)]}):l(F,{children:[W(E).format(le),"-",W(N).format(le),"共",M+1,"天"]})}),l("div",{className:"resize-left",children:l("div",{className:"resize-left-inner"})}),l("div",{className:"resize-right",children:l("div",{className:"resize-right-inner"})})]}),h.current&&(p||D)&&Ee(l(Ne,{startTime:D??E,unitLength:M}),h.current)]})},q),ct=j(({recordId:t,card:r})=>{var R;const n=fe(({todo:D})=>D[t]),{zoomLevel:e,setTimelineDates:s,container:a,scrollLeft:h,stepLength:i}=z(),[u,f]=B({left:!1,right:!1});if(Q(()=>{const D=a.current,w=r.current;if(!D||!w)return;const v=()=>{const L=w.getBoundingClientRect(),g=D.getBoundingClientRect();(u.left!==L.left<g.left||u.right!==L.right>g.right)&&f({left:L.left<g.left,right:L.right>g.right})};return D.addEventListener("scroll",v),()=>D.removeEventListener("scroll",v)},[r,a,u.left,u.right]),Q(()=>{var D;(D=a.current)==null||D.dispatchEvent(new Event("scroll"))},[(R=a.current)==null?void 0:R.clientWidth,a]),!n)return null;const{startTime:c,endTime:d}=n;if(!c||!d)return null;const p=D=>{if(!a.current)return;const w=100,v=D===Z.left,L=oe({zoomLevel:e,base:v?c:d,length:i.current});v?h.current=T(c,L[0],e)*y[e]-w:h.current=T(d,L[0],e)*y[e]-(a.current.clientWidth-w),s(L),f({left:v?!1:u.left,right:v?u.right:!1})};return l(F,{children:rt.map(D=>{if(!a.current)return null;const w=D===Z.right,v=w?u.right:u.left;return l("button",{onClick:()=>p(D),className:"group sticky z-20 flex h-full cursor-pointer items-center rounded transition-all duration-200",style:{left:w?a.current.clientWidth-32:0,opacity:v?1:0,transform:v?"scale(1)":"scale(0)"},children:[l(Fe,{className:X("rounded bg-black/30 text-white",w&&"rotate-180")}),l("span",{className:X("text-t4 pointer-events-none absolute flex items-center rounded border bg-white px-1 text-black opacity-0 group-hover:opacity-100",w?"right-6":"left-6"),children:[W(c).format(le),l(Ke,{}),W(Math.max(c,d)).format(le)]})]},D)})})},q),at=({movingStartDate:t,recordId:r})=>{const{timelineDates:n,zoomLevel:e}=z();return l("div",{className:"pointer-events-none absolute top-0.5 flex h-[34px] items-center whitespace-nowrap rounded bg-green-100 px-1.5",style:{width:ne[e]*y[e],left:T(t,n[0],e)*y[e]},children:[l("span",{children:"+"}),l("span",{className:"text-t2 ml-2",children:r===me?"新建":"新建事项"})]})},ve=j(t=>{const{id:r,recordIndex:n}=t,e=fe(({todo:m})=>m[r]),{endTime:s,startTime:a}=e??{},{timelineDatesRef:h,container:i,datesContainer:u,draggingRecordId:f,zoomLevel:c}=z(),d=S(null),[p,R]=B(),D=c===o.DAY||c===o.HOUR,w=ie(m=>{if(a&&s)return;const E=i.current;if(!u.current||!E||f.current)return;const M=E.getBoundingClientRect(),A=E.scrollLeft+m.clientX-M.x,x=Math.floor(A/y[c]);R(h.current[0]+x*$(c))},[i,u,f,s,a,c,h]),v=ie(()=>{R(void 0)},[]),L=ie(()=>{if(p){const m=p,E=m+(D?ne[c]:ne[c]-1)*$(c);r===me?ce(ae.add({id:ke(),startTime:Date.now(),endTime:Date.now()})):ce(ae.update({uuid:r,patch:{startTime:m,endTime:E}})),R(void 0)}},[r,D,p,c]),g=a&&s;return xe(()=>l("div",{"data-record-id":r,onMouseMove:w,onMouseLeave:v,onClick:L,className:X("absolute flex h-10 w-full",!g&&"cursor-pointer"),style:{top:n*G},children:[p&&l(at,{recordId:r,movingStartDate:p}),g&&l(F,{children:[l(ct,{recordId:r,card:d}),l(lt,{id:r,endTime:s,startTime:a,card:d})]}),u.current&&p&&Ee(l(Ne,{startTime:p,unitLength:D?ne[c]:ne[c]-1}),u.current)]}),[r,w,v,L,g,n,p,s,a,u,D,c])},q),Rt=(t,r)=>{const n=y[t];let e=r.length*n;if(t===o.YEAR){const s=r[r.length-1],a=dt(s);e=(T(a,r[0],t)+1)*n}else t===o.QUARTER?e=7*r.length*n:t===o.DAY&&(e=4*r.length*n);return e},dt=t=>new Date(t).setMonth(new Date(t).getMonth()+1,0),vt=()=>{const[t,r]=B(o.MONTH),n=S(Le[t]),e=oe({zoomLevel:t,length:n.current}),[s,a]=B(e),h=S(null),i=S(null),u=S(),f=S(s),c=S(),d=S(null),p=S(null),R=S(null),D=S(null),w=xe(()=>{const v=y[t];let L=s.length*v;if(t===o.YEAR){const g=s[s.length-1],m=new Date(g).setMonth(new Date(g).getMonth()+1,0);L=(T(m,s[0],t)+1)*v}else t===o.QUARTER?L=7*s.length*v:t===o.HOUR?L=v*s.length:t===o.DAY&&(L=4*v*s.length);return{containerWidth:L,zoomLevel:t,setZoomLevel:r,timelineDatesRef:f,stepLength:n,timelineDates:s,setTimelineDates:a,container:h,scrollContainer:i,scrollLeft:u,datesContainer:d,timelineHeader:p,monthContainer:R,listRef:D,draggingRecordId:c}},[t,s]);return f.current=s,l(Me.Provider,{value:w,children:l(ut,{})})},ut=()=>{var g;const{zoomLevel:t,timelineDates:r,setTimelineDates:n,container:e,scrollContainer:s,datesContainer:a,timelineHeader:h,monthContainer:i,scrollLeft:u,listRef:f,stepLength:c,containerWidth:d,timelineDatesRef:p}=z(),R=fe(m=>m.todo),D=Object.keys(R),[w,v]=B([0,Math.min(window.innerHeight/G,D.length)]),L=y[t];return pe(()=>{e.current&&(e.current.scrollLeft=(e.current.scrollWidth-e.current.clientWidth)/2)},[e]),pe(()=>{!e.current||!u.current||(e.current.scrollLeft=u.current,u.current=void 0)},[r,e,u]),Q(()=>{if(e.current&&e.current.scrollWidth<e.current.clientWidth*2){c.current=Math.ceil(c.current*1.5);const m=oe({zoomLevel:t,length:c.current});n(m),u.current=T(Date.now(),m[0],t)*L-e.current.clientWidth/2}},[(g=e.current)==null?void 0:g.clientWidth]),Q(()=>{if(!e.current||!a.current)return;const m=e.current,E=()=>{if(!(typeof u.current<"u"||!e.current)){if(m.scrollWidth-m.scrollLeft-m.clientWidth<Re){const M=p.current,A=T(M[c.current],M[0],t)*y[t];u.current=e.current.scrollLeft-A,n(x=>{const b=$e(x),U=de({zoomLevel:t,base:b,length:c.current,dir:J.NEXT}),H=[...x.slice(c.current),...U];return console.log(H),H})}if(m.scrollLeft<Re){const M=p.current,A=T(M[M.length-1],M[c.current-1],t)*y[t];u.current=e.current.scrollLeft+A,n(x=>{const b=x[0],H=[...de({zoomLevel:t,base:b,length:c.current,dir:J.PREV}),...Xe(x,c.current)];return console.log(H),H})}}},N=_e?Be(E):E;return m.addEventListener("scroll",N),()=>m.removeEventListener("scroll",N)},[e,u,c,a,n,t,p]),Q(()=>{const m=s.current,E=f.current;if(!m||!E)return;const N=()=>{const M=E.getBoundingClientRect(),A=m.getBoundingClientRect(),x=Math.ceil(m.clientHeight/G)+10,b=A.top-M.top,U=Math.max(Math.floor(b/G)-5,0);v([U,U+x])};return N(),m.addEventListener("scroll",N),()=>{m.removeEventListener("scroll",N)}},[f,s]),l("div",{className:"timeline-page relative w-full overflow-scroll text-gray-600",style:{height:"calc(100% - 40px)"},ref:s,children:[l(nt,{ref:h}),l("div",{className:"relative w-full overflow-auto pb-[40px]",ref:e,children:[l(Ze,{ref:i}),l(Je,{}),l(et,{}),l("div",{className:"record-line-container relative",ref:f,style:{width:d,height:D.length*G+G},children:[D.slice(w[0],w[1]).map((m,E)=>l(ve,{recordIndex:w[0]+E,id:m},m)),l(ve,{id:je,recordIndex:D.length})]})]})]})};export{ut as TimeLine,vt as default,Rt as getContainerWidth,dt as getMonthLastDate};
