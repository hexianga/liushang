var $e=Object.defineProperty;var ve=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var we=(t,r,n)=>r in t?$e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,Le=(t,r)=>{for(var n in r||(r={}))Xe.call(r,n)&&we(t,n,r[n]);if(ve)for(var n of ve(r))Pe.call(r,n)&&we(t,n,r[n]);return t};import{r as i,j as o,b as Se}from"./index.71e6e6b0.js";import{Z as s,f as Ie,O as me,h as ee,j as M,l as Ke,e as q,W as Re,m as C,n as Qe,g as he,o as le,c as pe,p as ye,q as ge,D as Ye,r as _e,s as be,t as Me,u as je}from"./type.8140856d.js";import{d as S}from"./dayjs.min.9bf2e87d.js";import{c as O}from"./index.06721ba9.js";import{A as qe,a as Ve}from"./index.esm.a271cff3.js";import{a as Ze}from"./sortable.esm.aa87f66e.js";import{g as Ge,u as Je,b as et}from"./intersection-ratio.15c8905b.js";import{f as tt,g as rt}from"./index.esm.3beba3d3.js";import{v as nt}from"./v4.90f1a8cc.js";import{t as st,d as ot}from"./debounce.056170eb.js";import"./_arrayPush.07a2d375.js";import"./isObject.e74fdd39.js";import"./_commonjsHelpers.294d03c4.js";import"./index.563d4b32.js";var Ne=1/0,ct=17976931348623157e292;function lt(t){if(!t)return t===0?t:0;if(t=st(t),t===Ne||t===-Ne){var r=t<0?-1:1;return r*ct}return t===t?t:0}function it(t){var r=lt(t),n=r%1;return r===r?n?r-n:r:0}function at(t,r,n){var e=-1,c=t.length;r<0&&(r=-r>c?0:c+r),n=n>c?c:n,n<0&&(n+=c),c=r>n?0:n-r>>>0,r>>>=0;for(var a=Array(c);++e<c;)a[e]=t[e+r];return a}function ut(t){var r=t==null?0:t.length;return r?t[r-1]:void 0}function dt(t,r,n){var e=t==null?0:t.length;return e?(r=n||r===void 0?1:it(r),r=e-r,at(t,0,r<0?0:r)):[]}const ft=typeof navigator!="undefined"&&/iPhone/i.test(navigator.userAgent),xt="NewRecordPlaceholderId",J=40,Ae=300,w={[s.DAY]:20,[s.HOUR]:90,[s.MONTH]:40,[s.WEEK]:160,[s.BIWEEK]:80,[s.QUARTER]:20,[s.YEAR]:5},ce={[s.HOUR]:4,[s.DAY]:12,[s.MONTH]:5,[s.WEEK]:1,[s.BIWEEK]:3,[s.QUARTER]:14,[s.YEAR]:28},We={[s.HOUR]:100,[s.DAY]:100,[s.MONTH]:100,[s.BIWEEK]:50,[s.WEEK]:25,[s.QUARTER]:25,[s.YEAR]:25},X=t=>t===s.DAY||t===s.HOUR?Ie:me,mt=[{name:"\u5E74",zoomLevel:s.YEAR},{name:"\u5B63",zoomLevel:s.QUARTER},{name:"\u6708",zoomLevel:s.MONTH},{name:"\u5468",zoomLevel:s.WEEK},{name:"\u53CC\u5468",zoomLevel:s.BIWEEK},{name:"\u5929",zoomLevel:s.DAY},{name:"\u5C0F\u65F6",zoomLevel:s.HOUR}],Ee="NewRecordPlaceholderId";typeof navigator!="undefined"&&/iPhone/i.test(navigator.userAgent);const He=i.exports.createContext(void 0),ie=()=>{const t=i.exports.useContext(He);if(!t)throw new Error("RecordDataContext \u4E0D\u5B58\u5728");return t},Oe=i.exports.createContext(void 0),H=()=>{const t=i.exports.useContext(Oe);if(!t)throw new Error("useBitable");return t},Ue=()=>{const{timelineDates:t,zoomLevel:r}=H(),n=r===s.HOUR||r===s.DAY,[e,c]=i.exports.useState(0),a=i.exports.useRef(),x=i.exports.useCallback(()=>n?(new Date().setSeconds(0,0)-t[0])/Ie*w[r]:M(Date.now(),t[0],r,{abs:!1})*w[r],[n,r,t]);return i.exports.useEffect(()=>(c(x()),a.current=setInterval(()=>c(x()),Ke),()=>{a.current&&clearInterval(a.current)}),[x]),e},ht=()=>{const{timelineDates:t,zoomLevel:r}=H(),n=r===s.HOUR||r===s.DAY,e=Ue();if(Date.now()>t[t.length-1]||Date.now()<t[0])return null;let c=e;return ee(r)&&(c=M(Date.now(),t[0],r,{abs:!1,needDateStart:!0})*w[r]+w[r]/2),o.exports.jsxs(o.exports.Fragment,{children:[o.exports.jsx("span",{style:{left:c},className:O("absolute top-1.5 z-10 inline-flex -translate-x-1/2 items-center justify-center rounded-full px-1",n?"top-2 bg-green-200 text-red-500":"h-6 w-6 bg-red-400 text-white"),children:n?S(new Date).format("HH:mm"):new Date().getDate()}),o.exports.jsx("span",{style:{left:e},className:"absolute -bottom-2 h-2 w-2 -translate-x-1/2 -translate-y-1/2 rounded-full bg-red-400"})]})},pt=()=>{const{timelineDates:t}=H(),r=Ue();return Date.now()>t[t.length-1]||Date.now()<t[0]?null:o.exports.jsx("div",{style:{left:r,height:"calc(100% - 76px)"},className:"absolute bottom-0 top-[76px] w-px bg-red-600"})},gt=i.exports.memo(()=>{const{timelineDates:t,datesContainer:r,zoomLevel:n,containerWidth:e}=H(),c=w[n],a=x=>{let l=0,d="";return ee(n)?(n===s.WEEK||n===s.BIWEEK?d=`\u5468${Re[C(x).day]}  ${C(x).date}`:d=C(x).date,l=c):n===s.YEAR?(d=`${C(x).month}\u6708`,l=c*Qe(x)):n===s.QUARTER?(d=`${C(x).date}`,l=7*c):n===s.DAY?(d=S(new Date(x)).format("HH:00"),l=c*4):n===s.HOUR&&(d=S(new Date(x)).format("HH:mm"),l=c),o.exports.jsx("div",{className:O("inline-flex h-full items-center",n!==s.DAY&&n!==s.HOUR&&n!==s.QUARTER&&"justify-center"),style:{width:l},children:n===s.DAY||n===s.HOUR||n===s.QUARTER?o.exports.jsxs("span",{className:"-translate-x-1/2",children:[" ",d]}):d},x)};return o.exports.jsxs("div",{ref:r,className:O("text-grey4 text-t2-medium relative z-10 h-[38px] border-b bg-white font-medium"),style:{width:e},children:[t.map(a),o.exports.jsx(ht,{})]})},q),Dt=i.exports.memo(i.exports.forwardRef((t,r)=>{const{timelineDates:n,zoomLevel:e,containerWidth:c}=H(),a=w[e],x=(l,d)=>{let m=!1,f="",u=0;return ee(e)?(m=new Date(l).getDate()===1,f=`${new Date(l).getMonth()+1}\u6708`,u=d*a):e===s.YEAR?(m=new Date(l).setMonth(0,1)===l,f=`${new Date(l).getFullYear()}\u5E74`,u=M(l,n[0],e)*a):e===s.QUARTER?new Date(l).getMonth()!==new Date(l+6*me).getMonth()&&(m=!0,f=`${new Date(l+6*me).getMonth()+1}\u6708`,u=(M(l,n[0],e)+(7-new Date(l+6*me).getDate()))*a):(e===s.DAY||e===s.HOUR)&&(m=he(l)===l,f=`${new Date(l).getMonth()+1}\u6708${new Date(l).getDate()}\u65E5`,u=M(l,n[0],e)*a),m?o.exports.jsx("div",{style:{left:u},className:"absolute inline-flex h-full flex-shrink-0 items-center justify-center",children:f},l):null};return o.exports.jsx("div",{className:"timeline-month relative z-10 h-[38px] border-t bg-white",style:{width:c},ref:r,children:n.map(x)})}),q),Rt=i.exports.memo(()=>{const{timelineDates:t,containerWidth:r,zoomLevel:n}=H(),e=w[n];return o.exports.jsxs("div",{className:"absolute top-0 h-full",style:{width:r},children:[t.map(c=>{const a=M(c,t[0],n)*e;return n===s.YEAR||n===s.DAY||n===s.HOUR||n===s.QUARTER?o.exports.jsx("div",{style:{left:a},className:"absolute h-full w-[1px] bg-[#d8dee4]"},c):n===s.WEEK||n===s.BIWEEK?o.exports.jsx("div",{style:{left:a,width:e},className:O("absolute h-full",(C(c).day===6||C(c).day===0)&&"bg-gray-200")},c):C(c).day===6?o.exports.jsx("div",{style:{left:a,width:e*2},className:"absolute flex h-full flex-shrink-0 flex-col items-center justify-center bg-gray-200"},c):null}),o.exports.jsx(pt,{})]})},q),Et=i.exports.forwardRef((t,r)=>{const{timelineDates:n,container:e,setTimelineDates:c,stepLength:a,scrollLeft:x,zoomLevel:l,setZoomLevel:d}=H(),[m,f]=i.exports.useState();return i.exports.useEffect(()=>{const u=e.current;if(!u)return;const p=()=>{const j=Math.floor(u.scrollLeft/w[l]),y=n[0]+j*X(l);f(D=>{let E=0;return ee(l)||l===s.QUARTER?E=new Date(y).setDate(1):l===s.YEAR?E=new Date(y).setMonth(0,1):(l===s.DAY||l===s.HOUR)&&(E=he(y)),E!==D?E:D})};return p(),u.addEventListener("scroll",p),()=>u.removeEventListener("scroll",p)},[e,l,n]),o.exports.jsxs("div",{className:"absolute left-0 right-0 top-1 z-50 flex h-8 items-center",ref:r,children:[o.exports.jsxs("div",{className:"flex h-full",children:[m&&o.exports.jsxs("span",{className:"inline-flex h-full items-center bg-white",children:[C(m).year,"\u5E74",(ee(l)||l===s.QUARTER)&&o.exports.jsxs(o.exports.Fragment,{children:[C(m).month,"\u6708"]}),(l===s.DAY||l===s.HOUR)&&o.exports.jsxs(o.exports.Fragment,{children:[C(m).date,"\u65E5"]})]}),o.exports.jsx("span",{className:"h-full w-10",style:{backgroundImage:"linear-gradient(to right, white 20%, rgba(255, 255, 255, 0) 100%)"}})]}),o.exports.jsxs("div",{className:"ml-auto flex items-center",children:[o.exports.jsx("span",{className:"inline-block h-8 w-10",style:{backgroundImage:"linear-gradient(to left, white 20%, rgba(255, 255, 255, 0) 100%)"}}),o.exports.jsxs("div",{className:"flex items-center bg-white",children:[mt.map(u=>o.exports.jsx("button",{onClick:()=>{if(!e.current)return;a.current=We[u.zoomLevel];const p=le({zoomLevel:u.zoomLevel,length:a.current});d(u.zoomLevel),c(p),x.current=M(Date.now(),p[0],u.zoomLevel)*w[u.zoomLevel]-e.current.clientWidth/2},children:u.name},u.zoomLevel)),o.exports.jsx("button",{onClick:()=>{e.current&&(e.current.scrollLeft-=e.current.clientWidth/2)},children:o.exports.jsx(qe,{className:"h-5 w-5"})}),o.exports.jsx("button",{className:"cursor-pointer bg-white px-2",onClick:()=>{if(!e.current)return;const u=le({zoomLevel:l,length:a.current});c(u),x.current=M(Date.now(),u[0],l)*w[l]-e.current.clientWidth/2},children:"\u4ECA\u5929"}),o.exports.jsx("button",{onClick:()=>{e.current&&(e.current.scrollLeft+=e.current.clientWidth/2)},children:o.exports.jsx(Ve,{className:"h-5 w-5"})})]})]})]})}),vt=i.exports.memo(Et,q),ze=({startTime:t,unitLength:r})=>{const{timelineDates:n,zoomLevel:e}=H(),c=t+r*X(e),a=w[e],x=M(t,n[0],e,{needDateStart:!0,abs:!1})*w[e],l=e===s.DAY||e===s.HOUR?r*a:(r+1)*a,d=()=>{if((e===s.YEAR||e===s.QUARTER)&&t&&c){const m=S(t).format("YYYY-MM"),f=S(c).format("YYYY-MM");return m===f&&l<90?`${S(t).format("MM/DD")} - ${S(c).format("DD")}`:o.exports.jsxs(o.exports.Fragment,{children:[o.exports.jsx("span",{children:S(t).format("MM/DD")}),o.exports.jsx("span",{children:S(c).format("MM/DD")})]})}else if(ee(e)){const m=a;let f=C(t).date,u=C(c).date;return(e===s.WEEK||e===s.BIWEEK)&&(f=`\u5468${Re[C(t).day]}  ${C(t).date}`,u=`\u5468${Re[C(c).day]}  ${C(c).date}`),o.exports.jsxs(o.exports.Fragment,{children:[o.exports.jsx("div",{className:"inline-flex h-full items-center justify-center text-black",style:{width:m},children:f}),u!==f&&o.exports.jsx("div",{className:"inline-flex h-full items-center justify-center text-black",style:{width:m},children:u})]})}};return o.exports.jsx("div",{className:O("absolute top-1.5 flex h-6 justify-between rounded-xl",e===s.YEAR||e===s.QUARTER?"bg-[#F7F7F7] px-1 text-black ":"bg-black/10"),style:{left:x,minWidth:l},children:d()})},wt=t=>{const r=t.getBoundingClientRect(),n=t.cloneNode(!0);n.style.inset="0";const e=document.createElement("div");return e.style.position="fixed",e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,e.style.top=`${r.top}px`,e.style.left=`${r.left}px`,e.style.opacity="0.5",e.style.zIndex="100",e.appendChild(n),document.body.appendChild(e),e},Te=(t,r,n)=>{let e,c=0;const a=t.getBoundingClientRect();r.forEach(l=>{var f;if(l.dataset.recordId===Ee)return;const d=l.getBoundingClientRect();(f=l.lastElementChild)!=null&&f.classList.contains("indicator")&&l.lastElementChild.remove();const m=Ge(a,d);m>c&&(c=m,e=l)});const x=document.createElement("div");return x.classList.add("indicator"),x.style.position="absolute",x.style.zIndex="10",x.style.width="100%",x.style.height="4px",x.style.backgroundColor="rgba(0, 0, 0, 0.3)",e&&e.dataset.recordId!==n&&e.appendChild(x),e},Lt=i.exports.memo(t=>{const{id:r,recordEndTime:n,recordStartTime:e,card:c}=t,{container:a,datesContainer:x,timelineDates:l,timelineDatesRef:d,draggingRecordId:m,scrollContainer:f,zoomLevel:u}=H(),{setRecords:p}=ie(),{rafX:j,autoScrollX:y}=Je(),{rafY:D,autoScrollY:E}=et(),[R,h]=i.exports.useState(),[g,v]=i.exports.useState(),[L,I]=i.exports.useState(),N=i.exports.useRef({x:0,y:0});if(!e||!n)return null;const A=w[u],U=u===s.DAY||u===s.HOUR,P=b=>{b.preventDefault(),N.current={x:b.clientX,y:b.clientY};const Y=a.current,te=c.current,z=f.current,K=x.current;if(!Y||!te||!z||!K)return;const Z=getComputedStyle(te),re=parseInt(Z.getPropertyValue("width"),10),de=b.currentTarget.getBoundingClientRect(),ne=b.clientX-de.left;let Q={x:b.clientX,y:b.clientY},F,k=!1,T,B;const fe=W=>{if(Q={x:W.clientX,y:W.clientY},!k){if(Math.abs(W.clientX-N.current.x)<5&&Math.abs(W.clientY-N.current.y)<5)return;k=!0,m.current=r,T=wt(te)}y(W.clientX,Y),E({y:W.clientY,container:z});const _=Y.getBoundingClientRect(),se=Y.scrollLeft+W.clientX-_.x-ne,oe=Math.round(se/A);if(F=d.current[0]+oe*X(u),v(F),!T)return;T.style.transform=`translate(${W.clientX-N.current.x}px, ${W.clientY-N.current.y}px)`;const De=Y.querySelectorAll(".record-line-container [data-record-id]");B=Te(T,De,r)},$=()=>{var W;z.removeEventListener("scroll",xe),Y.removeEventListener("scroll",xe),document.removeEventListener("mousemove",fe),document.removeEventListener("mouseup",$),cancelAnimationFrame(j.id),cancelAnimationFrame(D.id),v(void 0),T==null||T.remove(),m.current=void 0,B&&((W=B.lastElementChild)==null?void 0:W.classList.contains("indicator"))&&B.lastElementChild.remove(),k&&p(_=>{const se=_.findIndex(G=>G.id===r),oe=_.findIndex(G=>G.id===(B==null?void 0:B.dataset.recordId)),De=_.map(G=>G.id===r?{id:r,recordStartTime:F,recordEndTime:F+(U?re/A:re/A-1)*X(u)}:G);return Ze(De,se,oe)})},xe=()=>{const W=Y.getBoundingClientRect(),_=Y.scrollLeft+Q.x-W.x-ne,se=Math.round(_/A);if(F=d.current[0]+se*X(u),v(F),!T)return;T.style.transform=`translate(${Q.x-N.current.x}px, ${Q.y-N.current.y}px)`;const oe=Y.querySelectorAll(".record-line-container [data-record-id]");B=Te(T,oe,r)};Y.addEventListener("scroll",xe),z.addEventListener("scroll",xe),document.addEventListener("mousemove",fe),document.addEventListener("mouseup",$)},ke=(b,Y)=>{b.preventDefault(),b.stopPropagation();const te=x.current,z=a.current;if(!z||!te)return;I(Y);const K=Y===pe.left;let Z,re=b.clientX;const de=k=>{const T=z.getBoundingClientRect(),B=z.scrollLeft+k-T.x,fe=K||U?Math.round(B/A):Math.round(B/A)-1,$=d.current[0]+fe*X(u);!$||(K&&$<=n||!K&&$>=e)&&(Z=$,h($))},ne=k=>{!n||!e||(re=k.clientX,m.current=r,y(k.clientX,z),de(k.clientX))},Q=()=>{cancelAnimationFrame(j.id),I(void 0),h(void 0),m.current=void 0,Z&&(p(k=>k.map(T=>T.id===r?{id:r,recordStartTime:K?Z:T.recordStartTime,recordEndTime:K?T.recordEndTime:Z}:T)),z.removeEventListener("scroll",F),document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",Q))},F=()=>de(re);z.addEventListener("scroll",F),document.addEventListener("mousemove",ne),document.addEventListener("mouseup",Q)};if(!e||!n)return null;let V=e,ae=n;R&&(L===pe.left?V=R:ae=R);const ue=M(ae,V,u,{needDateStart:!0}),Be=M(V,l[0],u,{needDateStart:!0,abs:!1})*A,Fe=U?Math.max(ue*A,10):(ue+1)*A;return o.exports.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center overflow-hidden",children:[o.exports.jsxs("div",{ref:c,onMouseDown:P,className:"record-card absolute z-10 flex h-[34px] cursor-pointer items-center whitespace-nowrap rounded border bg-white pl-2",style:{left:Be,width:Fe,boxShadow:"0px 1px 3px rgba(0, 0, 0, 0.06)"},children:[r.slice(0,8),o.exports.jsx("div",{className:O("card-tip absolute left-full translate-x-2 opacity-0",(R||g)&&"hidden"),children:U?o.exports.jsxs(o.exports.Fragment,{children:[S(V).format(ye),"-",S(ae).format(ye)]}):o.exports.jsxs(o.exports.Fragment,{children:[S(V).format(ge),"-",S(ae).format(ge),"\u5171",ue+1,"\u5929"]})}),Ye.map(b=>o.exports.jsxs("div",{className:O("group absolute z-10 h-full w-[9px] rounded-full px-[3px] py-1.5 hover:cursor-col-resize",L&&L!==b&&"pointer-events-none",b==="left"?"-left-1":"-right-1"),onMouseDown:Y=>ke(Y,b),children:[o.exports.jsx("span",{className:O("inline-block h-full w-[3px] rounded-full group-hover:bg-black",L===b&&"bg-black")}),L===b&&R&&o.exports.jsx("div",{className:O("text-t4 absolute top-1.5 flex items-center rounded bg-white px-1",b==="left"?"right-3":"left-3"),children:U?S(_e(R)).format("MM/DD HH:mm"):S(R).format("MM/DD")})]},b))]}),x.current&&(R||g)&&Se.exports.createPortal(o.exports.jsx(ze,{startTime:g!=null?g:V,unitLength:ue}),x.current)]})},q),yt=i.exports.memo(({recordId:t,card:r})=>{var y;const{records:n}=ie(),{zoomLevel:e,setTimelineDates:c,container:a,scrollLeft:x,stepLength:l}=H(),[d,m]=i.exports.useState({left:!1,right:!1}),f=n.find(D=>D.id===t);if(i.exports.useEffect(()=>{const D=a.current,E=r.current;if(!D||!E)return;const R=()=>{const h=E.getBoundingClientRect(),g=D.getBoundingClientRect();(d.left!==h.left<g.left||d.right!==h.right>g.right)&&m({left:h.left<g.left,right:h.right>g.right})};return D.addEventListener("scroll",R),()=>D.removeEventListener("scroll",R)},[r,a,d.left,d.right]),i.exports.useEffect(()=>{var D;(D=a.current)==null||D.dispatchEvent(new Event("scroll"))},[(y=a.current)==null?void 0:y.clientWidth,a]),!f)return null;const{recordStartTime:u,recordEndTime:p}=f;if(!u||!p)return null;const j=D=>{if(!a.current)return;const E=100,R=D===pe.left,h=le({zoomLevel:e,base:R?u:p,length:l.current});R?x.current=M(u,h[0],e)*w[e]-E:x.current=M(p,h[0],e)*w[e]-(a.current.clientWidth-E),c(h),m({left:R?!1:d.left,right:R?d.right:!1})};return o.exports.jsx(o.exports.Fragment,{children:Ye.map(D=>{if(!a.current)return null;const E=D===pe.right,R=E?d.right:d.left;return o.exports.jsxs("button",{onClick:()=>j(D),className:"group sticky z-20 flex h-full cursor-pointer items-center rounded transition-all duration-200",style:{left:E?a.current.clientWidth-32:0,opacity:R?1:0,transform:R?"scale(1)":"scale(0)"},children:[o.exports.jsx(tt,{className:O("rounded bg-black/30 text-white",E&&"rotate-180")}),o.exports.jsxs("span",{className:O("text-t4 pointer-events-none absolute flex items-center rounded border bg-white px-1 text-black opacity-0 group-hover:opacity-100",E?"right-6":"left-6"),children:[S(u).format(ge),o.exports.jsx(rt,{}),S(Math.max(u,p)).format(ge)]})]},D)})})},q),bt=({movingStartDate:t,recordId:r})=>{const{timelineDates:n,zoomLevel:e}=H();return o.exports.jsxs("div",{className:"pointer-events-none absolute top-0.5 flex h-[34px] items-center whitespace-nowrap rounded bg-green-100 px-1.5",style:{width:ce[e]*w[e],left:M(t,n[0],e)*w[e]},children:[o.exports.jsx("span",{children:"+"}),o.exports.jsx("span",{className:"text-t2 ml-2",children:r===Ee?"\u65B0\u5EFA":"\u65B0\u5EFA\u4E8B\u9879"})]})},Ce=i.exports.memo(t=>{const{id:r,recordEndTime:n,recordStartTime:e,recordIndex:c}=t,{setRecords:a}=ie(),{timelineDatesRef:x,container:l,datesContainer:d,draggingRecordId:m,zoomLevel:f}=H(),u=i.exports.useRef(null),[p,j]=i.exports.useState(),y=f===s.DAY||f===s.HOUR,D=i.exports.useCallback(g=>{if(e&&n)return;const v=l.current;if(!d.current||!v||m.current)return;const I=v.getBoundingClientRect(),N=v.scrollLeft+g.clientX-I.x,A=Math.floor(N/w[f]);j(x.current[0]+A*X(f))},[l,d,m,n,e,f,x]),E=i.exports.useCallback(()=>{j(void 0)},[]),R=i.exports.useCallback(()=>{if(p){const g=p,v=g+(y?ce[f]:ce[f]-1)*X(f);a(r===Ee?L=>L.concat({id:nt()}):L=>L.map(I=>I.id===r?{id:r,recordStartTime:g,recordEndTime:v}:I)),j(void 0)}},[r,y,p,a,f]),h=e&&n;return i.exports.useMemo(()=>o.exports.jsxs("div",{"data-record-id":r,onMouseMove:D,onMouseLeave:E,onClick:R,className:O("absolute flex h-10 w-full",!h&&"cursor-pointer"),style:{top:c*J},children:[p&&o.exports.jsx(bt,{recordId:r,movingStartDate:p}),h&&o.exports.jsxs(o.exports.Fragment,{children:[o.exports.jsx(yt,{recordId:r,card:u}),o.exports.jsx(Lt,{id:r,recordEndTime:n,recordStartTime:e,card:u})]}),d.current&&p&&Se.exports.createPortal(o.exports.jsx(ze,{startTime:p,unitLength:y?ce[f]:ce[f]-1}),d.current)]}),[r,D,E,R,h,c,p,n,e,d,y,f])},q),$t=(t,r)=>{const n=w[t];let e=r.length*n;if(t===s.YEAR){const c=r[r.length-1],a=Mt(c);e=(M(a,r[0],t)+1)*n}else t===s.QUARTER?e=7*r.length*n:t===s.DAY&&(e=4*r.length*n);return e},Mt=t=>new Date(t).setMonth(new Date(t).getMonth()+1,0),Xt=t=>{const{records:r}=ie();return r.find(n=>n.id===t)},Pt=()=>{const[t,r]=i.exports.useState(s.MONTH),n=i.exports.useRef(We[t]),e=le({zoomLevel:t,length:n.current}),[c,a]=i.exports.useState(e),x=i.exports.useRef(null),l=i.exports.useRef(null),d=i.exports.useRef(),m=i.exports.useRef(c),f=i.exports.useRef(),u=i.exports.useRef(null),p=i.exports.useRef(null),j=i.exports.useRef(null),y=i.exports.useRef(null),[D,E]=i.exports.useState(new Array(10).fill(1).map((g,v)=>({id:String(v+1),recordStartTime:he(Date.now())+be,recordEndTime:he(Date.now())+be}))),R=i.exports.useMemo(()=>{const g=w[t];let v=c.length*g;if(t===s.YEAR){const L=c[c.length-1],I=new Date(L).setMonth(new Date(L).getMonth()+1,0);v=(M(I,c[0],t)+1)*g}else t===s.QUARTER?v=7*c.length*g:t===s.HOUR?v=g*c.length:t===s.DAY&&(v=4*g*c.length);return{containerWidth:v,zoomLevel:t,setZoomLevel:r,timelineDatesRef:m,stepLength:n,timelineDates:c,setTimelineDates:a,container:x,scrollContainer:l,scrollLeft:d,datesContainer:u,timelineHeader:p,monthContainer:j,listRef:y,draggingRecordId:f}},[t,c]),h=i.exports.useMemo(()=>({records:D,setRecords:E}),[D]);return m.current=c,o.exports.jsx(Oe.Provider,{value:R,children:o.exports.jsx(He.Provider,{value:h,children:o.exports.jsx(jt,{})})})},jt=()=>{var R;const{zoomLevel:t,timelineDates:r,setTimelineDates:n,container:e,scrollContainer:c,datesContainer:a,timelineHeader:x,monthContainer:l,scrollLeft:d,listRef:m,stepLength:f,containerWidth:u,timelineDatesRef:p}=H(),{records:j}=ie(),[y,D]=i.exports.useState([0,Math.min(window.innerHeight/J,j.length)]),E=w[t];return i.exports.useLayoutEffect(()=>{!e.current||(e.current.scrollLeft=(e.current.scrollWidth-e.current.clientWidth)/2)},[e]),i.exports.useLayoutEffect(()=>{!e.current||!d.current||(e.current.scrollLeft=d.current,d.current=void 0)},[r,e,d]),i.exports.useEffect(()=>{if(!!e.current&&e.current.scrollWidth<e.current.clientWidth*2){f.current=Math.ceil(f.current*1.5);const h=le({zoomLevel:t,length:f.current});n(h),d.current=M(Date.now(),h[0],t)*E-e.current.clientWidth/2}},[(R=e.current)==null?void 0:R.clientWidth]),i.exports.useEffect(()=>{if(!e.current||!a.current)return;const h=e.current,g=()=>{if(!(typeof d.current!="undefined"||!e.current)){if(h.scrollWidth-h.scrollLeft-h.clientWidth<Ae){const L=p.current,I=M(L[f.current],L[0],t)*w[t];d.current=e.current.scrollLeft-I,n(N=>{const A=ut(N),U=Me({zoomLevel:t,base:A,length:f.current,dir:je.NEXT}),P=[...N.slice(f.current),...U];return console.log(P),P})}if(h.scrollLeft<Ae){const L=p.current,I=M(L[L.length-1],L[f.current-1],t)*w[t];d.current=e.current.scrollLeft+I,n(N=>{const A=N[0],P=[...Me({zoomLevel:t,base:A,length:f.current,dir:je.PREV}),...dt(N,f.current)];return console.log(P),P})}}},v=ft?ot(g):g;return h.addEventListener("scroll",v),()=>h.removeEventListener("scroll",v)},[e,d,f,a,n,t,p]),i.exports.useEffect(()=>{const h=c.current,g=m.current;if(!h||!g)return;const v=()=>{const L=g.getBoundingClientRect(),I=h.getBoundingClientRect(),N=Math.ceil(h.clientHeight/J)+10,A=I.top-L.top,U=Math.max(Math.floor(A/J)-5,0);D([U,U+N])};return v(),h.addEventListener("scroll",v),()=>{h.removeEventListener("scroll",v)}},[m,c]),o.exports.jsxs("div",{className:"timeline-page relative w-full overflow-scroll text-gray-600",style:{height:"calc(100% - 40px)"},ref:c,children:[o.exports.jsx(vt,{ref:x}),o.exports.jsxs("div",{className:"relative w-full overflow-auto pb-[40px]",ref:e,children:[o.exports.jsx(Dt,{ref:l}),o.exports.jsx(gt,{}),o.exports.jsx(Rt,{}),o.exports.jsxs("div",{className:"record-line-container relative",ref:m,style:{width:u,height:j.length*J+J},children:[j.slice(y[0],y[1]).map((h,g)=>o.exports.jsx(Ce,Le({recordIndex:y[0]+g},h),h.id)),o.exports.jsx(Ce,{id:xt,recordIndex:j.length})]})]})]})};export{jt as TimeLine,Pt as default,$t as getContainerWidth,Mt as getMonthLastDate,Xt as useRecord};
