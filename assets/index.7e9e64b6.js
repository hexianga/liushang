var Te=Object.defineProperty;var fe=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var he=(e,n,r)=>n in e?Te(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,me=(e,n)=>{for(var r in n||(n={}))Ce.call(n,r)&&he(e,r,n[r]);if(fe)for(var r of fe(n))Se.call(n,r)&&he(e,r,n[r]);return e};import{r as h,j as i,b as Ee}from"./index.85a07fc6.js";import{M as Ie,D as q,g as O,O as $,n as We,o as ae,c as te,d as Ye,j as K,W as ue,p as xe,q as oe,f as pe}from"./dates.121d3cc2.js";import{d as S}from"./dayjs.min.9bf2e87d.js";import{t as ze,c as F}from"./index.ddfdf970.js";import{A as He,a as Ue}from"./index.esm.51fad6fd.js";import{a as Oe}from"./sortable.esm.9b824fd1.js";import{b as ke,e as Fe,g as Be}from"./intersection-ratio.3bc624a7.js";import{f as $e,g as Pe}from"./index.esm.a2a71e28.js";import{v as Xe}from"./v4.90f1a8cc.js";import{d as Ke}from"./debounce.1053ed1f.js";import"./_arrayPush.389226df.js";import"./_commonjsHelpers.294d03c4.js";import"./index.563d4b32.js";var ge=1/0,Qe=17976931348623157e292;function _e(e){if(!e)return e===0?e:0;if(e=ze(e),e===ge||e===-ge){var n=e<0?-1:1;return n*Qe}return e===e?e:0}function qe(e){var n=_e(e),r=n%1;return n===n?r?n-r:n:0}function Ve(e,n,r){var t=-1,s=e.length;n<0&&(n=-n>s?0:s+n),r=r>s?s:r,r<0&&(r+=s),s=n>r?0:r-n>>>0,n>>>=0;for(var l=Array(s);++t<s;)l[t]=e[t+n];return l}function Ge(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}function Je(e,n,r){var t=e==null?0:e.length;return t?(n=r||n===void 0?1:qe(n),n=t-n,Ve(e,0,n<0?0:n)):[]}var o=(e=>(e.MONTH="month",e.QUARTER="quarter",e.YEAR="year",e.BIWEEK="biWeek",e.WEEK="week",e.DAY="day",e.HOUR="hour",e))(o||{});const X=e=>e==="month"||e==="week"||e==="biWeek",ie=({base:e=Date.now(),dir:n=q.NEXT,length:r=100,includeBase:t=!1,zoomLevel:s="month"})=>{const l=[],f=n===q.NEXT;if(X(s)||s==="quarter"){let c=O(e);s==="quarter"&&(c-=new Date(e).getDay()*$);const d=s==="quarter"?$*7:$,x=t?r:r+1;for(let a=0;a<x;a++)if(!(!t&&a===0))if(f){const u=c+a*d;l.push(u)}else{const u=c-a*d;l.unshift(u)}}else if(s==="year"){const c=new Date(e),d=O(c.setDate(1));if(t)l.push(d);else{const x=new Date(d).getMonth();l.push(new Date(d).setMonth(f?x+1:x-1,1))}for(let x=0;x<r-1;x++)if(f){const a=l[l.length-1],u=new Date(a).getMonth();l.push(new Date(a).setMonth(u+1,1))}else{const a=l[0],u=new Date(a).getMonth();l.unshift(new Date(a).setMonth(u-1,1))}}else if(s==="day"||s==="hour"){const c=s==="day"?We(e):ae(e),d=s==="day"?4*te:te,x=t?r:r+1;for(let a=0;a<x;a++)if(!(!t&&a===0))if(f){const u=c+a*d;l.push(u)}else{const u=c-a*d;l.unshift(u)}}return l},ne=({zoomLevel:e,length:n,base:r})=>[...ie({base:r,dir:q.PREV,zoomLevel:e,length:n}),...ie({base:r,dir:q.NEXT,zoomLevel:e,length:n,includeBase:!0})],C=e=>{const n=new Date(e);return{year:n.getFullYear(),month:n.getMonth()+1,date:n.getDate(),day:n.getDay(),monthDesc:Ie[n.getMonth()],time:e}},Ze=[31,28,31,30,31,30,31,31,30,31,30,31],et=e=>{const n=new Date(e),r=n.getFullYear(),t=n.getMonth();return t===1?r%4===0&&r%100!==0||r%400===0?29:28:Ze[t]},T=(e,n,r,t)=>{const{needDateStart:s=!1,abs:l=!0}=t!=null?t:{};let f=0;return r==="hour"||r==="day"?f=(s?ae(e)-ae(n):e-n)/te:f=(s?O(e)-O(n):e-n)/$,l?Math.abs(f):f},tt=typeof navigator!="undefined"&&/iPhone/i.test(navigator.userAgent),nt="NewRecordPlaceholderId",_=40,De=300,N={[o.DAY]:20,[o.HOUR]:90,[o.MONTH]:40,[o.WEEK]:160,[o.BIWEEK]:80,[o.QUARTER]:20,[o.YEAR]:5},ee={[o.HOUR]:4,[o.DAY]:12,[o.MONTH]:5,[o.WEEK]:1,[o.BIWEEK]:3,[o.QUARTER]:14,[o.YEAR]:28},ve={[o.HOUR]:100,[o.DAY]:100,[o.MONTH]:100,[o.BIWEEK]:50,[o.WEEK]:25,[o.QUARTER]:25,[o.YEAR]:25},k=e=>e===o.DAY||e===o.HOUR?te:$,rt=[{name:"\u5E74",zoomLevel:o.YEAR},{name:"\u5B63",zoomLevel:o.QUARTER},{name:"\u6708",zoomLevel:o.MONTH},{name:"\u5468",zoomLevel:o.WEEK},{name:"\u53CC\u5468",zoomLevel:o.BIWEEK},{name:"\u5929",zoomLevel:o.DAY},{name:"\u5C0F\u65F6",zoomLevel:o.HOUR}],de="NewRecordPlaceholderId";typeof navigator!="undefined"&&/iPhone/i.test(navigator.userAgent);const we=h.exports.createContext(void 0),re=()=>{const e=h.exports.useContext(we);if(!e)throw new Error("RecordDataContext \u4E0D\u5B58\u5728");return e},Me=h.exports.createContext(void 0),Y=()=>{const e=h.exports.useContext(Me);if(!e)throw new Error("useBitable");return e},Le=()=>{const{timelineDates:e,zoomLevel:n}=Y(),r=n===o.HOUR||n===o.DAY,[t,s]=h.exports.useState(0),l=h.exports.useRef(),f=h.exports.useCallback(()=>r?(new Date().setSeconds(0,0)-e[0])/te*N[n]:T(Date.now(),e[0],n,{abs:!1})*N[n],[r,n,e]);return h.exports.useEffect(()=>(s(f()),l.current=setInterval(()=>s(f()),Ye),()=>{l.current&&clearInterval(l.current)}),[f]),t},st=()=>{const{timelineDates:e,zoomLevel:n}=Y(),r=n===o.HOUR||n===o.DAY,t=Le();if(Date.now()>e[e.length-1]||Date.now()<e[0])return null;let s=t;return X(n)&&(s=T(Date.now(),e[0],n,{abs:!1,needDateStart:!0})*N[n]+N[n]/2),i.exports.jsxs(i.exports.Fragment,{children:[i.exports.jsx("span",{style:{left:s},className:F("absolute top-1.5 z-10 inline-flex -translate-x-1/2 items-center justify-center rounded-full px-1",r?"top-2 bg-green-200 text-red-500":"h-6 w-6 bg-red-400 text-white"),children:r?S(new Date).format("HH:mm"):new Date().getDate()}),i.exports.jsx("span",{style:{left:t},className:"absolute -bottom-2 h-2 w-2 -translate-x-1/2 -translate-y-1/2 rounded-full bg-red-400"})]})},ot=()=>{const{timelineDates:e}=Y(),n=Le();return Date.now()>e[e.length-1]||Date.now()<e[0]?null:i.exports.jsx("div",{style:{left:n,height:"calc(100% - 76px)"},className:"absolute bottom-0 top-[76px] w-px bg-red-600"})},it=h.exports.memo(()=>{const{timelineDates:e,datesContainer:n,zoomLevel:r,containerWidth:t}=Y(),s=N[r],l=f=>{let c=0,d="";return X(r)?(r===o.WEEK||r===o.BIWEEK?d=`\u5468${ue[C(f).day]}  ${C(f).date}`:d=C(f).date,c=s):r===o.YEAR?(d=`${C(f).month}\u6708`,c=s*et(f)):r===o.QUARTER?(d=`${C(f).date}`,c=7*s):r===o.DAY?(d=S(new Date(f)).format("HH:00"),c=s*4):r===o.HOUR&&(d=S(new Date(f)).format("HH:mm"),c=s),i.exports.jsx("div",{className:F("inline-flex h-full items-center",r!==o.DAY&&r!==o.HOUR&&r!==o.QUARTER&&"justify-center"),style:{width:c},children:r===o.DAY||r===o.HOUR||r===o.QUARTER?i.exports.jsxs("span",{className:"-translate-x-1/2",children:[" ",d]}):d},f)};return i.exports.jsxs("div",{ref:n,className:F("text-grey4 text-t2-medium relative z-10 h-[38px] border-b bg-white font-medium"),style:{width:t},children:[e.map(l),i.exports.jsx(st,{})]})},K),ct=h.exports.memo(h.exports.forwardRef((e,n)=>{const{timelineDates:r,zoomLevel:t,containerWidth:s}=Y(),l=N[t],f=(c,d)=>{let x=!1,a="",u=0;return X(t)?(x=new Date(c).getDate()===1,a=`${new Date(c).getMonth()+1}\u6708`,u=d*l):t===o.YEAR?(x=new Date(c).setMonth(0,1)===c,a=`${new Date(c).getFullYear()}\u5E74`,u=T(c,r[0],t)*l):t===o.QUARTER?new Date(c).getMonth()!==new Date(c+6*$).getMonth()&&(x=!0,a=`${new Date(c+6*$).getMonth()+1}\u6708`,u=(T(c,r[0],t)+(7-new Date(c+6*$).getDate()))*l):(t===o.DAY||t===o.HOUR)&&(x=O(c)===c,a=`${new Date(c).getMonth()+1}\u6708${new Date(c).getDate()}\u65E5`,u=T(c,r[0],t)*l),x?i.exports.jsx("div",{style:{left:u},className:"absolute inline-flex h-full flex-shrink-0 items-center justify-center",children:a},c):null};return i.exports.jsx("div",{className:"timeline-month relative z-10 h-[38px] border-t bg-white",style:{width:s},ref:n,children:r.map(f)})}),K),lt=h.exports.memo(()=>{const{timelineDates:e,containerWidth:n,zoomLevel:r}=Y(),t=N[r];return i.exports.jsxs("div",{className:"absolute top-0 h-full",style:{width:n},children:[e.map(s=>{const l=T(s,e[0],r)*t;return r===o.YEAR||r===o.DAY||r===o.HOUR||r===o.QUARTER?i.exports.jsx("div",{style:{left:l},className:"absolute h-full w-[1px] bg-[#d8dee4]"},s):r===o.WEEK||r===o.BIWEEK?i.exports.jsx("div",{style:{left:l,width:t},className:F("absolute h-full",(C(s).day===6||C(s).day===0)&&"bg-gray-200")},s):C(s).day===6?i.exports.jsx("div",{style:{left:l,width:t*2},className:"absolute flex h-full flex-shrink-0 flex-col items-center justify-center bg-gray-200"},s):null}),i.exports.jsx(ot,{})]})},K),at=h.exports.forwardRef((e,n)=>{const{timelineDates:r,container:t,setTimelineDates:s,stepLength:l,scrollLeft:f,zoomLevel:c,setZoomLevel:d}=Y(),[x,a]=h.exports.useState();return h.exports.useEffect(()=>{const u=t.current;if(!u)return;const D=()=>{const g=Math.floor(u.scrollLeft/N[c]),L=r[0]+g*k(c);a(R=>{let w=0;return X(c)||c===o.QUARTER?w=new Date(L).setDate(1):c===o.YEAR?w=new Date(L).setMonth(0,1):(c===o.DAY||c===o.HOUR)&&(w=O(L)),w!==R?w:R})};return D(),u.addEventListener("scroll",D),()=>u.removeEventListener("scroll",D)},[t,c,r]),i.exports.jsxs("div",{className:"absolute left-0 right-0 top-1 z-50 flex h-8 items-center",ref:n,children:[i.exports.jsxs("div",{className:"flex h-full",children:[x&&i.exports.jsxs("span",{className:"inline-flex h-full items-center bg-white",children:[C(x).year,"\u5E74",(X(c)||c===o.QUARTER)&&i.exports.jsxs(i.exports.Fragment,{children:[C(x).month,"\u6708"]}),(c===o.DAY||c===o.HOUR)&&i.exports.jsxs(i.exports.Fragment,{children:[C(x).date,"\u65E5"]})]}),i.exports.jsx("span",{className:"h-full w-10",style:{backgroundImage:"linear-gradient(to right, white 20%, rgba(255, 255, 255, 0) 100%)"}})]}),i.exports.jsxs("div",{className:"ml-auto flex items-center",children:[i.exports.jsx("span",{className:"inline-block h-8 w-10",style:{backgroundImage:"linear-gradient(to left, white 20%, rgba(255, 255, 255, 0) 100%)"}}),i.exports.jsxs("div",{className:"flex items-center bg-white",children:[rt.map(u=>i.exports.jsx("button",{onClick:()=>{if(!t.current)return;l.current=ve[u.zoomLevel];const D=ne({zoomLevel:u.zoomLevel,length:l.current});d(u.zoomLevel),s(D),f.current=T(Date.now(),D[0],u.zoomLevel)*N[u.zoomLevel]-t.current.clientWidth/2},children:u.name},u.zoomLevel)),i.exports.jsx("button",{onClick:()=>{t.current&&(t.current.scrollLeft-=t.current.clientWidth/2)},children:i.exports.jsx(He,{className:"h-5 w-5"})}),i.exports.jsx("button",{className:"cursor-pointer bg-white px-2",onClick:()=>{if(!t.current)return;const u=ne({zoomLevel:c,length:l.current});s(u),f.current=T(Date.now(),u[0],c)*N[c]-t.current.clientWidth/2},children:"\u4ECA\u5929"}),i.exports.jsx("button",{onClick:()=>{t.current&&(t.current.scrollLeft+=t.current.clientWidth/2)},children:i.exports.jsx(Ue,{className:"h-5 w-5"})})]})]})]})}),ut=h.exports.memo(at,K),ye=({startTime:e,unitLength:n})=>{const{timelineDates:r,zoomLevel:t}=Y(),s=e+n*k(t),l=N[t],f=T(e,r[0],t,{needDateStart:!0,abs:!1})*N[t],c=t===o.DAY||t===o.HOUR?n*l:(n+1)*l,d=()=>{if((t===o.YEAR||t===o.QUARTER)&&e&&s){const x=S(e).format("YYYY-MM"),a=S(s).format("YYYY-MM");return x===a&&c<90?`${S(e).format("MM/DD")} - ${S(s).format("DD")}`:i.exports.jsxs(i.exports.Fragment,{children:[i.exports.jsx("span",{children:S(e).format("MM/DD")}),i.exports.jsx("span",{children:S(s).format("MM/DD")})]})}else if(X(t)){const x=l;let a=C(e).date,u=C(s).date;return(t===o.WEEK||t===o.BIWEEK)&&(a=`\u5468${ue[C(e).day]}  ${C(e).date}`,u=`\u5468${ue[C(s).day]}  ${C(s).date}`),i.exports.jsxs(i.exports.Fragment,{children:[i.exports.jsx("div",{className:"inline-flex h-full items-center justify-center text-black",style:{width:x},children:a}),u!==a&&i.exports.jsx("div",{className:"inline-flex h-full items-center justify-center text-black",style:{width:x},children:u})]})}};return i.exports.jsx("div",{className:F("absolute top-1.5 flex h-6 justify-between rounded-xl",t===o.YEAR||t===o.QUARTER?"bg-[#F7F7F7] px-1 text-black ":"bg-black/10"),style:{left:f,minWidth:c},children:d()})};var V=(e=>(e.left="left",e.right="right",e))(V||{});const dt=["left","right"],ft=e=>{const n=e.getBoundingClientRect(),r=e.cloneNode(!0);r.style.inset="0";const t=document.createElement("div");return t.style.position="fixed",t.style.width=`${n.width}px`,t.style.height=`${n.height}px`,t.style.top=`${n.top}px`,t.style.left=`${n.left}px`,t.style.opacity="0.5",t.style.zIndex="100",t.appendChild(r),document.body.appendChild(t),t},ht=(e,n,r)=>{let t,s=0;const l=e.getBoundingClientRect();n.forEach(c=>{var a;if(c.dataset.recordId===de)return;const d=c.getBoundingClientRect();(a=c.lastElementChild)!=null&&a.classList.contains("indicator")&&c.lastElementChild.remove();const x=ke(l,d);x>s&&(s=x,t=c)});const f=document.createElement("div");return f.classList.add("indicator"),f.style.position="absolute",f.style.zIndex="10",f.style.width="100%",f.style.height="4px",f.style.backgroundColor="rgba(0, 0, 0, 0.3)",t&&t.dataset.recordId!==r&&t.appendChild(f),t},mt=(e,n,r,t,s,l,f,c)=>{const{autoScrollX:d,rafX:x}=Fe(),{autoScrollY:a,rafY:u}=Be(),{cardNode:D,containerNode:g,timelinePage:L}=n,R=m=>{const p=m.target;if(!p)return;if(p.className.includes("resize-left")||p.className.includes("resize-right")){const v=p.className.includes("resize-left");r(v?V.left:V.right),b(m,v)}else w(m)},w=m=>{m.preventDefault();const p={x:m.clientX,y:m.clientY},E=m.currentTarget.getBoundingClientRect(),v=m.clientX-E.left;let M={x:m.clientX,y:m.clientY},j=!1,y,A;const z=H=>{if(M={x:H.clientX,y:H.clientY},!j){if(Math.abs(H.clientX-p.x)<5&&Math.abs(H.clientY-p.y)<5)return;j=!0,l(),y=ft(D)}d(H.clientX,g),a({y:H.clientY,container:L}),B()},G=()=>{var J;if(L.removeEventListener("scroll",B),g.removeEventListener("scroll",B),document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",G),cancelAnimationFrame(x.id),cancelAnimationFrame(u.id),y==null||y.remove(),A&&((J=A.lastElementChild)==null?void 0:J.classList.contains("indicator"))&&A.lastElementChild.remove(),!j)return;const H=g.getBoundingClientRect(),se=g.scrollLeft+M.x-H.x-v;c(se,A==null?void 0:A.dataset.recordId)},B=()=>{const H=g.getBoundingClientRect(),se=g.scrollLeft+M.x-H.x-v;if(f(se),!y)return;y.style.transform=`translate(${M.x-p.x}px, ${M.y-p.y}px)`;const J=g.querySelectorAll(".record-line-container [data-record-id]");A=ht(y,J,e)};g.addEventListener("scroll",B),L.addEventListener("scroll",B),document.addEventListener("mousemove",z),document.addEventListener("mouseup",G)},b=(m,p)=>{m.preventDefault(),m.stopPropagation();let E=m.clientX;const v=y=>{E=y.clientX,d(y.clientX,g),j()},M=()=>{g.removeEventListener("scroll",j),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",M),cancelAnimationFrame(x.id);const y=g.getBoundingClientRect(),A=g.scrollLeft+E-y.x;s(A,p)},j=()=>{const y=g.getBoundingClientRect(),A=g.scrollLeft+E-y.x;t(A,p)};g.addEventListener("scroll",j),document.addEventListener("mousemove",v),document.addEventListener("mouseup",M)};return D.addEventListener("mousedown",R),()=>{D.removeEventListener("mousedown",R)}},xt=h.exports.memo(e=>{const{id:n,recordEndTime:r,recordStartTime:t,card:s}=e,{container:l,datesContainer:f,timelineDates:c,timelineDatesRef:d,draggingRecordId:x,scrollContainer:a,zoomLevel:u}=Y(),{setRecords:D}=re(),[g,L]=h.exports.useState(),[R,w]=h.exports.useState(),[b,m]=h.exports.useState(),p=N[u],E=u===o.DAY||u===o.HOUR;if(h.exports.useEffect(()=>{const z=s.current,G=l.current,B=a.current;if(!z||!G||!B)return;const Ne=mt(n,{cardNode:z,containerNode:G,timelinePage:B},U=>{x.current=n,m(U)},(U,I)=>{const Z=I||E?Math.round(U/p):Math.round(U/p)-1,W=d.current[0]+Z*k(u);(I&&W<=O(r)||!I&&W>=O(t))&&L(W)},(U,I)=>{x.current=void 0,m(void 0),L(void 0);const Z=I||E?Math.round(U/p):Math.round(U/p)-1;let W=d.current[0]+Z*k(u);I&&W>r&&(W=r),!I&&W<t&&(W=t),D(ce=>ce.map(P=>P.id===n?{id:n,recordStartTime:I?W:P.recordStartTime,recordEndTime:I?P.recordEndTime:W}:P))},()=>{x.current=n},U=>{const I=Math.round(U/p);w(d.current[0]+I*k(u))},(U,I)=>{w(void 0),x.current=void 0;const Z=Math.round(U/p),W=d.current[0]+Z*k(u),ce=getComputedStyle(z),P=parseInt(ce.getPropertyValue("width"),10);D(le=>{const be=le.findIndex(Q=>Q.id===n),je=le.findIndex(Q=>Q.id===I),Ae=le.map(Q=>Q.id===n?{id:n,recordStartTime:W,recordEndTime:W+(E?P/p:P/p-1)*k(u)}:Q);return Oe(Ae,be,je)})});return()=>{Ne()}},[n,s,l,a,x,E,r,t,D,d,p,u]),!t||!r||!t||!r)return null;let v=t,M=r;g&&(b===V.left?v=g:M=g);const j=T(M,v,u,{needDateStart:!0}),y=T(v,c[0],u,{needDateStart:!0,abs:!1})*p,A=E?Math.max(j*p,10):(j+1)*p;return i.exports.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center overflow-hidden",children:[i.exports.jsxs("div",{ref:s,className:"record-card absolute z-10 flex h-[34px] cursor-pointer items-center whitespace-nowrap rounded border bg-white pl-2",style:{left:y,width:A,boxShadow:"0px 1px 3px rgba(0, 0, 0, 0.06)"},children:[n.slice(0,8),i.exports.jsx("div",{className:F("card-tip absolute left-full translate-x-2 opacity-0",(g||R)&&"hidden"),children:E?i.exports.jsxs(i.exports.Fragment,{children:[S(v).format(xe),"-",S(M).format(xe)]}):i.exports.jsxs(i.exports.Fragment,{children:[S(v).format(oe),"-",S(M).format(oe),"\u5171",j+1,"\u5929"]})}),i.exports.jsx("div",{className:"resize-left",children:i.exports.jsx("div",{className:"resize-left-inner"})}),i.exports.jsx("div",{className:"resize-right",children:i.exports.jsx("div",{className:"resize-right-inner"})})]}),f.current&&(g||R)&&Ee.exports.createPortal(i.exports.jsx(ye,{startTime:R!=null?R:v,unitLength:j}),f.current)]})},K),pt=h.exports.memo(({recordId:e,card:n})=>{var L;const{records:r}=re(),{zoomLevel:t,setTimelineDates:s,container:l,scrollLeft:f,stepLength:c}=Y(),[d,x]=h.exports.useState({left:!1,right:!1}),a=r.find(R=>R.id===e);if(h.exports.useEffect(()=>{const R=l.current,w=n.current;if(!R||!w)return;const b=()=>{const m=w.getBoundingClientRect(),p=R.getBoundingClientRect();(d.left!==m.left<p.left||d.right!==m.right>p.right)&&x({left:m.left<p.left,right:m.right>p.right})};return R.addEventListener("scroll",b),()=>R.removeEventListener("scroll",b)},[n,l,d.left,d.right]),h.exports.useEffect(()=>{var R;(R=l.current)==null||R.dispatchEvent(new Event("scroll"))},[(L=l.current)==null?void 0:L.clientWidth,l]),!a)return null;const{recordStartTime:u,recordEndTime:D}=a;if(!u||!D)return null;const g=R=>{if(!l.current)return;const w=100,b=R===V.left,m=ne({zoomLevel:t,base:b?u:D,length:c.current});b?f.current=T(u,m[0],t)*N[t]-w:f.current=T(D,m[0],t)*N[t]-(l.current.clientWidth-w),s(m),x({left:b?!1:d.left,right:b?d.right:!1})};return i.exports.jsx(i.exports.Fragment,{children:dt.map(R=>{if(!l.current)return null;const w=R===V.right,b=w?d.right:d.left;return i.exports.jsxs("button",{onClick:()=>g(R),className:"group sticky z-20 flex h-full cursor-pointer items-center rounded transition-all duration-200",style:{left:w?l.current.clientWidth-32:0,opacity:b?1:0,transform:b?"scale(1)":"scale(0)"},children:[i.exports.jsx($e,{className:F("rounded bg-black/30 text-white",w&&"rotate-180")}),i.exports.jsxs("span",{className:F("text-t4 pointer-events-none absolute flex items-center rounded border bg-white px-1 text-black opacity-0 group-hover:opacity-100",w?"right-6":"left-6"),children:[S(u).format(oe),i.exports.jsx(Pe,{}),S(Math.max(u,D)).format(oe)]})]},R)})})},K),gt=({movingStartDate:e,recordId:n})=>{const{timelineDates:r,zoomLevel:t}=Y();return i.exports.jsxs("div",{className:"pointer-events-none absolute top-0.5 flex h-[34px] items-center whitespace-nowrap rounded bg-green-100 px-1.5",style:{width:ee[t]*N[t],left:T(e,r[0],t)*N[t]},children:[i.exports.jsx("span",{children:"+"}),i.exports.jsx("span",{className:"text-t2 ml-2",children:n===de?"\u65B0\u5EFA":"\u65B0\u5EFA\u4E8B\u9879"})]})},Re=h.exports.memo(e=>{const{id:n,recordEndTime:r,recordStartTime:t,recordIndex:s}=e,{setRecords:l}=re(),{timelineDatesRef:f,container:c,datesContainer:d,draggingRecordId:x,zoomLevel:a}=Y(),u=h.exports.useRef(null),[D,g]=h.exports.useState(),L=a===o.DAY||a===o.HOUR,R=h.exports.useCallback(p=>{if(t&&r)return;const E=c.current;if(!d.current||!E||x.current)return;const M=E.getBoundingClientRect(),j=E.scrollLeft+p.clientX-M.x,y=Math.floor(j/N[a]);g(f.current[0]+y*k(a))},[c,d,x,r,t,a,f]),w=h.exports.useCallback(()=>{g(void 0)},[]),b=h.exports.useCallback(()=>{if(D){const p=D,E=p+(L?ee[a]:ee[a]-1)*k(a);l(n===de?v=>v.concat({id:Xe()}):v=>v.map(M=>M.id===n?{id:n,recordStartTime:p,recordEndTime:E}:M)),g(void 0)}},[n,L,D,l,a]),m=t&&r;return h.exports.useMemo(()=>i.exports.jsxs("div",{"data-record-id":n,onMouseMove:R,onMouseLeave:w,onClick:b,className:F("absolute flex h-10 w-full",!m&&"cursor-pointer"),style:{top:s*_},children:[D&&i.exports.jsx(gt,{recordId:n,movingStartDate:D}),m&&i.exports.jsxs(i.exports.Fragment,{children:[i.exports.jsx(pt,{recordId:n,card:u}),i.exports.jsx(xt,{id:n,recordEndTime:r,recordStartTime:t,card:u})]}),d.current&&D&&Ee.exports.createPortal(i.exports.jsx(ye,{startTime:D,unitLength:L?ee[a]:ee[a]-1}),d.current)]}),[n,R,w,b,m,s,D,r,t,d,L,a])},K),Ht=(e,n)=>{const r=N[e];let t=n.length*r;if(e===o.YEAR){const s=n[n.length-1],l=Dt(s);t=(T(l,n[0],e)+1)*r}else e===o.QUARTER?t=7*n.length*r:e===o.DAY&&(t=4*n.length*r);return t},Dt=e=>new Date(e).setMonth(new Date(e).getMonth()+1,0),Ut=e=>{const{records:n}=re();return n.find(r=>r.id===e)},Ot=()=>{const[e,n]=h.exports.useState(o.MONTH),r=h.exports.useRef(ve[e]),t=ne({zoomLevel:e,length:r.current}),[s,l]=h.exports.useState(t),f=h.exports.useRef(null),c=h.exports.useRef(null),d=h.exports.useRef(),x=h.exports.useRef(s),a=h.exports.useRef(),u=h.exports.useRef(null),D=h.exports.useRef(null),g=h.exports.useRef(null),L=h.exports.useRef(null),[R,w]=h.exports.useState(new Array(10).fill(1).map((p,E)=>({id:String(E+1),recordStartTime:O(Date.now())+pe,recordEndTime:O(Date.now())+pe}))),b=h.exports.useMemo(()=>{const p=N[e];let E=s.length*p;if(e===o.YEAR){const v=s[s.length-1],M=new Date(v).setMonth(new Date(v).getMonth()+1,0);E=(T(M,s[0],e)+1)*p}else e===o.QUARTER?E=7*s.length*p:e===o.HOUR?E=p*s.length:e===o.DAY&&(E=4*p*s.length);return{containerWidth:E,zoomLevel:e,setZoomLevel:n,timelineDatesRef:x,stepLength:r,timelineDates:s,setTimelineDates:l,container:f,scrollContainer:c,scrollLeft:d,datesContainer:u,timelineHeader:D,monthContainer:g,listRef:L,draggingRecordId:a}},[e,s]),m=h.exports.useMemo(()=>({records:R,setRecords:w}),[R]);return x.current=s,i.exports.jsx(Me.Provider,{value:b,children:i.exports.jsx(we.Provider,{value:m,children:i.exports.jsx(Rt,{})})})},Rt=()=>{var b;const{zoomLevel:e,timelineDates:n,setTimelineDates:r,container:t,scrollContainer:s,datesContainer:l,timelineHeader:f,monthContainer:c,scrollLeft:d,listRef:x,stepLength:a,containerWidth:u,timelineDatesRef:D}=Y(),{records:g}=re(),[L,R]=h.exports.useState([0,Math.min(window.innerHeight/_,g.length)]),w=N[e];return h.exports.useLayoutEffect(()=>{!t.current||(t.current.scrollLeft=(t.current.scrollWidth-t.current.clientWidth)/2)},[t]),h.exports.useLayoutEffect(()=>{!t.current||!d.current||(t.current.scrollLeft=d.current,d.current=void 0)},[n,t,d]),h.exports.useEffect(()=>{if(!!t.current&&t.current.scrollWidth<t.current.clientWidth*2){a.current=Math.ceil(a.current*1.5);const m=ne({zoomLevel:e,length:a.current});r(m),d.current=T(Date.now(),m[0],e)*w-t.current.clientWidth/2}},[(b=t.current)==null?void 0:b.clientWidth]),h.exports.useEffect(()=>{if(!t.current||!l.current)return;const m=t.current,p=()=>{if(!(typeof d.current!="undefined"||!t.current)){if(m.scrollWidth-m.scrollLeft-m.clientWidth<De){const v=D.current,M=T(v[a.current],v[0],e)*N[e];d.current=t.current.scrollLeft-M,r(j=>{const y=Ge(j),A=ie({zoomLevel:e,base:y,length:a.current,dir:q.NEXT}),z=[...j.slice(a.current),...A];return console.log(z),z})}if(m.scrollLeft<De){const v=D.current,M=T(v[v.length-1],v[a.current-1],e)*N[e];d.current=t.current.scrollLeft+M,r(j=>{const y=j[0],z=[...ie({zoomLevel:e,base:y,length:a.current,dir:q.PREV}),...Je(j,a.current)];return console.log(z),z})}}},E=tt?Ke(p):p;return m.addEventListener("scroll",E),()=>m.removeEventListener("scroll",E)},[t,d,a,l,r,e,D]),h.exports.useEffect(()=>{const m=s.current,p=x.current;if(!m||!p)return;const E=()=>{const v=p.getBoundingClientRect(),M=m.getBoundingClientRect(),j=Math.ceil(m.clientHeight/_)+10,y=M.top-v.top,A=Math.max(Math.floor(y/_)-5,0);R([A,A+j])};return E(),m.addEventListener("scroll",E),()=>{m.removeEventListener("scroll",E)}},[x,s]),i.exports.jsxs("div",{className:"timeline-page relative w-full overflow-scroll text-gray-600",style:{height:"calc(100% - 40px)"},ref:s,children:[i.exports.jsx(ut,{ref:f}),i.exports.jsxs("div",{className:"relative w-full overflow-auto pb-[40px]",ref:t,children:[i.exports.jsx(ct,{ref:c}),i.exports.jsx(it,{}),i.exports.jsx(lt,{}),i.exports.jsxs("div",{className:"record-line-container relative",ref:x,style:{width:u,height:g.length*_+_},children:[g.slice(L[0],L[1]).map((m,p)=>i.exports.jsx(Re,me({recordIndex:L[0]+p},m),m.id)),i.exports.jsx(Re,{id:nt,recordIndex:g.length})]})]})]})};export{Rt as TimeLine,Ot as default,Ht as getContainerWidth,Dt as getMonthLastDate,Ut as useRecord};
