import{r as l,j as d}from"./index.98fe318c.js";import{c as y}from"./index.73ffd393.js";import{a as n}from"./mock.54c533d5.js";import{v as c}from"./v4.90f1a8cc.js";import"./index.563d4b32.js";const p=7*24*60*60*1e3,f=10*60*1e3;class E{constructor(t=["auth"]){this.clearLength=10,this.liveTime=p,this.checkIntervalTime=f,this.save=(e,i)=>{try{localStorage.setItem(e,i),this.cache.add(e)}catch{this.isExceedSize()?(console.groupCollapsed("%c\u6570\u636E\u592A\u5927\uFF01\u8D85\u51FA\u5B58\u50A8\u4E0A\u9650\uFF01","color: red;"),console.log(JSON.parse(i)),console.groupEnd()):(this.removeSomeKeys(),this.save(e,i))}},this.checkCacheValidity=()=>{for(const e of this.cache){if(this.remainKeys.has(e))continue;const i=localStorage.getItem(e);if(!!i)try{const a=JSON.parse(i);if(Object.prototype.toString.call(a)!=="[object Object]")continue;Date.now()>a.expires&&(console.log(e),this.remove(e))}catch{}}console.groupEnd(),this.timer=setTimeout(this.checkCacheValidity,this.checkIntervalTime)},this.remainKeys=new Set(t),this.cache=new Set(Object.keys(localStorage)),this.checkCacheValidity(),window.addEventListener("beforeunload",()=>{this.destroy()})}setItem(t,e){try{typeof e=="object"&&(e==null?void 0:e.expires)?e=JSON.stringify(e):e=JSON.stringify({data:e,expires:Date.now()+this.liveTime})}catch{throw new Error("\u53C2\u6570\u9519\u8BEF\uFF01")}this.save(t,e)}getItem(t){let e;if(e=localStorage.getItem(t),this.updateKeyPos(t),!e)return e;try{e=JSON.parse(e)}catch{e==="undefined"&&(e=void 0)}return typeof e=="object"&&e!==null?e.data:e}isExceedSize(){if(this.cache.size>this.remainKeys.size)return!1;for(const t of this.cache)if(!this.remainKeys.has(t))return!1;return!0}removeSomeKeys(){console.groupCollapsed("%c\u7A7A\u95F4\u4E0D\u591F\u5220\u9664\u4E0D\u5E38\u7528\u6570\u636E","color: green;");let t=0;for(const e of this.cache)if(!this.remainKeys.has(e)&&(console.log(e),this.remove(e),t++,t>=this.clearLength))break;console.groupEnd()}updateKeyPos(t){this.cache.delete(t),this.cache.add(t)}setLiveTime(t){this.liveTime=t}setCheckIntervalTime(t){this.checkIntervalTime=t,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.checkCacheValidity,this.checkIntervalTime)}resetTime(){this.liveTime=p,this.checkIntervalTime=f,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.checkCacheValidity,this.checkIntervalTime)}destroy(){this.clear(),this.timer&&clearTimeout(this.timer)}remove(t){this.cache.delete(t),localStorage.removeItem(t)}clear(){this.cache.clear(),localStorage.clear()}}const r=new E(["bigData","expires","exceedSize","dataType"]),I=[{text:"\u5B58\u53D6\u7684\u5404\u79CD\u7C7B\u578B\u6570\u636E",type:"dataType"},{text:"\u6570\u636E\u8FC7\u671F\u6E05\u9664",type:"expires"},{text:"\u8D85\u5927\u6570\u636E\u65E0\u6CD5\u5B58\u5165",type:"bigData"},{text:"\u7A7A\u95F4\u4E0D\u591F\u5220\u9664\u4E0D\u5E38\u7528\u6570\u636E",type:"exceedSize"}],b=()=>{const[h,t]=l.exports.useState("dataType"),e=l.exports.useRef();l.exports.useEffect(()=>(m(h),()=>{e.current&&(clearInterval(e.current),clearTimeout(e.current))}),[]);const i=()=>{r.setItem("dataType",1);const s=[[c(),!0],[c(),null],[c(),void 0],[c(),111],[c(),"this is a sentence"],[c(),n(2)]];s.forEach(([o,u])=>{r.setItem(o,u)}),e.current=setTimeout(()=>{console.groupCollapsed("%c \u53D6\u51FA\u5404\u79CD\u7C7B\u578B\u6570\u636E","color: red;"),s.forEach(([o])=>{const u=r.getItem(o);console.log(u,"type:"+typeof u)}),console.groupEnd()},1e3)},a=()=>{r.setLiveTime(3*1e3),r.setCheckIntervalTime(5*1e3);const s=n(1);r.setItem("expires",s),e.current=setInterval(()=>{r.setItem(c(),s)},500)},T=()=>{const s=n(2e4);r.setItem("bigData",s),e.current=setInterval(()=>{r.setItem(c(),s)},2e3)},g=()=>{const s=n(4e3);r.setItem("exceedSize",s),e.current=setInterval(()=>{r.setItem(c(),s)},1e3)},m=s=>{switch(t(s),r.clear(),r.resetTime(),e.current&&(clearInterval(e.current),clearTimeout(e.current)),s){case"bigData":T();break;case"dataType":i();break;case"exceedSize":g();break;case"expires":a();break}};return d.exports.jsx("div",{children:I.map(({text:s,type:o})=>d.exports.jsx("button",{onClick:()=>m(o),className:y("mr-2",o===h&&"bg-gray-200"),children:s},o))})};export{b as default};
