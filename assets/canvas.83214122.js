var dt=Object.defineProperty,lt=Object.defineProperties;var ft=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable;var Q=(e,i,t)=>i in e?dt(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,A=(e,i)=>{for(var t in i||(i={}))gt.call(i,t)&&Q(e,t,i[t]);if(q)for(var t of q(i))vt.call(i,t)&&Q(e,t,i[t]);return e},H=(e,i)=>lt(e,ft(i));import{c as mt,_ as Z,p as I,h as pt,e as w,a as st,b as xt}from"./calendar.bb17f51b.js";import{p as Pt}from"./lodash.49e6853f.js";var T={};Object.defineProperty(T,"__esModule",{value:!0});var Et=typeof window!="undefined"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),j={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},ot={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:Et?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},F={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(var U=1;U<20;U++)F["f"+U]=111+U;function _(e,i,t){i&&!("byKey"in i)&&(t=i,i=null),Array.isArray(e)||(e=[e]);var n=e.map(function(s){return at(s,i)}),a=function(h){return n.some(function(r){return ht(r,h)})},d=t==null?a:a(t);return d}function bt(e,i){return _(e,i)}function wt(e,i){return _(e,{byKey:!0},i)}function at(e,i){var t=i&&i.byKey,n={};e=e.replace("++","+add");var a=e.split("+"),d=a.length;for(var s in j)n[j[s]]=!1;var h=!0,r=!1,o=void 0;try{for(var l=a[Symbol.iterator](),c;!(h=(c=l.next()).done);h=!0){var u=c.value,v=u.endsWith("?")&&u.length>1;v&&(u=u.slice(0,-1));var f=z(u),p=j[f];if(u.length>1&&!p&&!ot[u]&&!F[f])throw new TypeError('Unknown modifier: "'+u+'"');(d===1||!p)&&(t?n.key=f:n.which=rt(u)),p&&(n[p]=v?null:!0)}}catch(E){r=!0,o=E}finally{try{!h&&l.return&&l.return()}finally{if(r)throw o}}return n}function ht(e,i){for(var t in e){var n=e[t],a=void 0;if(n!=null&&(t==="key"&&i.key!=null?a=i.key.toLowerCase():t==="which"?a=n===91&&i.which===93?91:i.which:a=i[t],!(a==null&&n===!1)&&a!==n))return!1}return!0}function rt(e){e=z(e);var i=F[e]||e.toUpperCase().charCodeAt(0);return i}function z(e){return e=e.toLowerCase(),e=ot[e]||e,e}var G=T.default=_;T.isHotkey=_;T.isCodeHotkey=bt;T.isKeyHotkey=wt;T.parseHotkey=at;T.compareHotkey=ht;T.toKeyCode=rt;T.toKeyName=z;var ct={exports:{}};(function(e,i){(function(t,n){e.exports=n()})(mt,function(){return function t(n,a,d){var s=window,h="application/octet-stream",r=d||h,o=n,l=!a&&!d&&o,c=document.createElement("a"),u=function(P){return String(P)},v=s.Blob||s.MozBlob||s.WebKitBlob||u,f=a||"download",p,E;if(v=v.call?v.bind(s):Blob,String(this)==="true"&&(o=[o,r],r=o[0],o=o[1]),l&&l.length<2048&&(f=l.split("/").pop().split("?")[0],c.href=l,c.href.indexOf(l)!==-1)){var b=new XMLHttpRequest;return b.open("GET",l,!0),b.responseType="blob",b.onload=function(P){t(P.target.response,f,h)},setTimeout(function(){b.send()},0),b}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(o))if(o.length>1024*1024*1.999&&v!==u)o=C(o),r=o.type||h;else return navigator.msSaveBlob?navigator.msSaveBlob(C(o),f):k(o);else if(/([\x80-\xff])/.test(o)){var R=0,g=new Uint8Array(o.length),x=g.length;for(R;R<x;++R)g[R]=o.charCodeAt(R);o=new v([g],{type:r})}p=o instanceof v?o:new v([o],{type:r});function C(P){var O=P.split(/[:;,]/),M=O[1],K=O[2]=="base64"?atob:decodeURIComponent,B=K(O.pop()),$=B.length,N=0,V=new Uint8Array($);for(N;N<$;++N)V[N]=B.charCodeAt(N);return new v([V],{type:M})}function k(P,O){if("download"in c)return c.href=P,c.setAttribute("download",f),c.className="download-js-link",c.innerHTML="downloading...",c.style.display="none",document.body.appendChild(c),setTimeout(function(){c.click(),document.body.removeChild(c),O===!0&&setTimeout(function(){s.URL.revokeObjectURL(c.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(P)&&(P="data:"+P.replace(/^data:([\w\/\-\+]+)/,h)),window.open(P)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=P),!0;var M=document.createElement("iframe");document.body.appendChild(M),!O&&/^data:/.test(P)&&(P="data:"+P.replace(/^data:([\w\/\-\+]+)/,h)),M.src=P,setTimeout(function(){document.body.removeChild(M)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(p,f);if(s.URL)k(s.URL.createObjectURL(p),!0);else{if(typeof p=="string"||p.constructor===u)try{return k("data:"+r+";base64,"+s.btoa(p))}catch{return k("data:"+r+","+encodeURIComponent(p))}E=new FileReader,E.onload=function(P){k(this.result)},E.readAsDataURL(p)}return!0}})})(ct);var ut=ct.exports;const J=e=>{let i=1/0,t=1/0,n=0,a=0;return e.forEach(d=>{d.x<i&&(i=d.x),d.y<t&&(t=d.y),d.x>n&&(n=d.x),d.y>a&&(a=d.y)}),{left:i,top:t,right:n,bottom:a,width:n-i,height:a-t}},W=()=>window.devicePixelRatio;var yt=(e=>(e[e.RECTANGLE=0]="RECTANGLE",e[e.POLYGON=1]="POLYGON",e[e.ELLIPSE=2]="ELLIPSE",e))(yt||{});const Lt=async(e,i,t)=>{const n=document.createElement("canvas"),a=n.getContext("2d");if(!a)return;n.width=e.width,n.height=e.height,a.putImageData(e,0,0);const d=n.toDataURL();return i?await Ct(d,i,t):d},Ct=async(e,i,t=1)=>{const n=d=>{const s=new Image,h=()=>{const r=document.createElement("canvas");r.width=s.width,r.height=s.height;const o=r.getContext("2d");if(!o){d(void 0);return}const{left:l,top:c}=J(i),u=W();if(i=i.map(f=>({x:(f.x-l)*u,y:(f.y-c)*u})),o.beginPath(),t===2){const[f,p]=i,{x:E,y:b}=f,{x:R,y:g}=p,x=Math.abs(R-E),C=Math.abs(g-b),k=Math.min(R,E)+x/2,P=Math.min(g,b)+C/2;o.ellipse(k,P,x/2,C/2,0,0,2*Math.PI)}else i.forEach((f,p)=>{p===0?o.moveTo(f.x,f.y):o.lineTo(f.x,f.y)});o.closePath(),o.clip(),o.drawImage(s,0,0);const v=r.toDataURL();d(v)};s.onload=h,s.src=e};return await new Promise(n)};function kt(){return typeof __SENTRY_BROWSER_BUNDLE__!="undefined"&&!!__SENTRY_BROWSER_BUNDLE__}function Rt(){return!kt()&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]"}var Mt={};function Tt(){return Rt()?global:typeof window!="undefined"?window:typeof self!="undefined"?self:Mt}function Ot(){var e=Tt(),i=e.crypto||e.msCrypto;if(i!==void 0&&i.getRandomValues){var t=new Uint16Array(8);i.getRandomValues(t),t[3]=t[3]&4095|16384,t[4]=t[4]&16383|32768;var n=function(a){for(var d=a.toString(16);d.length<4;)d="0"+d;return d};return n(t[0])+n(t[1])+n(t[2])+n(t[3])+n(t[4])+n(t[5])+n(t[6])+n(t[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var d=Math.random()*16|0,s=a==="x"?d:d&3|8;return s.toString(16)})}const tt=e=>W()*e;var m=(e=>(e.POLYGON="polygon",e.RECTANGLE="rectangle",e.CIRCLE="circle",e.LINE="line",e.ARROW="arrow",e.ERASER="eraser",e))(m||{}),y=(e=>(e.GREEN="green",e.BLUE="blue",e.YELLOW="yellow",e.RED="red",e))(y||{}),L=(e=>(e.ADD="add",e.UPDATE="update",e.DELETE="delete",e))(L||{});const At=(e,i)=>{const t=e.getContext("2d");!t||(t.beginPath(),t.arc(i.x,i.y,5,0,2*Math.PI),t.fill())},Y=(e,i,t,n)=>{const a=e.getContext("2d");if(!a)return;const{x:d,y:s}=i,{x:h,y:r}=t,o=Math.abs(h-d),l=Math.abs(r-s),c=Math.min(h,d)+o/2,u=Math.min(r,s)+l/2;a.save(),n!=null&&n.strokeStyle&&(a.strokeStyle=n.strokeStyle),n!=null&&n.lineWidth&&(a.lineWidth=n.lineWidth),a.beginPath(),a.ellipse(c,u,o/2,l/2,0,0,2*Math.PI),n!=null&&n.isFill?a.fill():a.stroke(),a.restore()},et=(e,i,t,n)=>{const a=e.getContext("2d");if(!a)return;const{x:d,y:s}=i,{x:h,y:r}=t,o=Math.abs(h-d),l=Math.abs(r-s),c=Math.min(h,d),u=Math.min(r,s);a.save(),n!=null&&n.strokeStyle&&(a.strokeStyle=n.strokeStyle),n!=null&&n.lineWidth&&(a.lineWidth=n.lineWidth),a.beginPath(),a.strokeRect(c,u,o,l),a.restore()},it=(e,i,t,n)=>{const a=e.getContext("2d");if(!a)return;const{x:d,y:s}=i,{x:h,y:r}=t,o=h-d,l=r-s,c=Math.atan2(l,o);a.save(),a.lineJoin="round",n!=null&&n.lineWidth&&(a.lineWidth=n==null?void 0:n.lineWidth),n!=null&&n.strokeStyle&&(a.strokeStyle=n==null?void 0:n.strokeStyle),a.beginPath(),a.moveTo(d,s),a.lineTo(h,r);const u=a.lineWidth*5;a.lineTo(h-u*Math.cos(c-Math.PI/6),r-u*Math.sin(c-Math.PI/6)),a.moveTo(h,r),a.lineTo(h-u*Math.cos(c+Math.PI/6),r-u*Math.sin(c+Math.PI/6)),a.stroke(),a.restore()},D=(e,i,t)=>{e.save(),t&&(t!=null&&t.lineWidth&&(e.lineWidth=t==null?void 0:t.lineWidth),t!=null&&t.strokeStyle&&(e.strokeStyle=t==null?void 0:t.strokeStyle),t!=null&&t.fillStyle&&(e.fillStyle=t==null?void 0:t.fillStyle),t!=null&&t.lineCap&&(e.lineCap=t==null?void 0:t.lineCap),t!=null&&t.lineJoin&&(e.lineJoin=t==null?void 0:t.lineJoin));const n=a=>{e.beginPath(),e.arc(a.x,a.y,5,0,2*Math.PI),e.fill()};(t==null?void 0:t.joinShape)==="round"&&(i.forEach(n),e.lineJoin="round"),e.beginPath(),i.forEach((a,d)=>{d===0?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)}),t!=null&&t.closePath&&e.closePath(),t!=null&&t.isFill?e.fill():e.stroke(),e.restore()},X=(e,i)=>{const t=e.getContext("2d");!t||(t.save(),t.beginPath(),t.globalCompositeOperation="destination-out",t.arc(i.x,i.y,5,0,2*Math.PI),t.clip(),t.clearRect(0,0,e.width,e.height),t.restore())},nt=(e,i,t)=>{const n=e.getContext("2d");if(!n)return;const{x:a,y:d}=i,{x:s,y:h}=t,r=5*Math.sin(Math.atan((h-d)/(s-a))),o=5*Math.cos(Math.atan((h-d)/(s-a))),l=a+r,c=d-o,u=a-r,v=d+o,f=s+r,p=h-o,E=s-r,b=h+o;X(e,t),n.save(),n.beginPath(),n.globalCompositeOperation="destination-out",n.moveTo(l,c),n.lineTo(f,p),n.lineTo(E,b),n.lineTo(u,v),n.closePath(),n.clip(),n.clearRect(0,0,e.width,e.height),n.restore()},Dt=(e,i,t)=>{var f;const n=e.getContext("2d");if(!n)return;const a=i[0],d=i[1],{x:s,y:h}=a,{x:r,y:o}=d,l=Math.abs(r-s),c=Math.abs(o-h),u=Math.min(r,s)+l/2,v=Math.min(o,h)+c/2;n.lineWidth=Math.max(8,(f=t==null?void 0:t.lineWidth)!=null?f:0),n.beginPath(),n.ellipse(u,v,l/2,c/2,0,0,2*Math.PI),n.closePath()},Bt=(e,i,t)=>{var f;const n=e.getContext("2d");if(!n)return;const a=i[0],d=i[1],{x:s,y:h}=a,{x:r,y:o}=d,l=Math.abs(r-s),c=Math.abs(o-h),u=Math.min(r,s),v=Math.min(o,h);n.lineWidth=Math.max(8,(f=t==null?void 0:t.lineWidth)!=null?f:0),n.beginPath(),n.rect(u,v,l,c)},Nt=(e,i,t)=>{var a;const n=e.getContext("2d");!n||(n.lineWidth=Math.max(8,(a=t==null?void 0:t.lineWidth)!=null?a:0),n.beginPath(),i.forEach((d,s)=>{s===0?n.moveTo(d.x,d.y):n.lineTo(d.x,d.y)}),t.closePath&&n.closePath())};class Wt{constructor(i){this.canvasBoard=i,this.delay=1e3,this.maxStack=100,this.userOnly=!1,this.lastRecorded=0,this.redoStack=[],this.undoStack=[]}record(i,t){const n=this.inverse(i,t);n&&this.undoStack.push(n)}inverse(i,t){switch(i.type){case L.ADD:return{type:L.DELETE,uuid:i.uuid};case L.DELETE:return{type:L.ADD,uuid:i.uuid};case L.UPDATE:{if(!i.patch)return;const n=Pt(t,Object.keys(i.patch));return{type:L.UPDATE,uuid:i.uuid,patch:n}}}}redo(){if(this.redoStack.length===0)return;const i=this.redoStack.pop();if(!i)return;const t=this.inverse(i,this.canvasBoard.allShape[i==null?void 0:i.uuid]);t&&(this.undoStack.push(t),this.undoStack.length>this.maxStack&&this.undoStack.shift()),this.canvasBoard.applyOP(i)}undo(){var n;if(this.undoStack.length===0)return;const i=this.undoStack.pop();if(!i)return;const t=this.inverse(i,this.canvasBoard.allShape[(n=i==null?void 0:i.uuid)!=null?n:""]);t&&(this.redoStack.push(t),this.redoStack.length>this.maxStack&&this.redoStack.shift()),this.canvasBoard.applyOP(i)}clear(){this.redoStack=[],this.undoStack=[]}}class It{constructor(i,t,n=2,a="#000"){this.canvas=i,this.drawType=t,this.lineWidth=n,this.color=a,this.pathStack={redo:[],undo:[]},this.allShape={},this.drawingPath=[],this.isMoving=!1,this.isPolygonDrawing=!1,this.oldShape=[],this.memoCanvas=document.createElement("canvas"),this.initContext=()=>{const s=W();if(this.canvas.width=Math.floor(this.canvas.clientWidth*s),this.canvas.height=Math.floor(this.canvas.clientHeight*s),this.ctx=this.canvas.getContext("2d"),!this.ctx)return;this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this.lineWidth,this.ctx.scale(s,s),this.setBackground();const h=o=>{o.forEach(l=>{l.target===this.canvas&&this.updateCtx()})};new ResizeObserver(h).observe(this.canvas)},this.updateCtx=()=>{const s=W();this.canvas.width=Math.floor(this.canvas.clientWidth*s),this.canvas.height=Math.floor(this.canvas.clientHeight*s),this.ctx=this.canvas.getContext("2d"),this.ctx&&(this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this.lineWidth,this.ctx.scale(s,s),this.refresh())},this.bindEvent=()=>{const s=r=>{if(this.hoverShape){this.moveShape(r);return}if(this.drawType===m.POLYGON){this.drawPolygon(r);return}if(this.drawType===m.RECTANGLE){this.drawRectangle(r);return}if(this.drawType===m.CIRCLE){this.drawCircle(r);return}if(this.drawType===m.ARROW){this.dragArrow(r);return}(this.drawType===m.LINE||this.drawType===m.ERASER)&&this.drawLineAndEraser(r)},h=r=>{var o,l;G("esc")(r)?this.drawType===m.POLYGON&&this.closePolygon():G("Backspace")(r)&&this.activeShape&&(this.allShape[(o=this.activeShape)==null?void 0:o.uuid].live=!1,(l=this.history)==null||l.record({type:L.DELETE,uuid:this.activeShape.uuid}),this.refresh())};window.addEventListener("keydown",h),this.canvas.addEventListener("mousedown",s),this.canvas.addEventListener("mousemove",this.detectShape)},this.refresh=()=>{!this.ctx||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),Object.values(this.allShape).forEach(({live:s,type:h,strokeStyle:r,path:o,lineWidth:l})=>{!this.ctx||!s||(h===m.POLYGON?D(this.ctx,o,{lineWidth:l,strokeStyle:r,closePath:!0}):h===m.RECTANGLE?et(this.canvas,o[0],o[1],{lineWidth:l,strokeStyle:r}):h===m.LINE?D(this.ctx,o,{lineWidth:l,strokeStyle:r,lineCap:"round",lineJoin:"round"}):h===m.CIRCLE?Y(this.canvas,o[0],o[1],{lineWidth:l,strokeStyle:r}):h===m.ERASER?o.forEach((c,u)=>{u!==o.length-1&&(u===0?X(this.canvas,c):nt(this.canvas,c,o[u+1]))}):h===m.ARROW&&it(this.canvas,o[0],o[1],{lineWidth:l,strokeStyle:r}))}))},this.moveShape=s=>{this.isMoving=!0;const h=this.getPoint(s),r=l=>{var p;if(!this.hoverShape)return;const c=this.getPoint(l),u=c.x-h.x,v=c.y-h.y,f=this.hoverShape.path.map(E=>({x:E.x+u,y:E.y+v}));this.allShape[(p=this.hoverShape)==null?void 0:p.uuid].path=f,this.refresh()},o=()=>{var l,c;if(document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o),this.hoverShape){if(!this.ctx)return;const u=this.allShape[(l=this.hoverShape)==null?void 0:l.uuid];if(!u)return;const{path:v}=u;(c=this.history)==null||c.record({type:L.UPDATE,uuid:this.hoverShape.uuid,patch:{path:v}},this.hoverShape);const f=J(v);this.ctx.save(),this.ctx.lineWidth=2,this.ctx.strokeStyle="rgba(0,255,0,0.5)",this.ctx.strokeRect(f.left,f.top,f.width,f.height),this.ctx.restore(),this.activeShape=u}this.isMoving=!1,this.hoverShape=void 0};document.addEventListener("mousemove",r),document.addEventListener("mouseup",o)},this.getPoint=s=>{const h=this.canvas.getBoundingClientRect();return{x:s.clientX-h.x,y:s.clientY-h.y}},this.drawLineAndEraser=s=>{let h=this.getPoint(s);this.drawingPath.push(h),this.drawType===m.ERASER&&X(this.canvas,h);const r=l=>{if(!this.ctx)return;const c=this.getPoint(l);this.drawingPath.push(c),this.drawType===m.LINE?D(this.ctx,[h,c],{lineCap:"round",lineJoin:"round"}):nt(this.canvas,h,c),h=c},o=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o),this.ctx&&(this.addShape(),this.drawingPath=[])};document.addEventListener("mousemove",r),document.addEventListener("mouseup",o)},this.drawPolygon=s=>{var r;if(!this.ctx)return;if(!this.isPolygonDrawing){this.isPolygonDrawing=!0;const o=c=>{if(!this.isPolygonDrawing){document.removeEventListener("keydown",l),document.removeEventListener("mousemove",o);return}if(!this.ctx)return;this.drawingPath=this.drawingPath.filter(f=>!f.isTemp);const u=this.getPoint(c),v=this.drawingPath[0];this.drawingPath.length>2&&Math.abs(v.x-u.x)<8&&Math.abs(v.y-u.y)<8?this.drawingPath.push(H(A({},v),{isTemp:!0})):this.drawingPath.push(H(A({},u),{isTemp:!0})),this.refresh(),this.drawingPath.length!==1&&D(this.ctx,this.drawingPath,{lineCap:"round",joinShape:"round"})},l=c=>{if(!!this.isPolygonDrawing){if(G("mod+z")(c)){const u=this.pathStack.undo.pop();if(u){this.pathStack.redo.push([...this.drawingPath.filter(f=>!f.isTemp)]);const v=this.drawingPath.find(f=>f.isTemp);if(this.drawingPath=v?u.concat(v):u,this.ctx){if(this.refresh(),this.drawingPath.length===1)return;D(this.ctx,this.drawingPath,{lineCap:"round",joinShape:"round"})}}}if(G("mod+shift+z")(c)){const u=this.pathStack.redo.pop();if(u){this.pathStack.undo.push([...this.drawingPath.filter(f=>!f.isTemp)]);const v=this.drawingPath.find(f=>f.isTemp);if(this.drawingPath=v?u.concat(v):u,this.ctx){if(this.refresh(),this.drawingPath.length===1)return;D(this.ctx,this.drawingPath,{lineCap:"round",joinShape:"round"})}}}}};document.addEventListener("keydown",l),document.addEventListener("mousemove",o)}if(this.drawingPath.length>3){const o=this.drawingPath[0],l=this.drawingPath[this.drawingPath.length-1];if(o.x===l.x&&o.y===l.y){this.closePolygon();return}}const h=this.getPoint(s);At(this.canvas,h),this.pathStack.undo.push([...this.drawingPath.filter(o=>!o.isTemp)]),this.drawingPath.push(h),(r=this.onPenPointChange)==null||r.call(this,this.drawingPath)},this.drawCircle=s=>{let h=!1;this.drawingPath.push(this.getPoint(s));const r=v=>{if(!this.ctx)return;this.drawingPath.length>1&&this.drawingPath.pop();const f=this.getPoint(v);this.drawingPath.push(f),this.refresh();const p=h?o(this.drawingPath[0],f):f;Y(this.canvas,this.drawingPath[0],p)},o=(v,f)=>{const p=f.x-v.x,E=f.y-v.y,b=Math.max(Math.abs(p),Math.abs(E));return{x:p>0?v.x+b:v.x-b,y:E>0?v.y+b:v.y-b}},l=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",l),document.removeEventListener("keydown",c),document.removeEventListener("keyup",u),this.ctx&&(this.drawingPath.length>1&&(h&&(this.drawingPath[1]=o(this.drawingPath[0],this.drawingPath[1])),this.addShape()),this.drawingPath=[])},c=v=>{if(v.shiftKey){h=!0,this.refresh();const f=o(this.drawingPath[0],this.drawingPath[1]);Y(this.canvas,this.drawingPath[0],f)}},u=()=>{h=!1,this.refresh(),Y(this.canvas,this.drawingPath[0],this.drawingPath[1])};document.addEventListener("mousemove",r),document.addEventListener("mouseup",l),document.addEventListener("keydown",c),document.addEventListener("keyup",u)},this.drawRectangle=s=>{this.drawingPath.push(this.getPoint(s));const h=o=>{!this.ctx||(this.drawingPath.length>1&&this.drawingPath.pop(),this.drawingPath.push(this.getPoint(o)),this.refresh(),et(this.canvas,this.drawingPath[0],this.drawingPath[1]))},r=()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",r),this.ctx&&(this.drawingPath.length>1&&this.addShape(),this.drawingPath=[])};document.addEventListener("mousemove",h),document.addEventListener("mouseup",r)},this.dragArrow=s=>{if(!this.ctx)return;this.drawingPath.push(this.getPoint(s));const h=o=>{!this.ctx||(this.drawingPath.length>1&&this.drawingPath.pop(),this.drawingPath.push(this.getPoint(o)),this.refresh(),console.log(this.ctx.lineWidth),it(this.canvas,this.drawingPath[0],this.drawingPath[1]))},r=()=>{!this.ctx||(this.drawingPath.length>1&&this.addShape(),this.drawingPath=[],document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",r))};document.addEventListener("mousemove",h),document.addEventListener("mouseup",r)},this.addShape=()=>{var h;if(!this.ctx)return;const s={lineWidth:this.ctx.lineWidth,strokeStyle:this.ctx.strokeStyle,uuid:Ot(),type:this.drawType,path:this.drawingPath,live:!0};this.allShape[s.uuid]=s,(h=this.history)==null||h.record({type:L.ADD,uuid:s.uuid})},this.detectShape=s=>{if(this.isMoving||!this.ctx)return;const h=this.canvas.getBoundingClientRect();for(const r of Object.values(this.allShape)){if(!this.ctx)return;const{path:o,type:l,lineWidth:c,live:u}=r;if(!u)return;this.ctx.save(),l===m.CIRCLE?Dt(this.canvas,o,{lineWidth:c}):l===m.RECTANGLE?Bt(this.canvas,o,{lineWidth:c}):Nt(this.canvas,o,{lineWidth:c,closePath:l===m.POLYGON});const v=s.clientX-h.x,f=s.clientY-h.y;if(this.ctx.isPointInStroke(tt(v),tt(f))){this.hoverShape=A({},r),this.canvas.classList.add("grab"),this.ctx.restore();return}this.ctx.restore()}this.hoverShape=void 0,this.canvas.classList.remove("grab")},this.setBackground=s=>{!this.ctx||(this.ctx.fillStyle=s!=null?s:"white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))},this.setDrawType=s=>{this.drawType===m.POLYGON&&this.closePolygon(),this.canvas.classList.remove(m.POLYGON,m.ERASER),(s===m.POLYGON||s===m.ERASER)&&this.canvas.classList.add(s),this.drawType=s},this.setColor=s=>{!this.ctx||(this.color=s,this.ctx.strokeStyle=this.color,this.ctx.fillStyle=this.color)},this.setLineWidth=s=>{!this.ctx||(this.lineWidth=s,this.ctx.lineWidth=this.lineWidth)},this.closePolygon=()=>{!this.ctx||(this.drawingPath.pop(),this.addShape(),this.isPolygonDrawing=!1,this.pathStack={redo:[],undo:[]},this.drawingPath=[],this.refresh())},this.clearBoard=()=>{!this.ctx||(this.allShape={},this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height))},this.downloadBoard=()=>{const s=this.canvas.toDataURL();ut(s)},this.redo=()=>{var s;(s=this.history)==null||s.redo()},this.undo=()=>{var s;(s=this.history)==null||s.undo()},this.applyOP=s=>{switch(s.type){case L.ADD:{this.allShape[s.uuid].live=!0;break}case L.DELETE:{this.allShape[s==null?void 0:s.uuid].live=!1;break}case L.UPDATE:if(!s.patch)return;this.allShape[s.uuid]=A(A({},this.allShape[s.uuid]),s.patch)}this.refresh()},window.drawingPath=this,this.initContext(),this.bindEvent(),this.history=new Wt(this),this.memoCanvas.width=i.width,this.memoCanvas.height=i.height,this.memoCanvas.style.width=`${i.clientWidth}px`,this.memoCanvas.style.height=`${i.clientHeight}px`;const d=this.memoCanvas.getContext("2d");!d||(d.scale(2,2),window.canvasBoard=this)}}let S=[];const Ut=[{type:m.ERASER,name:"\u6A61\u76AE"},{type:m.LINE,name:"\u94C5\u7B14"},{type:m.CIRCLE,name:"\u5706"},{type:m.RECTANGLE,name:"\u77E9\u5F62"},{type:m.POLYGON,name:"\u94A2\u7B14"},{type:m.ARROW,name:"\u7BAD\u5934"}],Gt=()=>{const e=Z(null),i=Z(),[t,n]=I(m.POLYGON),[a,d]=I(),[s,h]=I(2),[r,o]=I(!1);pt(()=>{const g=e.current;if(!g)return;const x=i.current=new It(g,t,s,a);x.onPenPointChange=C=>{S=C,o(C.length>2)}},[]);const l=()=>{var g;return(g=i.current)==null?void 0:g.clearBoard()},c=()=>{var g;return(g=i.current)==null?void 0:g.downloadBoard()},u=g=>{var x;(x=i.current)==null||x.setDrawType(g),n(g),e.current},v=g=>{var x;(x=i.current)==null||x.setColor(g),d(g)},f=g=>{var x;(x=i.current)==null||x.setLineWidth(g),h(g)},p=async()=>{const g=e.current;if(!g)return;const x=g.getContext("2d");if(!x)return;const{left:C,top:k,width:P,height:O}=J(S),M=W(),K=x.getImageData(C*M,k*M,P*M,O*M),B=await Lt(K,S);B&&ut(B)},E=[y.RED,y.GREEN,y.BLUE,y.YELLOW].map(g=>({name:w("span",{className:"inline-block h-[18px] w-[18px] rounded-full",style:{backgroundColor:g}}),onClick:()=>v(g),selected:a===g})),b=Ut.map(g=>({name:g.name,onClick:()=>u(g.type),selected:t===g.type})),R=[{name:"\u6E05\u9664",onClick:l},{name:"\u4E0B\u8F7D",onClick:c},...b,...E,{name:"\u64A4\u9500",onClick:()=>{var g;return(g=i.current)==null?void 0:g.undo()}},{name:"\u91CD\u505A",onClick:()=>{var g;return(g=i.current)==null?void 0:g.redo()}},{name:w("input",{type:"color",className:"h-5 border-0 bg-transparent",onChange:g=>{const x=g==null?void 0:g.target.value;v(x)}}),onClick:()=>{},selected:![y.RED,y.GREEN,y.BLUE,y.YELLOW].find(g=>a===g)},{name:w(st,{children:[w("span",{children:"0"}),w("div",{className:"relative flex items-center",children:[w("span",{className:"absolute -top-1.5 text-xs",style:{left:`${s}px`},children:s}),w("input",{type:"range",value:s,className:"h-6 w-[116px] border-0 bg-transparent",onChange:g=>{const x=g==null?void 0:g.target.value;Number(x)<1||f(Number(x))}})]}),w("span",{children:"100"})]}),onClick:()=>{},selected:![y.RED,y.GREEN,y.BLUE,y.YELLOW].find(g=>a===g)},{name:"\u4E0B\u8F7D\u94A2\u7B14\u533A\u57DF",onClick:p,disabled:!r}];return w("section",{className:"pt-2",children:[w("h1",{className:"mb-4 border-b text-2xl",children:"\u767D\u677F"}),w("div",{className:"mt-2 flex flex-wrap",children:R.map(({onClick:g,name:x,selected:C,disabled:k},P)=>w("button",{onClick:g,disabled:k,className:xt("relative ml-2 mb-2 flex items-center rounded border py-1 px-4 text-sm ",C&&"border-blue-500",k&&"opacity-30"),children:x},P))}),w("canvas",{ref:e,style:{width:"100%",height:600},className:"mt-2 border"})]})},Yt=()=>w(st,{children:w(Gt,{})});var jt=Object.freeze(Object.defineProperty({__proto__:null,default:Yt},Symbol.toStringTag,{value:"Module"}));export{yt as C,G as _,Y as a,tt as b,J as c,D as d,ut as e,jt as f,W as g,Lt as i,Ot as u};
