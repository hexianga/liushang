var Ie=Object.defineProperty,_e=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var xe=(e,t,s)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,W=(e,t)=>{for(var s in t||(t={}))$e.call(t,s)&&xe(e,s,t[s]);if(pe)for(var s of pe(t))Pe.call(t,s)&&xe(e,s,t[s]);return e},U=(e,t)=>_e(e,Oe(t));import{r as x,j as i}from"./index.48f1ff14.js";import{i as Te,a as he,b as te,c as O}from"./index.c8067074.js";import{d as _}from"./dayjs.min.9bf2e87d.js";import{i as oe,S as Ge,b as we,k as Ce,a as We,g as M,O as y,c as k,d as Ue,e as ae,W as re,f as S,h as He,j as ze,l as X,m as q,M as Ke}from"./dates.52e295fa.js";import{n as Z}from"./number.0f6f4a78.js";import{g as qe,a as me,r as ge,d as Xe,c as Ze}from"./intersection-ratio.3bc624a7.js";import{A as J,a as Q}from"./index.esm.e49eafa5.js";import{v as R}from"./v4.90f1a8cc.js";import{s as Je,o as Qe,i as le,b as ie,a as je,t as Ae,h as Ve,c as se,d as et}from"./hasIn.72f8e118.js";import{i as tt,e as st,a as Ne}from"./_arrayPush.aec3fb28.js";import"./index.563d4b32.js";import"./_commonjsHelpers.294d03c4.js";function nt(e,t){return Je(Qe(e,t,le),e+"")}function De(e,t,s){if(!Te(s))return!1;var n=typeof t;return(n=="number"?oe(s)&&tt(t,s.length):n=="string"&&t in s)?st(s[t],e):!1}function rt(e,t,s){var n=e==null?void 0:ie(e,t);return n===void 0?s:n}var ct=1,ot=2;function at(e,t,s,n){var r=s.length,c=r,o=!n;if(e==null)return!c;for(e=Object(e);r--;){var l=s[r];if(o&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++r<c;){l=s[r];var u=l[0],a=e[u],f=l[1];if(o&&l[2]){if(a===void 0&&!(u in e))return!1}else{var b=new Ge;if(n)var d=n(a,f,u,e,t,b);if(!(d===void 0?we(f,a,ct|ot,n,b):d))return!1}}return!0}function Me(e){return e===e&&!Te(e)}function lt(e){for(var t=Ce(e),s=t.length;s--;){var n=t[s],r=e[n];t[s]=[n,r,Me(r)]}return t}function Le(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==void 0||e in Object(s))}}function it(e){var t=lt(e);return t.length==1&&t[0][2]?Le(t[0][0],t[0][1]):function(s){return s===e||at(s,e,t)}}var ft=1,ut=2;function bt(e,t){return je(e)&&Me(t)?Le(Ae(e),t):function(s){var n=rt(s,e);return n===void 0&&n===t?Ve(s,e):we(t,n,ft|ut)}}function dt(e){return function(t){return t==null?void 0:t[e]}}function pt(e){return function(t){return ie(t,e)}}function xt(e){return je(e)?dt(Ae(e)):pt(e)}function ht(e){return typeof e=="function"?e:e==null?le:typeof e=="object"?Ne(e)?bt(e[0],e[1]):it(e):xt(e)}function mt(e){return function(t,s,n){for(var r=-1,c=Object(t),o=n(t),l=o.length;l--;){var u=o[e?l:++r];if(s(c[u],u,c)===!1)break}return t}}var gt=mt(),Dt=gt;function yt(e,t){return e&&Dt(e,t,Ce)}function Et(e,t){return function(s,n){if(s==null)return s;if(!oe(s))return e(s,n);for(var r=s.length,c=t?r:-1,o=Object(s);(t?c--:++c<r)&&n(o[c],c,o)!==!1;);return s}}var vt=Et(yt),Tt=vt;function wt(e,t){var s=-1,n=oe(e)?Array(e.length):[];return Tt(e,function(r,c,o){n[++s]=t(r,c,o)}),n}function Ct(e,t){var s=e.length;for(e.sort(t);s--;)e[s]=e[s].value;return e}function jt(e,t){if(e!==t){var s=e!==void 0,n=e===null,r=e===e,c=he(e),o=t!==void 0,l=t===null,u=t===t,a=he(t);if(!l&&!a&&!c&&e>t||c&&o&&u&&!l&&!a||n&&o&&u||!s&&u||!r)return 1;if(!n&&!c&&!a&&e<t||a&&s&&r&&!n&&!c||l&&s&&r||!o&&r||!u)return-1}return 0}function At(e,t,s){for(var n=-1,r=e.criteria,c=t.criteria,o=r.length,l=s.length;++n<o;){var u=jt(r[n],c[n]);if(u){if(n>=l)return u;var a=s[n];return u*(a=="desc"?-1:1)}}return e.index-t.index}function Nt(e,t,s){t.length?t=se(t,function(c){return Ne(c)?function(o){return ie(o,c.length===1?c[0]:c)}:c}):t=[le];var n=-1;t=se(t,We(ht));var r=wt(e,function(c,o,l){var u=se(t,function(a){return a(c)});return{criteria:u,index:++n,value:c}});return Ct(r,function(c,o){return At(c,o,s)})}var Mt=nt(function(e,t){if(e==null)return[];var s=t.length;return s>1&&De(e,t[0],t[1])?t=[]:s>2&&De(t[0],t[1],t[2])&&(t=[t[0]]),Nt(e,et(t,1),[])}),ye=Mt;const G=10,Ee=10,B=10,ne=5;var F=(e=>(e.DAY="day",e.MONTH="month",e.WEEK="week",e.YEAR="year",e))(F||{});const Fe=(e,t)=>{const s=[],n=[];return t.forEach(r=>{const{startTime:c,endTime:o}=r;if(!c&&!o)return;const l=M(c!=null?c:0),u=M(o!=null?o:0);(l===e||u===e||l<=e&&u>=e+y)&&(c&&!o||!c&&o||l<=e&&u>e+y?s.push(r):n.push(r))}),n.sort((r,c)=>(r.startTime||r.endTime||0)-(c.startTime||c.endTime||0)),n.forEach((r,c)=>{var b;if(c===0){r.left=0;return}const o=n[c-1];if(!o)return;const{startTime:l,endTime:u}=r;let a=0;const f=l||u||0;f>=(o.startTime||o.endTime||0)&&f<(o.endTime||o.startTime||0)&&(a+=1),a===0?r.left=0:r.left=((b=o.left)!=null?b:0)+a}),n.forEach((r,c)=>{if(r.left===0){const o=n.slice(c+1),l=o.findIndex(u=>u.left===0);l===-1?r.all=o.length+1:r.all=1+l}else{const l=[...n.slice(0,c)].reverse().find(u=>u.left===0);r.all=l==null?void 0:l.all}}),{allDay:s,timeRange:n}},ve=e=>(new Date().setSeconds(0,0)-M(Date.now()))/k*e+B,Ye=({date:e,viewType:t,unitHeight:s=G})=>{const[n,r]=x.exports.useState(ve(s)),c=x.exports.useRef(),o=x.exports.useRef(null),l=x.exports.useRef(null),u=M(Date.now());if(x.exports.useEffect(()=>(c.current=setInterval(()=>{r(ve(s))},Ue),()=>{c.current&&clearInterval(c.current)}),[s]),x.exports.useEffect(()=>{const a=o.current,f=l.current;if(!(!a||!f)){if(t===F.DAY)a.style.left="-5px";else if(t===F.WEEK){const d=(u-e)/y;a.style.left=`${f.clientWidth/7*d-4}px`}}},[e,u,t]),t===F.DAY){if(e!==u)return null}else if(t===F.WEEK&&ae()!==e)return null;return i.exports.jsxs("div",{className:"absolute right-0 border-t border-red-500",style:{top:n,left:1},ref:l,children:[i.exports.jsx("span",{className:"absolute -ml-2 -translate-x-full -translate-y-1/2 text-xs text-red-500",children:_(new Date).format("HH:mm")}),i.exports.jsx("span",{ref:o,className:"absolute overflow-hidden rounded-full bg-red-500 p-1 text-red-500",style:{top:-4}})]})},H=(e,t)=>{e-=B;let s=Math.floor(e/t);return s=e-s*t>t/2?s+1:s,s},Lt=(e,t,s,n=G)=>{const{autoScrollY:r,rafY:c}=qe(),o=B,l=t.scrollHeight-B,u=b=>{b.preventDefault();const d=b.target;if(!d)return;let p=b.clientY;const m=d.classList.contains("resize-top"),g={top:parseInt(e.style.top),height:parseInt(e.style.height),bottom:parseInt(e.style.height)+parseInt(e.style.top)},h=A=>{r({y:A.clientY,container:t}),p=A.clientY,E()},E=()=>{const A=t.scrollTop,C=t.getBoundingClientRect(),Y=p-C.y;if(m){let w=Y+A;const v=w<o?o:w;w=H(v,n)*n+B;const j=te(w,o,g.bottom),L=w>g.bottom?Math.min(w,l)-g.bottom:g.bottom-w;e.style.top=`${j}px`,e.style.height=`${Math.max(L,Ee)}px`}else{let w=Y+A;w=H(w,n)*n+B;const T=te(w,o,l),j=w>g.top?g.top:T,L=Math.abs(T-g.top);e.style.top=`${j}px`,e.style.height=`${Math.max(L,Ee)}px`}},D=()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",D),t.removeEventListener("scroll",E),cancelAnimationFrame(c.id);const A=parseInt(e.style.top),C=parseInt(e.style.height),Y=H(A,n);s==null||s(Y,C<n?0:C/n)};document.addEventListener("mousemove",h),document.addEventListener("mouseup",D),t.addEventListener("scroll",E)},a=b=>{if(b.preventDefault(),!b.target)return;let p=b.clientY;const m=e.getBoundingClientRect(),g=b.clientY-m.top,h={top:parseInt(e.style.top),height:parseInt(e.style.height),bottom:parseInt(e.style.height)+parseInt(e.style.top)},E=C=>{r({y:C.clientY,container:t}),p=C.clientY,D()},D=()=>{const C=t.scrollTop,Y=t.getBoundingClientRect(),w=p-Y.y,v=te(w+C-g,o,l-h.height),j=H(v,n)*n+B;e.style.top=`${j}px`},A=()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",A),t.removeEventListener("scroll",D),cancelAnimationFrame(c.id);const C=parseInt(e.style.top),Y=parseInt(e.style.height),w=H(C,n);s==null||s(w,Y<n?0:Y/n)};document.addEventListener("mousemove",E),document.addEventListener("mouseup",A),t.addEventListener("scroll",D)},f=b=>{const d=b.target;if(!d)return;d.classList.contains("resize-top")||d.classList.contains("resize-bottom")?u(b):a(b)};return e.addEventListener("mousedown",f),()=>{e.removeEventListener("mousedown",f)}},Se=e=>{const{todo:t,base:s,container:n,setTodoList:r,unitHeight:c,viewType:o}=e,{startTime:l,endTime:u,title:a,left:f=0,all:b=1}=t,d=x.exports.useRef(null);return x.exports.useEffect(()=>{const p=d.current,m=n.current;if(!p||!m)return;const h=Lt(p,m,(E,D)=>{console.log(E,D),r(A=>A.map(C=>C.id===t.id?(console.log("==="),U(W({},C),{startTime:s+E*k,endTime:s+E*k+D*k})):C))},c);return()=>{h()}},[n,r,s,t.id,c]),x.exports.useEffect(()=>{const p=d.current,m=n.current;if(!p||!m)return;const g=(b-1)*ne;if(o===F.DAY){const E=(m.clientWidth-55-g)/b;p.style.width=`${E}px`,p.style.left=`${(E+ne)*f}px`}else{const h=(m.clientWidth-55)/7,D=(h-g)/b,A=new Date(s).getDay()||7;p.style.width=`${D}px`,p.style.left=`${(D+ne)*f+(A-1)*h}px`}p.style.opacity="1"},[b,s,n,f,o]),!l||!u?null:i.exports.jsxs("div",{ref:d,className:"absolute min-h-[10px] rounded border bg-green-100",style:{opacity:"0",top:(l-s)/k*c+B,height:(u-l)/k*c},children:[a,i.exports.jsx("div",{className:"resize-top"}),i.exports.jsx("div",{className:"resize-bottom"})]})},Ft=({setMonday:e,monday:t})=>{const s=`${_().format("YYYY\u5E74MM\u6708DD\u65E5")} \u5468${re[_().day()]}`;return i.exports.jsxs("div",{className:"border-b",children:[i.exports.jsxs("div",{className:"flex items-center py-1",children:[i.exports.jsx("p",{className:"mr-auto",children:s}),i.exports.jsx("button",{onClick:()=>e(t-y*7),className:"rounded hover:bg-gray-200",children:i.exports.jsx(J,{className:"h-5 w-5"})}),i.exports.jsx("button",{className:"mx-2 cursor-pointer bg-white  px-2",onClick:()=>e(ae()),children:"\u4ECA\u5929"}),i.exports.jsx("button",{onClick:()=>e(t+y*7),className:"rounded hover:bg-gray-200",children:i.exports.jsx(Q,{className:"h-5 w-5"})})]}),i.exports.jsxs("div",{className:"flex items-center justify-between py-2",children:[i.exports.jsxs("div",{className:"w-[55px] text-center",children:[_(t+6*y).format("MM"),"\u6708"]}),new Array(7).fill(1).map((n,r)=>{const c=t+r*y,o=_(c),l=c===M(Date.now()),u=`${o.format("DD")} \u5468${re[o.day()]} `;return i.exports.jsx("div",{className:O("h-full flex-1",l?"text-red-500":""),children:u},c)})]})]})},Yt=e=>[{id:R(),title:2,startTime:e+2*S,endTime:e+6*S,num:5},{id:R(),title:4,startTime:e+4*S,endTime:e+7*S,num:5},{id:R(),title:5,startTime:e+5*S,endTime:e+8*S,num:5},{id:R(),title:7,startTime:e+5*S,endTime:e+10*S,num:5}],St=Yt(M(Date.now())),Bt=()=>{const[e,t]=x.exports.useState(ae(Date.now())),[s,n]=x.exports.useState(St),r=x.exports.useRef(null),c=u=>{const a=r.current;if(!a)return;const f=a.getBoundingClientRect(),b=u.clientY-f.y,d=a.scrollTop+b-B,p=Math.floor(d/G),m=e+p*k,g=m+S;m>=e+y||n(h=>h.concat({id:R(),title:1,startTime:m,endTime:g}))},o=()=>{n(u=>u.concat({id:R(),title:1,startTime:e,endTime:e}))},l=[];return new Array(7).fill(1).forEach((u,a)=>{const f=e+a*y,{timeRange:b,allDay:d}=Fe(f,s);l.push(b)}),console.log(l),i.exports.jsxs("div",{className:"relative flex flex-1 flex-col overflow-auto",children:[i.exports.jsx(Ft,{setMonday:t,monday:e}),i.exports.jsxs("div",{className:"relative flex h-10 border-b border-gray-300",children:[i.exports.jsx("div",{className:"flex w-14 items-center justify-end pr-2",children:"\u5168\u5929"}),i.exports.jsx("div",{className:"flex flex-1",onDoubleClick:o,children:i.exports.jsx("div",{className:"pointer-events-none absolute left-[55px] right-0 top-0 h-full",children:new Array(7).fill(1).map((u,a)=>i.exports.jsx("div",{className:"absolute top-0 bottom-0 w-[1px] bg-gray-200",style:{left:Z(a/7)}},a))})})]}),i.exports.jsx("div",{className:"flex-1 overflow-auto",onDoubleClick:c,ref:r,children:i.exports.jsxs("div",{className:"relative left-[55px]",style:{paddingTop:B,paddingBottom:B,width:"calc(100% - 55px)",height:24*G*4,boxSizing:"content-box"},children:[i.exports.jsxs("div",{className:"pointer-events-none",children:[new Array(24).fill(1).map((u,a)=>{const f=_(e+a*k*4).format("HH:mm");return i.exports.jsxs("div",{style:{height:a===24?0:G*4},className:O("relative border-l border-t border-gray-200",a===23?"border-b":""),children:[i.exports.jsx("span",{className:"absolute -ml-2 -translate-x-full -translate-y-1/2 text-xs",children:f}),a===23&&i.exports.jsx("span",{className:"absolute bottom-0 -ml-2 -translate-x-full translate-y-1/2 text-xs",children:"00:00"})]},a)}),new Array(7).fill(1).map((u,a)=>i.exports.jsx("div",{className:"absolute top-0 bottom-0 w-[1px] bg-gray-200",style:{left:Z(a/7)}},a))]}),i.exports.jsx("div",{className:"absolute top-0 right-0 bottom-0 left-0",onDoubleClick:u=>u.stopPropagation(),children:l.map((u,a)=>u.map(f=>i.exports.jsx(Se,{base:a*y+e,todo:f,viewType:F.WEEK,unitHeight:G,setTodoList:n,container:r},f.id)))}),i.exports.jsx(Ye,{date:e,viewType:F.WEEK})]})})]})},Rt=e=>[{id:R(),title:2,startTime:e+1*S,endTime:e+2*S,num:1},{id:R(),title:4,startTime:e+4*S,endTime:e+7*S,num:5}],kt=Rt(M(Date.now())),It=()=>{const[e,t]=x.exports.useState(M(Date.now())),[s,n]=x.exports.useState(kt),r=x.exports.useRef(null),[c]=x.exports.useState(G),o=d=>{const p=r.current;if(!p)return;const m=p.getBoundingClientRect(),g=d.clientY-m.y,h=p.scrollTop+g-B,E=Math.floor(h/c),D=e+E*k,A=D+S;D>=e+y||n(C=>C.concat({id:R(),title:1,startTime:D,endTime:A}))},l=()=>{n(d=>d.concat({id:R(),title:1,startTime:e,endTime:e}))},u=_(e).format("YYYY\u5E74MM\u6708DD\u65E5"),a=re[_(e).day()],{allDay:f,timeRange:b}=Fe(e,s);return i.exports.jsxs("div",{className:"relative flex flex-1 flex-col overflow-auto",children:[i.exports.jsxs("div",{className:"flex items-center border-b py-1",children:[i.exports.jsx("p",{className:"mr-auto",children:`${u} \u5468${a}`}),i.exports.jsx("button",{onClick:()=>t(e-y),className:"rounded hover:bg-gray-200",children:i.exports.jsx(J,{className:"h-5 w-5"})}),i.exports.jsx("button",{className:"mx-2 cursor-pointer bg-white  px-2",onClick:()=>{t(M(Date.now()))},children:"\u4ECA\u5929"}),i.exports.jsx("button",{onClick:()=>t(e+y),className:"rounded hover:bg-gray-200",children:i.exports.jsx(Q,{className:"h-5 w-5"})})]}),i.exports.jsxs("div",{className:"flex h-10 border-b",children:[i.exports.jsx("div",{className:"flex w-14 items-center justify-end pr-2",children:"\u5168\u5929"}),i.exports.jsx("div",{className:"flex flex-1",onDoubleClick:l,children:f.map(d=>{const{id:p,title:m}=d;return i.exports.jsx("div",{className:"flex-1 rounded border bg-red-200",children:m},p)})})]}),i.exports.jsx("div",{className:"flex-1 overflow-auto",onDoubleClick:o,ref:r,children:i.exports.jsxs("div",{className:"relative left-[55px]",style:{paddingTop:B,paddingBottom:B,width:"calc(100% - 55px)",height:24*c*4,boxSizing:"content-box"},children:[i.exports.jsx("div",{className:"pointer-events-none",children:new Array(24).fill(1).map((d,p)=>i.exports.jsxs("div",{style:{height:c*4},className:O("relative border-l border-t",p===23?"border-b":""),children:[i.exports.jsx("span",{className:"absolute -ml-2 -translate-x-full -translate-y-1/2 text-xs",children:_(e+p*k*4).format("HH:mm")}),p===23&&i.exports.jsx("span",{className:"absolute bottom-0 -ml-2 -translate-x-full translate-y-1/2 text-xs",children:_(e+(p+1)*k*4).format("HH:mm")})]},p))}),i.exports.jsx("div",{className:"absolute top-0 left-0 right-0",onDoubleClick:d=>d.stopPropagation(),children:b.map(d=>{const{startTime:p,endTime:m}=d;return!p||!m||p<e||p>e+y?null:i.exports.jsx(Se,{base:e,todo:d,viewType:F.DAY,unitHeight:c,setTodoList:n,container:r},d.id)})}),i.exports.jsx(Ye,{date:e,viewType:F.DAY,unitHeight:c})]})})]})},_t=(e,t,s,n,r,c)=>{const o=a=>{const f=a.target;if(!f)return;f.classList.contains("resize-left")||f.classList.contains("resize-right")?l(a):u(a)},l=a=>{a.preventDefault(),a.stopPropagation();const f=a.target;if(!f)return;const b=f.classList.contains("resize-left");let d,p={x:a.clientX,y:a.clientY};const m=D=>{p={x:D.clientX,y:D.clientY},me({y:D.clientY,container:s}),E(D.clientX,D.clientY)},g=()=>{s.removeEventListener("scroll",h),document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",g),cancelAnimationFrame(ge)},h=()=>E(p.x,p.y),E=(D,A)=>{let C=1/0;s.querySelectorAll(".calendar-date").forEach((w,v)=>{const T=w.getBoundingClientRect(),j=Xe(Ze(T),{x:D,y:A});j<C&&(C=j,d=v)}),typeof d!="undefined"&&(n==null||n(d,b))};s.addEventListener("scroll",h),document.addEventListener("mousemove",m),document.addEventListener("mouseup",g)},u=a=>{a.preventDefault();const f={x:a.clientX,y:a.clientY},b=a.currentTarget,d=b.getBoundingClientRect(),p=d.width/(parseFloat(b.style.width)/100)/7,m=c.current+Math.floor((a.clientX-d.left)/p)*y;let g=!1,h,E,D={x:a.clientX,y:a.clientY};const A=v=>{D={x:v.clientX,y:v.clientY},!(!g&&Math.abs(v.clientX-f.x)<5&&Math.abs(v.clientY-f.y)<5)&&(g||(g=!0,h=document.createElement("div"),h.style.position="fixed",h.style.inset="0",h.style.zIndex="100",s.querySelectorAll(`[data-todo-id="${e}"]`).forEach(j=>{const L=j.getBoundingClientRect(),N=j.cloneNode(!0);N.style.position="absolute",N.style.width=`${L.width}px`,N.style.height=`${L.height}px`,N.style.top=`${L.top}px`,N.style.left=`${L.left}px`,h==null||h.appendChild(N)}),document.body.appendChild(h)),me({y:v.clientY,container:s}),C(v.clientX,v.clientY))},C=(v,T)=>{if(!h)return;h.style.transform=`translate(${v-f.x}px, ${T-f.y}px)`;const j=s.querySelector(".calendar-date.drag-hover-highlight");j==null||j.classList.remove("drag-hover-highlight");const L=s.querySelectorAll(".calendar-date");Array.from(L).find((N,P)=>{const $=N.getBoundingClientRect(),K=v>=$.left&&v<=$.right&&T>=$.top&&T<=$.bottom;return K&&(E=P,N.classList.add("drag-hover-highlight")),K})},Y=()=>{s.removeEventListener("scroll",w),document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",Y),cancelAnimationFrame(ge),h==null||h.remove();const v=s.querySelector(".calendar-date.drag-hover-highlight");v==null||v.classList.remove("drag-hover-highlight"),!!g&&typeof E!="undefined"&&(r==null||r(E,m))},w=()=>C(D.x,D.y);s.addEventListener("scroll",w),document.addEventListener("mousemove",A),document.addEventListener("mouseup",Y)};return t.addEventListener("mousedown",o),()=>{t.removeEventListener("mousedown",o)}},Ot=4,$t=4,Pt=22,Be=36,ce=(e=1)=>Ot*2+Pt*e+$t;var I=(e=>(e.SINGLE="SINGLE",e.MULTIPLE="MULTIPLE",e))(I||{});const Re=x.exports.createContext(void 0),ke=x.exports.createContext(void 0),V=()=>{const e=x.exports.useContext(Re);if(!e)throw new Error("useCalender");return e},fe=()=>{const e=x.exports.useContext(ke);if(!e)throw new Error("useCalender");return e},Gt=x.exports.memo(e=>{var h;const{id:t,renderStartDate:s,weekStartDate:n,weekEndDate:r,weekFirstDay:c,isStartDate:o,isEndDate:l,order:u}=e,{container:a,calenderDatesRef:f}=V(),{todoListRef:b,setTodoList:d}=fe(),p=x.exports.useRef(null),m=x.exports.useRef(s);m.current=s,x.exports.useEffect(()=>{const E=p.current,D=a.current;if(!E||!D)return;const Y=_t(t,E,D,(w,v)=>{const T=f.current[w],j=b.current.find(L=>L.id===t);!j||(v&&j.startTime!==T||!v&&j.endTime!==T)&&d(L=>L.map(N=>N.id===t&&N.endTime&&N.startTime?U(W({},N),{startTime:v&&T<=N.endTime?T:N.startTime,endTime:!v&&T>=N.startTime?T:N.endTime}):N))},(w,v)=>{const T=b.current.find(P=>P.id===t);if(!T||!T.startTime||!T.endTime)return;const j=f.current[w];if(j===v)return;const L=j-(v-T.startTime),N=L+T.endTime-T.startTime;d(P=>P.map($=>$.id===t?U(W({},$),{startTime:L,endTime:N}):$))},m);return()=>{Y()}},[f,a,t,d,b,p]);const g={top:u*ce()+Be,left:Z((n-c)/y/7),width:Z(((r-n)/y+1)/7),height:ce()};return i.exports.jsx("div",{ref:p,"data-todo-id":t,className:O("absolute cursor-pointer pb-1",{"pl-1":o,"pr-1":l}),style:g,children:i.exports.jsxs("div",{className:O("relative h-full border bg-green-300 p-1",{"rounded-l":o,"rounded-r":l}),children:[i.exports.jsx("span",{children:(h=b.current.find(E=>E.id===t))==null?void 0:h.title}),i.exports.jsx("div",{className:"resize-left"}),i.exports.jsx("div",{className:"resize-right"})]})},t)}),Wt=(e,t)=>{const{todoList:s}=fe(),n=[];s.forEach(({startTime:o,endTime:l,id:u})=>{if(!o||!l)return;const a=o||l,f=l||o;if(!a||!f)return;const b=M(a),d=M(f);if(d<e||b>t)return;const p=b>=e&&b<=t?b:e,m=d>=e&&d<=t?d:t;n.push({id:u,rawStartTime:o,rawEndTime:l,renderStartDate:a,renderEndDate:f,weekStartDate:p,weekEndDate:m,isStartDate:p===b,isEndDate:m===d,order:0})});const r=ye(n,o=>o.weekStartDate),c={};return r.forEach(o=>{var f,b;let l=0;const u=c[o.weekStartDate];u&&(l=Object.entries(ye(u)).findIndex(([d,p])=>Number(d)!==p),l=l===-1?u.length:l);let a=o.weekStartDate;for(;a<=o.weekEndDate;)c[a]=(f=c[a])!=null?f:[],(b=c[a])==null||b.push(l),a+=y;o.order=l}),r},Ut=x.exports.memo(({firstDay:e,lastDay:t,weekRef:s})=>{const n=Wt(e,t);return x.exports.useEffect(()=>{const r=s.current;if(!r)return;const c=124;if(n.length===0)r.style.height=`${c}px`;else{const o={};n.forEach(a=>{let f=a.weekStartDate;for(;f<=a.weekEndDate;)o[f]=(o[f]||0)+1,f=f+y});const u=Math.max(...Object.values(o))*ce()+Be;r.style.height=`${Math.max(u,c)}px`}},[n,s]),n.length===0?null:i.exports.jsx(i.exports.Fragment,{children:n.map(r=>x.exports.createElement(Gt,U(W({},r),{weekFirstDay:e,key:r.id})))})}),Ht={lunarInfo:[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,92821,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42416,83315,21168,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46752,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,23232,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19195,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448,84835,37744,18936,18800,25776,92326,59984,27424,108228,43744,37600,53987,51552,54615,54432,55888,23893,22176,42704,21972,21200,43448,43344,46240,46758,44368,21920,43940,42416,21168,45683,26928,29495,27296,44368,84821,19296,42352,21732,53600,59752,54560,55968,92838,22224,19168,43476,41680,53584,62034,54560],solarMonth:[31,28,31,30,31,30,31,31,30,31,30,31],Gan:["\u7532","\u4E59","\u4E19","\u4E01","\u620A","\u5DF1","\u5E9A","\u8F9B","\u58EC","\u7678"],Zhi:["\u5B50","\u4E11","\u5BC5","\u536F","\u8FB0","\u5DF3","\u5348","\u672A","\u7533","\u9149","\u620C","\u4EA5"],Animals:["\u9F20","\u725B","\u864E","\u5154","\u9F99","\u86C7","\u9A6C","\u7F8A","\u7334","\u9E21","\u72D7","\u732A"],festival:{"1-1":{title:"\u5143\u65E6\u8282"},"2-14":{title:"\u60C5\u4EBA\u8282"},"5-1":{title:"\u52B3\u52A8\u8282"},"5-4":{title:"\u9752\u5E74\u8282"},"6-1":{title:"\u513F\u7AE5\u8282"},"9-10":{title:"\u6559\u5E08\u8282"},"10-1":{title:"\u56FD\u5E86\u8282"},"12-25":{title:"\u5723\u8BDE\u8282"},"3-8":{title:"\u5987\u5973\u8282"},"3-12":{title:"\u690D\u6811\u8282"},"4-1":{title:"\u611A\u4EBA\u8282"},"5-12":{title:"\u62A4\u58EB\u8282"},"7-1":{title:"\u5EFA\u515A\u8282"},"8-1":{title:"\u5EFA\u519B\u8282"},"12-24":{title:"\u5E73\u5B89\u591C"}},lFestival:{"12-30":{title:"\u9664\u5915"},"1-1":{title:"\u6625\u8282"},"1-15":{title:"\u5143\u5BB5\u8282"},"2-2":{title:"\u9F99\u62AC\u5934"},"5-5":{title:"\u7AEF\u5348\u8282"},"7-7":{title:"\u4E03\u5915\u8282"},"7-15":{title:"\u4E2D\u5143\u8282"},"8-15":{title:"\u4E2D\u79CB\u8282"},"9-9":{title:"\u91CD\u9633\u8282"},"10-1":{title:"\u5BD2\u8863\u8282"},"10-15":{title:"\u4E0B\u5143\u8282"},"12-8":{title:"\u814A\u516B\u8282"},"12-23":{title:"\u5317\u65B9\u5C0F\u5E74"},"12-24":{title:"\u5357\u65B9\u5C0F\u5E74"}},getFestival(){return this.festival},getLunarFestival(){return this.lFestival},setFestival(e={}){this.festival=e},setLunarFestival(e={}){this.lFestival=e},solarTerm:["\u5C0F\u5BD2","\u5927\u5BD2","\u7ACB\u6625","\u96E8\u6C34","\u60CA\u86F0","\u6625\u5206","\u6E05\u660E","\u8C37\u96E8","\u7ACB\u590F","\u5C0F\u6EE1","\u8292\u79CD","\u590F\u81F3","\u5C0F\u6691","\u5927\u6691","\u7ACB\u79CB","\u5904\u6691","\u767D\u9732","\u79CB\u5206","\u5BD2\u9732","\u971C\u964D","\u7ACB\u51AC","\u5C0F\u96EA","\u5927\u96EA","\u51AC\u81F3"],sTermInfo:["9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c3598082c95f8c965cc920f","97bd0b06bdb0722c965ce1cfcc920f","b027097bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd0b06bdb0722c965ce1cfcc920f","b027097bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd0b06bdb0722c965ce1cfcc920f","b027097bd097c36b0b6fc9274c91aa","9778397bd19801ec9210c965cc920e","97b6b97bd19801ec95f8c965cc920f","97bd09801d98082c95f8e1cfcc920f","97bd097bd097c36b0b6fc9210c8dc2","9778397bd197c36c9210c9274c91aa","97b6b97bd19801ec95f8c965cc920e","97bd09801d98082c95f8e1cfcc920f","97bd097bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c91aa","97b6b97bd19801ec95f8c965cc920e","97bcf97c3598082c95f8e1cfcc920f","97bd097bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c3598082c95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c3598082c95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd097bd07f595b0b6fc920fb0722","9778397bd097c36b0b6fc9210c8dc2","9778397bd19801ec9210c9274c920e","97b6b97bd19801ec95f8c965cc920f","97bd07f5307f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c920e","97b6b97bd19801ec95f8c965cc920f","97bd07f5307f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c91aa","97b6b97bd19801ec9210c965cc920e","97bd07f1487f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c9274c920e","97bcf7f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c91aa","97b6b97bd197c36c9210c9274c920e","97bcf7f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c920e","97b6b7f0e47f531b0723b0b6fb0722","7f0e37f5307f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36b0b70c9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e37f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc9210c8dc2","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0787b0721","7f0e27f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c91aa","97b6b7f0e47f149b0723b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c8dc2","977837f0e37f149b0723b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e37f5307f595b0b0bc920fb0722","7f0e397bd097c35b0b6fc9210c8dc2","977837f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0721","7f0e37f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc9210c8dc2","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f149b0723b0787b0721","7f0e27f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14998082b0723b06bd","7f07e7f0e37f149b0723b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e37f1487f595b0b0bb0b6fb0722","7f0e37f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e37f1487f531b0b0bb0b6fb0722","7f0e37f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e37f1487f531b0b0bb0b6fb0722","7f0e37f0e37f14898082b072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e37f0e37f14898082b072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f149b0723b0787b0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14998082b0723b06bd","7f07e7f0e47f149b0723b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14998082b0723b06bd","7f07e7f0e37f14998083b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14898082b0723b02d5","7f07e7f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e36665b66aa89801e9808297c35","665f67f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e36665b66a449801e9808297c35","665f67f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e36665b66a449801e9808297c35","665f67f0e37f14898082b072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e26665b66a449801e9808297c35","665f67f0e37f1489801eb072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722"],nStr1:["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D","\u4E03","\u516B","\u4E5D","\u5341"],nStr2:["\u521D","\u5341","\u5EFF","\u5345"],nStr3:["\u6B63","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D","\u4E03","\u516B","\u4E5D","\u5341","\u51AC","\u814A"],lYearDays:function(e){let t,s=348;for(t=32768;t>8;t>>=1)s+=this.lunarInfo[e-1900]&t?1:0;return s+this.leapDays(e)},leapMonth:function(e){return this.lunarInfo[e-1900]&15},leapDays:function(e){return this.leapMonth(e)?this.lunarInfo[e-1900]&65536?30:29:0},monthDays:function(e,t){return t>12||t<1?-1:this.lunarInfo[e-1900]&65536>>t?30:29},solarDays:function(e,t){if(t>12||t<1)return-1;const s=t-1;return s===1?e%4===0&&e%100!==0||e%400===0?29:28:this.solarMonth[s]},toGanZhiYear:function(e){var t=(e-3)%10,s=(e-3)%12;return t===0&&(t=10),s===0&&(s=12),this.Gan[t-1]+this.Zhi[s-1]},toAstro:function(e,t){const s="\u9B54\u7FAF\u6C34\u74F6\u53CC\u9C7C\u767D\u7F8A\u91D1\u725B\u53CC\u5B50\u5DE8\u87F9\u72EE\u5B50\u5904\u5973\u5929\u79E4\u5929\u874E\u5C04\u624B\u9B54\u7FAF",n=[20,19,21,21,21,22,23,23,23,23,22,22];return s.substr(e*2-(t<n[e-1]?2:0),2)+"\u5EA7"},toGanZhi:function(e){return this.Gan[e%10]+this.Zhi[e%12]},getTerm:function(e,t){if(e<1900||e>2100||t<1||t>24)return-1;const s=this.sTermInfo[e-1900],n=[];for(let r=0;r<s.length;r+=5){const c=parseInt("0x"+s.substr(r,5)).toString();n.push(c[0],c.substr(1,2),c[3],c.substr(4,2))}return parseInt(n[t-1])},toChinaMonth:function(e){if(e>12||e<1)return-1;let t=this.nStr3[e-1];return t+="\u6708",t},toChinaDay:function(e){let t;switch(e){case 10:t="\u521D\u5341";break;case 20:t="\u4E8C\u5341";break;case 30:t="\u4E09\u5341";break;default:t=this.nStr2[Math.floor(e/10)],t+=this.nStr1[e%10]}return t},getAnimal:function(e){return this.Animals[(e-4)%12]},solar2lunar:function(e,t,s){let n=parseInt(e),r=parseInt(t),c=parseInt(s);if(n<1900||n>2100||n===1900&&r===1&&c<31)return-1;let o;n?o=new Date(n,parseInt(r)-1,c):o=new Date;let l,u=0,a=0;n=o.getFullYear(),r=o.getMonth()+1,c=o.getDate();let f=(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())-Date.UTC(1900,0,31))/864e5;for(l=1900;l<2101&&f>0;l++)a=this.lYearDays(l),f-=a;f<0&&(f+=a,l--);let b=new Date,d=!1;b.getFullYear()===n&&b.getMonth()+1===r&&b.getDate()===c&&(d=!0);let p=o.getDay(),m=this.nStr1[p];p===0&&(p=7);const g=l;u=this.leapMonth(l);let h=!1;for(l=1;l<13&&f>0;l++)u>0&&l===u+1&&h===!1?(--l,h=!0,a=this.leapDays(g)):a=this.monthDays(g,l),h===!0&&l===u+1&&(h=!1),f-=a;f===0&&u>0&&l===u+1&&(h?h=!1:(h=!0,--l)),f<0&&(f+=a,--l);const E=l,D=f+1,A=r-1,C=this.toGanZhiYear(g),Y=this.getTerm(n,r*2-1),w=this.getTerm(n,r*2);let v=this.toGanZhi((n-1900)*12+r+11);c>=Y&&(v=this.toGanZhi((n-1900)*12+r+12));let T=!1,j=null;Y===c&&(T=!0,j=this.solarTerm[r*2-2]),w===c&&(T=!0,j=this.solarTerm[r*2-1]);const L=Date.UTC(n,A,1,0,0,0,0)/864e5+25567+10,N=this.toGanZhi(L+c-1),P=this.toAstro(r,c),$=n+"-"+r+"-"+c,K=g+"-"+E+"-"+D,ue=this.festival,be=this.lFestival,de=r+"-"+c;let ee=E+"-"+D;return E===12&&D===29&&this.monthDays(g,E)===29&&(ee="12-30"),{date:$,lunarDate:K,festival:ue[de]?ue[de].title:null,lunarFestival:be[ee]?be[ee].title:null,lYear:g,lMonth:E,lDay:D,Animal:this.getAnimal(g),IMonthCn:(h?"\u95F0":"")+this.toChinaMonth(E),IDayCn:this.toChinaDay(D),cYear:n,cMonth:r,cDay:c,gzYear:C,gzMonth:v,gzDay:N,isToday:d,isLeap:h,nWeek:p,ncWeek:"\u661F\u671F"+m,isTerm:T,Term:j,astro:P}},lunar2solar:function(e,t,s,n){e=parseInt(e),t=parseInt(t),s=parseInt(s),n=!!n;const r=this.leapMonth(e);if(this.leapDays(e),n&&r!==t||e===2100&&t===12&&s>1||e===1900&&t===1&&s<31)return-1;const c=this.monthDays(e,t);let o=c;if(n&&(o=this.leapDays(e,t)),e<1900||e>2100||s>o)return-1;let l=0,u;for(u=1900;u<e;u++)l+=this.lYearDays(u);let a=0,f=!1;for(u=1;u<t;u++)a=this.leapMonth(e),f||a<=u&&a>0&&(l+=this.leapDays(e),f=!0),l+=this.monthDays(e,u);n&&(l+=c);const b=Date.UTC(1900,1,30,0,0,0),d=new Date((l+s-31)*864e5+b),p=d.getUTCFullYear(),m=d.getUTCMonth()+1,g=d.getUTCDate();return this.solar2lunar(p,m,g)}},zt=x.exports.memo(({date:e,setTodoList:t})=>{const s=He(e),n=new Date(e),r=Ht.solar2lunar(n.getFullYear(),n.getMonth()+1,n.getDate());return x.exports.useMemo(()=>i.exports.jsxs("div",{className:"calendar-date group relative flex flex-1 justify-between border-r border-b px-2 text-right text-gray-200",children:[i.exports.jsx("button",{className:"absolute top-0.5 left-10 flex h-5 w-5 cursor-pointer items-center rounded border bg-white text-center text-sm text-black opacity-0 group-hover:opacity-100",onClick:()=>{t(c=>{var o;return c.concat({id:R(),title:((o=c[c.length-1].title)!=null?o:0)+1,startTime:e,endTime:e})})},children:"+"}),i.exports.jsx("span",{className:O(s&&"inline-block h-6 w-6 rounded-full bg-red-500 text-center font-bold text-white"),children:n.getDate()}),r!==-1&&i.exports.jsx("span",{className:O("ml-1 ",(r.lunarFestival||r.Term)&&"text-red-400"),children:r.lunarFestival||r.Term?r.lunarFestival||r.Term:r.lDay===1?r.IMonthCn:r.IDayCn})]}),[e,n,r,t,s])}),Kt=x.exports.memo(({dates:e,setCurrentMonth:t,setTodoList:s})=>{const{container:n,calenderHeader:r,showType:c}=V(),o=x.exports.useRef(null);return x.exports.useEffect(()=>{if(c===I.SINGLE)return;const l=n.current;if(!l)return;const u=()=>{var b;if(!o.current||!r.current)return;const a=(b=o.current)==null?void 0:b.getBoundingClientRect(),f=r.current.getBoundingClientRect();f.bottom>a.top&&f.bottom<a.bottom&&t(d=>{const p=e[e.length-1]+y;return p!==d?M(new Date(p).setDate(1)):d})};l.addEventListener("scroll",u)},[r,n,e,t,c]),i.exports.jsxs("div",{className:"calendar-week relative flex min-h-[96px] w-full",ref:o,children:[e.map(l=>i.exports.jsx(zt,{date:l,setTodoList:s},l)),i.exports.jsx(Ut,{firstDay:e[0],lastDay:e[e.length-1],weekRef:o})]})},ze),z=(e="init",t)=>{let s=0,n=0;if(e==="init"){const o=t?new Date(t):new Date,l=o.getMonth(),u=o.setMonth(l,1),a=o.setMonth(l+2,0);s=M(u-((new Date(u).getDay()||7)-1)*y)-y,n=M(a-((new Date(a).getDay()||7)-1)*y)+y*5}if(e==="append"&&t){const o=new Date(t),l=o.setMonth(o.getMonth()+2,0);s=t,n=M(l-((new Date(l).getDay()||7)-1)*y)+y*5}const r=[];let c=s;for(;c<=n;)r.push(c),c+=y;return r},qt=(e,t,s)=>{const n=M(new Date(e).setDate(1)),r=M(new Date(e).setMonth(new Date(e).getMonth()+1,0)),c=t.indexOf(n),o=(r-n)/y+1;s.querySelectorAll(".calendar-date.current-month").forEach(a=>a.classList.remove("current-month"));const u=s.querySelectorAll(".calendar-date");Array.from(u).slice(c,c+o).forEach(a=>{a.classList.add("current-month")})},Xt=({currentMonth:e,setCurrentMonth:t})=>{const{calenderHeader:s,setCalenderDates:n,container:r,calenderDates:c,showType:o,setShowType:l}=V();x.exports.useEffect(()=>{const f=r.current;!f||qt(e,c,f)},[c,r,e]);const u=f=>{let b=Date.now();if(f==="today")b=new Date().setDate(1);else{const d=new Date(e),p=d.getMonth(),m=f==="pre"?p-1:p+1;b=d.setMonth(m,1)}if(t(b),o===I.SINGLE)n(X(b));else{const d=r.current;if(!d)return;n(z("init",b)),d.scrollTop=0}},a=new Date(e);return i.exports.jsxs("div",{className:"sticky top-0 z-10 flex w-full flex-col justify-between border border-t-0 bg-white py-2 px-2",ref:s,children:[i.exports.jsxs("div",{className:"flex h-8 items-center",children:[i.exports.jsx("div",{className:"flex h-full bg-white",children:e&&i.exports.jsxs("span",{className:"inline-flex h-full items-center",children:[a.getFullYear(),"\u5E74",a.getMonth()+1,"\u6708"]})}),i.exports.jsxs("div",{className:"ml-auto flex items-center bg-white",children:[i.exports.jsx("button",{onClick:()=>{const f=Date.now();t(f),l(I.SINGLE),console.log(X(f)),n(X(f))},className:O(o===I.SINGLE&&"bg-gray-200"),children:"\u5355\u6708"}),i.exports.jsx("button",{onClick:()=>{const f=Date.now();t(f),l(I.MULTIPLE),n(z("init",f))},className:O(o===I.MULTIPLE&&"bg-gray-200"),children:"\u591A\u6708"}),i.exports.jsx("button",{onClick:()=>u("pre"),children:i.exports.jsx(J,{className:"h-5 w-5"})}),i.exports.jsx("button",{className:"cursor-pointer bg-white px-2",onClick:()=>u("today"),children:"\u4ECA\u5929"}),i.exports.jsx("button",{onClick:()=>u("next"),children:i.exports.jsx(Q,{className:"h-5 w-5"})})]})]}),i.exports.jsx("div",{className:"mt-2 flex",children:"\u65E5_\u4E00_\u4E8C_\u4E09_\u56DB_\u4E94_\u516D".split("_").map(f=>i.exports.jsxs("div",{className:"flex-1 text-center",children:["\u5468",f]},f))})]})},Zt=()=>{const[e,t]=x.exports.useState(I.SINGLE),[s,n]=x.exports.useState(e===I.SINGLE?X():z()),r=x.exports.useRef([]),c=x.exports.useRef([]),o=x.exports.useRef(null),l=x.exports.useRef(null),[u,a]=x.exports.useState([{id:R(),title:1,startTime:M(Date.now())+3*y,endTime:M(Date.now())+4*y},{id:R(),title:2,startTime:M(Date.now())+5*y,endTime:M(Date.now())+6*y}]),f=x.exports.useMemo(()=>({container:o,showType:e,setShowType:t,calenderDates:s,setCalenderDates:n,calenderDatesRef:r,calenderHeader:l}),[e,s]),b=x.exports.useMemo(()=>({todoList:u,setTodoList:a,todoListRef:c}),[u,a,c]);return c.current=u,r.current=s,i.exports.jsx(Re.Provider,{value:f,children:i.exports.jsx(ke.Provider,{value:b,children:i.exports.jsx(Jt,{})})})},Jt=()=>{const{setTodoList:e}=fe(),{container:t,calenderDates:s,setCalenderDates:n,showType:r}=V(),c=x.exports.useRef(!1),o=x.exports.useRef(r);o.current=r;const[l,u]=x.exports.useState(M(new Date().setDate(1)));return x.exports.useEffect(()=>{const a=t.current;if(!a)return;const f=()=>{if(o.current===I.SINGLE)return;const b=t.current;!b||b.scrollHeight<b.scrollTop+b.clientHeight+200&&!c.current&&(c.current=!0,n(d=>d.concat(z("append",d[d.length-1]+y))))};return a.addEventListener("scroll",f),()=>a.removeEventListener("scroll",f)},[t,n,r]),x.exports.useEffect(()=>{if(r===I.SINGLE)return;c.current=!1;const a=t.current;!a||a.scrollHeight<=a.clientHeight&&n(f=>f.concat(z("append",f[f.length-1]+y)))},[s.length,t,n,r]),i.exports.jsxs("div",{className:"relative mx-auto flex max-h-full w-full flex-col items-center overflow-auto",style:{background:"linear-gradient(90deg, #f5f5f5 14.285714285%, transparent 14.285714285%, transparent 85.714285714%, #f5f5f5 85.714285714%)"},ref:t,children:[i.exports.jsx(Xt,{currentMonth:l,setCurrentMonth:u}),i.exports.jsx("div",{className:"w-full min-w-max border-l",children:s.map((a,f)=>f%7===0?i.exports.jsx(Kt,{dates:s.slice(f,f+7),setCurrentMonth:u,setTodoList:e},a):null)})]})},Qt=()=>{const[e,t]=x.exports.useState(q()),s=M(Date.now());return i.exports.jsxs("div",{className:"relative flex flex-1 flex-col overflow-auto",children:[i.exports.jsxs("div",{className:"flex items-center border-b py-1",children:[i.exports.jsx("p",{className:"mr-auto",children:_(e[1][0]).format("YYYY")}),i.exports.jsx("button",{onClick:()=>t(q(e[0][0]-y)),className:"rounded hover:bg-gray-200",children:i.exports.jsx(J,{className:"h-5 w-5"})}),i.exports.jsx("button",{className:"mx-2 cursor-pointer bg-white  px-2",onClick:()=>{t(q(Date.now()))},children:"\u4ECA\u5929"}),i.exports.jsx("button",{onClick:()=>t(q(e[11][41]+y)),className:"rounded hover:bg-gray-200",children:i.exports.jsx(Q,{className:"h-5 w-5"})})]}),i.exports.jsx("div",{style:{gridTemplateColumns:"repeat(4, 1fr)"},className:"grid flex-1 gap-4 overflow-auto",children:e.map((n,r)=>i.exports.jsxs("div",{className:"mt-2",children:[i.exports.jsx("div",{className:"pl-4 text-red-400",children:Ke[r]}),i.exports.jsx("div",{className:"mt-2 flex",children:"\u65E5_\u4E00_\u4E8C_\u4E09_\u56DB_\u4E94_\u516D".split("_").map(c=>i.exports.jsx("div",{className:"flex-1 text-center opacity-60",children:c},c))}),i.exports.jsx("div",{className:"mt-2",children:n.map(c=>{if(new Date(c).getDay()===0)return i.exports.jsx(Vt,{today:s,start:c,month:r},c)})})]},r))})]})},Vt=({start:e,month:t,today:s})=>i.exports.jsx("div",{className:"flex",children:new Array(7).fill(1).map((n,r)=>{const c=e+r*y,o=s===c,l=new Date(c).getMonth()===t;return i.exports.jsx("span",{className:O("min-w-5 flex h-6 flex-1 items-center justify-center text-sm",!l&&"opacity-30"),children:l&&o?i.exports.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-red-600 text-white",children:new Date(c).getDate()}):new Date(c).getDate()},c)})}),es=[{type:F.DAY,name:"\u65E5"},{type:F.WEEK,name:"\u5468"},{type:F.MONTH,name:"\u6708"},{type:F.YEAR,name:"\u5E74"}],ts={[F.DAY]:It,[F.WEEK]:Bt,[F.MONTH]:Zt,[F.YEAR]:Qt},xs=()=>{const[e,t]=x.exports.useState(F.DAY),s=ts[e];return i.exports.jsxs("div",{className:"flex h-full flex-col",children:[i.exports.jsx("div",{className:"flex border-b pb-1",children:es.map(({name:n,type:r})=>i.exports.jsx("button",{className:O("mr-2 rounded-md px-2",r===e?"bg-gray-300":""),onClick:()=>t(r),children:n},r))}),i.exports.jsx(s,{})]})};export{xs as default};
